<!DOCTYPE html>
<html lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="Introduction
Our hackerspace recently got a new tool: a hot air rework station.
I decided to use it to practice by hard-modding a router to run OpenWrt (I had never done this kind of hardware work before)."><title>First Hardware Mod: OpenWrt on a Router&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="First Hardware Mod: OpenWrt on a Router" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/en/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/en/categories/">Categories</a><a class="nav item" href="/en/tags/">Tags</a><a class="nav item" href="/en/about/">About</a><a class="nav item" href="/en/links/">Links</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">First Hardware Mod: OpenWrt on a Router</h1><p class="article date">Monday, April 4, 2016<span class="langs"><span class="lang">
                    <a href="/zh/posts/first-hardware-mod-router-openwrt/" title="‰∏≠Êñá">
                        <span class="lang-icon">üåê</span>‰∏≠Êñá</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="introduction">Introduction</h2>
<p>Our hackerspace recently got a new tool: a hot air rework station.<br>
I decided to use it to practice by hard-modding a router to run OpenWrt (I had never done this kind of hardware work before).</p>
<p><img loading="lazy"  src="./1.jpg"
        alt="1"/></p>
<h2 id="preparation">Preparation</h2>
<p><strong>Device</strong>: TP-Link WR845N v4</p>
<p><img loading="lazy"  src="./2.jpg"
        alt="2"/></p>
<p><strong>Hardware tools</strong>: hot air rework station, temperature-controlled soldering iron (fine tip and knife tip), CH341A programmer, SOP 8/16 adapter board, desoldering braid, solder sucker, flux, rosin, tweezers, solder wire, heat‚Äëresistant tape.<br>
<strong>Parts</strong>:</p>
<ul>
<li>Winbond 16 MB (128 Mbit) SPI flash</li>
<li>HY5DU121622CTP-D43 DDR 64M√ó16 memory chip</li>
</ul>
<p><strong>Software environment</strong>: Windows 10 with the CH341A programmer software.</p>
<h2 id="key-hardware-steps">Key hardware steps</h2>
<h3 id="removing-the-flash">Removing the flash</h3>
<p>Install a 1-cm nozzle on the hot air gun, set the temperature to 265‚ÄØ¬∞C and the airflow to 6.<br>
Preheat the router PCB first, then heat the flash chip directly. After a dozen seconds or so, the solder on the flash pins will turn shiny ‚Äî that means it has melted and you can gently lift the chip off with tweezers.</p>
<h3 id="removing-the-ram">Removing the RAM</h3>
<p>Mask the surrounding components with heat‚Äëresistant tape for protection.<br>
Apply plenty of flux along both sides of the RAM chip pins, then add solder to the pins.<br>
While dragging solder along one side, use tweezers to gently push up from the left side. Use upward force, but not too much, or you may tear off pads.<br>
Set the iron temperature to about 380‚ÄØ¬∞C, and lightly slide the tip back and forth across the pins so the solder stays molten; that way one side will lift up. Repeat the same for the other side.</p>
<h3 id="soldering-the-dupont-headers">Soldering the Dupont headers</h3>
<p>Set the iron to around 350‚ÄØ¬∞C.<br>
Based on how the flash is wired to the socket, plug the Dupont pins into the SOP adapter board.<br>
Place the iron tip against the junction of each Dupont pin and pad, touch it with a bit of solder, and the pin will be fixed in place.</p>
<p><img loading="lazy"  src="./a.png"
        alt="a"/></p>
<h3 id="soldering-the-flash">Soldering the flash</h3>
<p>Solder the flash onto the SOP adapter board.<br>
Make sure the side of the flash with the dot aligns with the notched side marked on the PCB.</p>
<p><img loading="lazy"  src="./b.jpg"
        alt="b"/></p>
<h3 id="soldering-the-ram">Soldering the RAM</h3>
<p>Align the RAM chip with the pads.<br>
Again, the side with the dot should face the side of the PCB footprint with the notch.<br>
First fix two opposite corners with solder, then drag-solder the rest of the pins.</p>
<p>I probably used the wrong solder, because I kept ending up with bridges between pins.<br>
Because of that I had to keep removing and re‚Äësoldering the chip, and on one of the boards several pads eventually lifted.</p>
<p>To clean up bridges, you can use desoldering braid, or carefully scrape away excess solder with a fine needle.</p>
<p>Failed attempt:</p>
<p><img loading="lazy"  src="./bad.jpg"
        alt="bad"/></p>
<p>Successful attempt:</p>
<p><img loading="lazy"  src="./complete.jpg"
        alt="complete"/></p>
<p>And finally, I added a small heatsink:</p>
<p><img loading="lazy"  src="./inside.jpg"
        alt="inside"/></p>
<h2 id="workflow">Workflow</h2>
<p><img loading="lazy"  src="./3.jpg"
        alt="3"/></p>
<p><img loading="lazy"  src="./4.jpg"
        alt="4"/></p>
<p>First, remove the original flash and use the programmer to back up the firmware.<br>
The important part is the <code>art</code> partition, which contains wireless calibration data and parameters that are slightly different for every device.</p>
<p>Then download a suitable bootloader for this SoC and program it into the new 16 MB flash.<br>
Here I used the <code>Breed</code> bootloader by Hackpascal:</p>
<ul>
<li>Hackpascal blog: <code>http://blog.hackpascal.net/</code></li>
<li>Breed thread: <code>http://www.right.com.cn/forum/thread-161906-1-1.html</code></li>
</ul>
<p>After writing the bootloader, solder the new flash back onto the board.<br>
Power on the router, plug in an Ethernet cable, and open <code>http://192.168.1.1</code> in a browser.</p>
<p><img loading="lazy"  src="./breed.jpg"
        alt="breed"/></p>
<p>Next, replace the RAM and power on again.<br>
If there are cold joints or bridges, all the LEDs will stay fully lit after power‚Äëon.</p>
<p>Here you can see the RAM successfully recognized as 64 MB:</p>
<p><img loading="lazy"  src="./a64.png"
        alt="a64"/></p>
<p>Then enter Breed and flash both PandoraBox (or another OpenWrt build) and the ART partition.<br>
In my case I flashed an OpenWrt image compiled by Hackpascal.<br>
If you didn‚Äôt back up your own ART partition, you can use the one provided by Hackspecial:</p>
<ul>
<li>ART thread: <code>http://www.right.com.cn/forum/thread-136444-1-1.html</code></li>
</ul>
<p><img loading="lazy"  src="./ssh.jpg"
        alt="ssh"/></p>
<p>Finally, I slapped an Apple logo sticker on it ‚Äî perfect!</p>
<p><img loading="lazy"  src="./appearance.jpg"
        alt="appearance"/></p>
</article><section class="article labels"><a class="category" href=/en/categories/tinkering/>Tinkering</a><a class="tag" href=/en/tags/openwrt/>OpenWrt</a><a class="tag" href=/en/tags/tp-link/>TP-Link</a><a class="tag" href=/en/tags/hardware-mod/>hardware mod</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/en/posts/add-free-ssl-certificate-to-website/"><span class="iconfont icon-article"></span>Add a Free SSL Certificate to Your Website</a></p><p><a class="link" href="/en/posts/esxi-5-5-tinkering-notes-1/"><span class="iconfont icon-article"></span>ESXi 5.5 Tinkering Notes</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (Attribution-NonCommercial-ShareAlike).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>