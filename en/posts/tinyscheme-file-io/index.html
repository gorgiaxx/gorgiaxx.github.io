<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="Preface
Scheme is a Lisp dialect created in 1975 by MIT‚Äôs Gerald J. Sussman and Guy L. Steele Jr. It is one of the two major modern Lisp dialects; the other is Common Lisp.
Despite its long history, Scheme remains active and has implementations for many platforms and environments, such as Racket, Guile, MIT Scheme, and Chez Scheme.
TinyScheme is a lightweight embeddable Scheme interpreter that follows the R5RS (Revised^5 Report on the Algorithmic Language Scheme) specification. This specification was released in 1998 and is now widely used.
Although TinyScheme lacks extensive official documentation, its adherence to the R5RS standard enables developers to consult documentation from mainstream Scheme implementations, such as Racket, for guidance."><title>TinyScheme File I/O&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="TinyScheme File I/O" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/en/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/en/categories/">Categories</a><a class="nav item" href="/en/tags/">Tags</a><a class="nav item" href="/en/about/">About</a><a class="nav item" href="/en/links/">Links</a><a class="nav item" href="/zh/posts/tinyscheme-file-io/" title="‰∏≠Êñá">
            <span class="lang-icon">üåê</span>‰∏≠Êñá</a></nav></div></span></div></section><section id="content"><style>
     
    .toc-wrapper {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 9999;
        display: flex;
        flex-direction: column-reverse;
        align-items: flex-end;
        gap: 10px;
    }

     
    .toc-button {
        background-color: #fff;
        color: #333;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid #ddd;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .toc-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .toc-button svg {
        width: 24px;
        height: 24px;
        fill: currentColor;
    }

     
    .toc-content-box {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        width: 250px;
        max-height: 60vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        display: none;
         
        font-size: 0.9em;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.3s, transform 0.3s;
    }

    .toc-content-box.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }

    .toc-header {
        font-weight: bold;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 8px;
        margin-bottom: 8px;
        font-size: 1.1em;
    }

     
    #TableOfContents {
        text-align: left;
    }

    #TableOfContents ul,
    #TableOfContents ol {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    #TableOfContents li {
        margin: 4px 0;
    }

    #TableOfContents ul ul,
    #TableOfContents ol ol {
        padding-left: 1em;
    }

    #TableOfContents a {
        text-decoration: none;
        color: #555;
        display: block;
        padding: 2px 0;
        transition: color 0.2s;
    }

    #TableOfContents a:hover {
        color: #007bff;
    }

     
    @media (prefers-color-scheme: dark) {
        .toc-button {
            background-color: #333;
            color: #ddd;
            border-color: #555;
        }

        .toc-content-box {
            background-color: #2a2a2a;
            border-color: #444;
            color: #ddd;
        }

        .toc-header {
            border-bottom-color: #444;
        }

        #TableOfContents a {
            color: #aaa;
        }

        #TableOfContents a:hover {
            color: #fff;
        }
    }
</style><div class="article-container"><section class="article header">
    <h1 class="article title">TinyScheme File I/O</h1><p class="article date">Sunday, October 21, 2018<span class="langs"><span class="lang">
                    <a href="/zh/posts/tinyscheme-file-io/" title="‰∏≠Êñá">
                        <span class="lang-icon">üåê</span>‰∏≠Êñá</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="preface">Preface</h2>
<p>Scheme is a Lisp dialect created in 1975 by MIT‚Äôs Gerald J. Sussman and Guy L. Steele Jr. It is one of the two major modern Lisp dialects; the other is Common Lisp.
Despite its long history, Scheme remains active and has implementations for many platforms and environments, such as Racket, Guile, MIT Scheme, and Chez Scheme.
TinyScheme is a lightweight embeddable Scheme interpreter that follows the R5RS (Revised^5 Report on the Algorithmic Language Scheme) specification. This specification was released in 1998 and is now widely used.
Although TinyScheme lacks extensive official documentation, its adherence to the R5RS standard enables developers to consult documentation from mainstream Scheme implementations, such as <a href="https://docs.racket-lang.org/reference/index.html"target="_blank" rel="noopener noreferrer">Racket</a>, for guidance.</p>
<h2 id="install">Install</h2>
<p>Download:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">https://sourceforge.net/projects/tinyscheme/files/tinyscheme/
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make all
</span></span><span class="line"><span class="cl">$ ./scheme
</span></span><span class="line"><span class="cl">TinyScheme 1.41
</span></span><span class="line"><span class="cl">ts&gt;
</span></span></code></pre></div><p>Directory layout:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ BUILDING
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ CHANGES
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ COPYING
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ dynload.c
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ dynload.h
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ hack.txt
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ init.scm
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ makefile
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ Manual.txt
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ MiniSCHEMETribute.txt
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ opdefines.h             <span class="c1"># Defines TinyScheme reserved keywords; developers can add custom features here.</span>
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ scheme.c                <span class="c1"># Implements the core interpreter logic.</span>
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ scheme.h
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ scheme-private.h
</span></span></code></pre></div><h3 id="read-a-file">Read a file</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">open</span> <span class="nv">a</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define</span> <span class="nf">shadow</span> <span class="p">(</span><span class="nv">open-input-file</span> <span class="s">&#34;/etc/shadow&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">read</span> <span class="nv">one</span> <span class="nv">line</span> <span class="nb">and</span> <span class="nf">print</span> <span class="nv">it</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">read</span> <span class="nf">shadow</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="write-a-file">Write a file</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">open</span> <span class="nv">a</span> <span class="nv">file</span> <span class="nv">for</span> <span class="nv">output</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define</span> <span class="nv">ou</span> <span class="p">(</span><span class="nv">open-output-file</span> <span class="s">&#34;/tmp/shadow&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nv">define</span> <span class="nv">a</span> <span class="nv">variable</span> <span class="nv">containing</span> <span class="k">the</span> <span class="nc">string</span> <span class="nv">to</span> <span class="nf">write</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define</span> <span class="nv">text</span> <span class="s">&#34;root:aaddd.asdasd.:13333:0:99999:3:::&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nv">display</span> <span class="k">the</span> <span class="nv">content</span> <span class="nv">to</span> <span class="nv">standard</span> <span class="nv">output</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">display</span> <span class="nv">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">write</span> <span class="k">the</span> <span class="nc">string</span> <span class="nv">representation</span> <span class="p">(</span><span class="nv">including</span> <span class="nv">quotes</span><span class="p">)</span> <span class="nv">to</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">write</span> <span class="nv">text</span> <span class="nv">ou</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">write</span> <span class="nv">a</span> <span class="nv">single</span> <span class="nc">character</span> <span class="ss">&#39;c</span><span class="o">&#39;</span> <span class="nv">to</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">write-char</span> <span class="sc">#\c</span> <span class="nv">ou</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">write</span> <span class="nv">a</span> <span class="nv">newline</span> <span class="nc">character</span> <span class="nv">to</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">newline</span> <span class="nv">ou</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nv">save</span> <span class="nv">changes</span> <span class="nb">and</span> <span class="nf">close</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">close-output-port</span> <span class="nv">ou</span><span class="p">)</span>
</span></span></code></pre></div><p>When using <code>write</code> to save a string variable to a file, the output will include double quotes. To avoid this, writing characters individually is often preferred. Additionally, attempting to write a large volume of data at once may cause failures.
Furthermore, when interacting with a remote TinyScheme shell, standard newline characters (<code>\n</code>) might not be processed correctly; in such cases, the <code>(newline port)</code> function should be used instead.</p>
<p>The following Python script generates Scheme code to write a file byte-by-byte, handling special characters appropriately:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Write file by tinyscheme&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;-l&#34;</span><span class="p">,</span> <span class="s2">&#34;--local-file&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;directory to be read&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;-t&#34;</span><span class="p">,</span> <span class="s2">&#34;--target-file&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;path to write the file to&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">file_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">local_file</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(define ou (open-output-file </span><span class="se">\&#34;</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">target_file</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">))&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">raw</span> <span class="o">=</span> <span class="n">local_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># print(&#34;\n&#34;, end=&#34;&#34;)</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(newline ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(write-char #</span><span class="se">\\</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34; ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">local_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(newline ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(close-output-port ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="reference">Reference</h2>
<p><a href="https://schemers.org/Documents/Standards/R5RS/"target="_blank" rel="noopener noreferrer">R5RS</a></p>
</article><section class="article labels"><a class="category" href=/en/categories/cybersecurity/>Cybersecurity</a><a class="tag" href=/en/tags/tinyscheme/>tinyscheme</a><a class="tag" href=/en/tags/lisp/>Lisp</a><a class="tag" href=/en/tags/r5rs/>R5Rs</a></section>
</div>

<div class="toc-wrapper">
    <div class="toc-content-box" id="toc-content-box">
        <div class="toc-header">Table of Contents</div>
        <nav id="TableOfContents">
  <ol>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#install">Install</a>
      <ol>
        <li><a href="#read-a-file">Read a file</a></li>
        <li><a href="#write-a-file">Write a file</a></li>
      </ol>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ol>
</nav>
    </div>
    <div class="toc-button" onclick="toggleTOC()" title="">
        
        <svg viewBox="0 0 24 24">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path>
        </svg>
    </div>
</div>

<script>
    function toggleTOC() {
        const tocBox = document.getElementById('toc-content-box');
        if (tocBox.classList.contains('show')) {
            tocBox.classList.remove('show');
            
            
            
            
            
            setTimeout(() => {
                tocBox.style.display = 'none';
            }, 300); 
        } else {
            tocBox.style.display = 'block';
            
            void tocBox.offsetWidth;
            tocBox.classList.add('show');
        }
    }

    
    document.addEventListener('click', function (event) {
        const wrapper = document.querySelector('.toc-wrapper');
        const tocBox = document.getElementById('toc-content-box');
        if (wrapper && !wrapper.contains(event.target) && tocBox.classList.contains('show')) {
            toggleTOC();
        }
    });
</script><div class="article bottom"><section class="article navigation"><p><a class="link" href="/en/posts/visteon-firmware-repacking/"><span class="iconfont icon-article"></span>Visteon Firmware Repacking</a></p><p><a class="link" href="/en/posts/firmware-extraction-series-sd-card-unlock/"><span class="iconfont icon-article"></span>Firmware Extraction Series - SD Card Unlock</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (Attribution-NonCommercial-ShareAlike).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>