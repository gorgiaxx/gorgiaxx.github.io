<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="Preface
Scheme is a Lisp dialect created in 1975 by MIT‚Äôs Gerald J. Sussman and Guy L. Steele Jr. It is one of the two major modern Lisp dialects; the other is Common Lisp.
Despite its long history, Scheme remains active and has implementations for many platforms and environments, such as Racket, Guile, MIT Scheme, and Chez Scheme.
TinyScheme is a lightweight embeddable Scheme interpreter that follows the R5RS (Revised^5 Report on the Algorithmic Language Scheme) specification. This specification was released in 1998 and is now widely used.
Although TinyScheme has little official documentation, it follows R5RS, so you can refer to other mainstream Scheme implementations for usage details, such as Racket."><title>TinyScheme File I/O&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="TinyScheme File I/O" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/en/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/en/categories/">Categories</a><a class="nav item" href="/en/tags/">Tags</a><a class="nav item" href="/en/about/">About</a><a class="nav item" href="/en/links/">Links</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">TinyScheme File I/O</h1><p class="article date">Sunday, October 21, 2018<span class="langs"><span class="lang">
                    <a href="/zh/posts/tinyscheme-file-io/" title="‰∏≠Êñá">
                        <span class="lang-icon">üåê</span>‰∏≠Êñá</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="preface">Preface</h2>
<p>Scheme is a Lisp dialect created in 1975 by MIT‚Äôs Gerald J. Sussman and Guy L. Steele Jr. It is one of the two major modern Lisp dialects; the other is Common Lisp.
Despite its long history, Scheme remains active and has implementations for many platforms and environments, such as Racket, Guile, MIT Scheme, and Chez Scheme.
TinyScheme is a lightweight embeddable Scheme interpreter that follows the R5RS (Revised^5 Report on the Algorithmic Language Scheme) specification. This specification was released in 1998 and is now widely used.
Although TinyScheme has little official documentation, it follows R5RS, so you can refer to other mainstream Scheme implementations for usage details, such as <a href="https://docs.racket-lang.org/reference/index.html"target="_blank" rel="noopener noreferrer">Racket</a>.</p>
<h2 id="install">Install</h2>
<p>Download:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">https://sourceforge.net/projects/tinyscheme/files/tinyscheme/
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make all
</span></span><span class="line"><span class="cl">$ ./scheme
</span></span><span class="line"><span class="cl">TinyScheme 1.41
</span></span><span class="line"><span class="cl">ts&gt;
</span></span></code></pre></div><p>Directory layout:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ BUILDING
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ CHANGES
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ COPYING
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ dynload.c
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ dynload.h
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ hack.txt
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ init.scm
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ makefile
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ Manual.txt
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ MiniSCHEMETribute.txt
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ opdefines.h             Defines TinyScheme reserved keywords<span class="p">;</span> developers can add custom features.
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ scheme.c                Defines how code is parsed.
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ scheme.h
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ scheme-private.h
</span></span></code></pre></div><h3 id="read-a-file">Read a file</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">open</span> <span class="nv">a</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define</span> <span class="nf">shadow</span> <span class="p">(</span><span class="nv">open-input-file</span> <span class="s">&#34;/etc/shadow&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">read</span> <span class="nv">one</span> <span class="nv">line</span> <span class="nb">and</span> <span class="nf">print</span> <span class="nv">it</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">read</span> <span class="nf">shadow</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="write-a-file">Write a file</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">open</span> <span class="nv">a</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define</span> <span class="nv">ou</span> <span class="p">(</span><span class="nv">open-output-file</span> <span class="s">&#34;/tmp/shadow&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nv">define</span> <span class="k">the</span> <span class="nv">content</span> <span class="nv">to</span> <span class="nf">write</span> <span class="nv">into</span> <span class="nv">a</span> <span class="nv">variable</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">define</span> <span class="nv">text</span> <span class="s">&#34;root:aaddd.asdasd.:13333:0:99999:3:::&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">print</span> <span class="k">the</span> <span class="nv">variable</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">display</span> <span class="nv">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">write</span> <span class="k">the</span> <span class="nv">variable</span> <span class="nv">value</span> <span class="nv">to</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">write</span> <span class="nv">text</span> <span class="nv">ou</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">write</span> <span class="nc">character</span> <span class="nv">c</span> <span class="nv">to</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">write-char</span> <span class="sc">#\c</span> <span class="nv">ou</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nf">append</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">line</span> <span class="nv">to</span> <span class="nv">ou</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">newline</span> <span class="nv">ou</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span> <span class="nv">save</span> <span class="nb">and</span> <span class="nf">close</span> <span class="k">the</span> <span class="nv">file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">close-output-port</span> <span class="nv">ou</span><span class="p">)</span>
</span></span></code></pre></div><p>Writing a string variable directly to a file will include double quotes, so writing characters one by one is preferred. Also, writing a large amount of characters at once may fail. In addition, if you‚Äôre using a remote TinyScheme shell, a single newline character <code>\n</code> may not be recognized, so use <code>\newline</code> instead.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Write file by tinyscheme&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;-l&#34;</span><span class="p">,</span> <span class="s2">&#34;--local-file&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;directory to be read&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;-t&#34;</span><span class="p">,</span> <span class="s2">&#34;--target-file&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;directory to be write&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">file_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">local_file</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(define ou (open-output-file </span><span class="se">\&#34;</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">target_file</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">))&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">raw</span> <span class="o">=</span> <span class="n">local_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># print(&#34;\n&#34;, end=&#34;&#34;)</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(newline ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(write-char #</span><span class="se">\\</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34; ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">local_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(newline ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;(close-output-port ou)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="reference">Reference</h2>
<p><a href="https://schemers.org/Documents/Standards/R5RS/"target="_blank" rel="noopener noreferrer">R5RS</a></p>
</article><section class="article labels"><a class="category" href=/en/categories/cybersecurity/>Cybersecurity</a><a class="tag" href=/en/tags/tinyscheme/>tinyscheme</a><a class="tag" href=/en/tags/lisp/>Lisp</a><a class="tag" href=/en/tags/r5rs/>R5Rs</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/en/posts/visteon-firmware-repacking/"><span class="iconfont icon-article"></span>Visteon Firmware Repacking</a></p><p><a class="link" href="/en/posts/firmware-extraction-series-sd-card-unlock/"><span class="iconfont icon-article"></span>Firmware Extraction Series - SD Card Unlock</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (Attribution-NonCommercial-ShareAlike).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>