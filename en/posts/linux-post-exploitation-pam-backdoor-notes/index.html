<!DOCTYPE html>
<html lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="Preface
Linux-PAM (Pluggable Authentication Modules) is a pluggable authentication framework. PAM uses configuration files under /etc/pam.d/ to manage how programs perform authentication."><title>Linux Post-Exploitation Notes: PAM Backdoor&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Linux Post-Exploitation Notes: PAM Backdoor" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/en/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/en/categories/">Categories</a><a class="nav item" href="/en/tags/">Tags</a><a class="nav item" href="/en/about/">About</a><a class="nav item" href="/en/links/">Links</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Linux Post-Exploitation Notes: PAM Backdoor</h1><p class="article date">Sunday, March 25, 2018<span class="langs"><span class="lang">
                    <a href="/zh/posts/linux-post-exploitation-pam-backdoor-notes/" title="‰∏≠Êñá">
                        <span class="lang-icon">üåê</span>‰∏≠Êñá</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="preface">Preface</h2>
<p>Linux-PAM (Pluggable Authentication Modules) is a pluggable authentication framework. PAM uses configuration files under <code>/etc/pam.d/</code> to manage how programs perform authentication.</p>
<p>Based on the service configuration files under <code>/etc/pam.d/</code>, PAM loads the corresponding modules under <code>/lib/security</code> (or distro-specific locations) as shared libraries to implement the required authentication behavior.</p>
<p>In post-exploitation scenarios, if you already have root access and administrators primarily use the root account, you may be tempted to obtain credentials for lateral movement. <strong>However, implementing credential-stealing or backdoor authentication is harmful and unsafe.</strong> For that reason, the sections below focus on high-level concepts and defensive considerations, and any actionable backdoor/credential-theft implementation details are <strong>redacted</strong>.</p>
<p>The tool <a href="https://github.com/gorgiaxx/sshLooter"target="_blank" rel="noopener noreferrer">sshLooter</a> is an example often cited in this area, but discussing or reproducing credential-stealing implementations is out of scope here. The rest of this post is presented for awareness and defense.</p>
<h2 id="writing-a-malicious-authentication-module-redacted">Writing a malicious authentication module (redacted)</h2>
<p>Different distributions and PAM versions differ, and binaries/modules are not necessarily portable across versions and architectures. It is still useful, from a <strong>defender‚Äôs</strong> perspective, to understand:</p>
<ul>
<li>which PAM service files are being used,</li>
<li>which modules are loaded and in what order,</li>
<li>and how to audit changes and detect suspicious modules.</li>
</ul>
<p>The following ‚Äúenvironment check‚Äù commands are shown as general system inspection examples:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">getconf LONG_BIT
</span></span><span class="line"><span class="cl">cat /etc/redhat-release
</span></span><span class="line"><span class="cl">rpm -qa <span class="p">|</span> grep pam
</span></span><span class="line"><span class="cl">apt-get list --installed <span class="p">|</span> grep pam
</span></span></code></pre></div><p>For OpenSSH, <code>UsePAM</code> controls whether PAM is enabled:</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf"># Set this to &#39;yes&#39; to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the ChallengeResponseAuthentication mechanism.
# Depending on your PAM configuration, this may bypass the setting of
# PasswordAuthentication, PermitEmptyPasswords, and
# &#34;PermitRootLogin without-password&#34;. If you just want the PAM account and
# session checks to run without PAM authentication, then enable this but set
# ChallengeResponseAuthentication=no
#UsePAM no
UsePAM yes
</code></pre><p>Example PAM package versions (for historical context):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pam-0.99.6.2-6.el5_5.2  CentOS release 5.8
</span></span><span class="line"><span class="cl">pam-1.1.1-13.el6.x86_64 CentOS release 6.4
</span></span></code></pre></div><p>In PAM modules, <code>pam_sm_authenticate</code> is the entry point for authentication. Attackers may try to abuse this to capture secrets or bypass checks. <strong>The actual backdoor module implementation is intentionally redacted</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* REDACTED: malicious PAM module implementation.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * If you are defending a system:
</span></span></span><span class="line"><span class="cl"><span class="cm"> * - audit PAM service files under /etc/pam.d/
</span></span></span><span class="line"><span class="cl"><span class="cm"> * - inspect the module paths referenced (e.g., pam_unix.so, custom .so)
</span></span></span><span class="line"><span class="cl"><span class="cm"> * - verify package integrity and check for unexpected shared objects
</span></span></span><span class="line"><span class="cl"><span class="cm"> * - monitor syslog/auth logs for unusual authentication behavior
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></div><h2 id="pam-backdoor-configuration-redacted">PAM backdoor configuration (redacted)</h2>
<p>PAM has a ‚Äústacked rules‚Äù design: multiple modules can be chained for a single authentication task. This is powerful for legitimate policy composition‚Äîand also an abuse point if attackers can modify <code>/etc/pam.d/*</code>.</p>
<p>From official documentation:</p>
<blockquote>
<p>auth -
this module type provides two aspects of authenticating the user. Firstly, it establishes that the user is who they claim to be, by instructing the application to prompt the user for a password or other means of identification. Secondly, the module can grant group membership or other privileges through its credential granting properties.</p>
</blockquote>
<blockquote>
<p>required -
failure of such a PAM will ultimately lead to the PAM-API returning failure but only after the remaining stacked modules (for this service and type) have been invoked.</p>
</blockquote>
<p>Attackers may attempt to insert an extra <code>auth</code> module line into PAM service files (e.g., <code>sshd</code>, <code>sudo</code>, <code>su</code>, <code>passwd</code>) to capture passwords or create a bypass. <strong>Concrete insertion commands and service-file payload lines are redacted</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># REDACTED: example PAM stacking lines used for backdooring.
</span></span></code></pre></div><h2 id="patching-upstream-pam-code-redacted">Patching upstream PAM code (redacted)</h2>
<p>If a malicious module is unreliable due to ABI/version mismatch, an attacker might attempt to patch and rebuild PAM components. <strong>This is an abuse technique and details are redacted.</strong></p>
<p>You can use authentication logs to investigate suspicious behavior:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">tail /var/log/secure
</span></span></code></pre></div><p>Official PAM sources (for defenders/researchers verifying code or building from trusted sources):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http://www.linux-pam.org/library/
</span></span></code></pre></div><p>Example of what a backdoor condition might look like in code is <strong>not reproduced here</strong>.</p>
<h2 id="receiver-side-redacted">Receiver side (redacted)</h2>
<p>Some offensive workflows include an exfiltration ‚Äúreceiver‚Äù service to collect captured credentials. <strong>Receiver implementations and any tokens/URLs are redacted.</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># REDACTED: receiver / exfiltration server example.</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># REDACTED: web endpoint and messaging integration example.</span>
</span></span></code></pre></div><h2 id="result">Result</h2>
<p>In the original setup, the ‚Äúcallback‚Äù server would forward captured data to a messaging bot. The screenshot/gif remains for awareness:</p>
<p><img loading="lazy"  src="pam_tg.gif"
        alt="pam_tg"/></p>
<h2 id="reference">Reference</h2>
<p><a href="http://www.linux-pam.org/Linux-PAM-html/sag-configuration-file.html"target="_blank" rel="noopener noreferrer">The Linux-PAM configuration file</a></p>
<p><a href="http://www.linux-pam.org/Linux-PAM-html/Linux-PAM_MWG.html"target="_blank" rel="noopener noreferrer">The Linux-PAM Module Writers&rsquo; Guide</a></p>
</article><section class="article labels"><a class="category" href=/en/categories/cybersecurity/>Cybersecurity</a><a class="tag" href=/en/tags/post-exploitation/>Post-Exploitation</a><a class="tag" href=/en/tags/linux/>Linux</a><a class="tag" href=/en/tags/pam-backdoor/>PAM Backdoor</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/en/posts/data-forwarding-techniques-in-pentest/"><span class="iconfont icon-article"></span>Data Forwarding Techniques in Penetration Testing</a></p><p><a class="link" href="/en/posts/sangfor-ssl-vpn-port-acl-bypass/"><span class="iconfont icon-article"></span>Sangfor SSL VPN Port ACL Bypass in Practice</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (Attribution-NonCommercial-ShareAlike).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>