<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="I‚Äôve made quite a bit of progress lately, but I‚Äôve hit a bottleneck. There are probably about three more posts‚Äô worth of material. I‚Äôve been very busy recently, so I‚Äôm publishing part three first."><title>IGS Arcade Reverse Engineering Series (3) - Getting a Shell&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="IGS Arcade Reverse Engineering Series (3) - Getting a Shell" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/en/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/en/categories/">Categories</a><a class="nav item" href="/en/tags/">Tags</a><a class="nav item" href="/en/about/">About</a><a class="nav item" href="/en/links/">Links</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">IGS Arcade Reverse Engineering Series (3) - Getting a Shell</h1><p class="article date">Monday, June 23, 2025<span class="langs"><span class="lang">
                    <a href="/zh/posts/igs-arcade-re-3/" title="‰∏≠Êñá">
                        <span class="lang-icon">üåê</span>‰∏≠Êñá</a>
                </span></span></p></section><article class="article markdown-body"><p>I‚Äôve made quite a bit of progress lately, but I‚Äôve hit a bottleneck. There are probably about three more posts‚Äô worth of material. I‚Äôve been very busy recently, so I‚Äôm publishing part three first.</p>
<p>I peeled off the chip sticker and did a detailed analysis. The hardware-analysis direction in part one was basically correct; I updated the chip description for IGS. The code in part two had some bugs, and I‚Äôve updated that as well.</p>
<ul>
<li>
<p><a href="/posts/igs_arcade_re_1">IGS Arcade Reverse Engineering Series (1) - E2000 Platform Analysis</a></p>
</li>
<li>
<p><a href="/posts/igs_arcade_re_2">IGS Arcade Reverse Engineering Series (2) - Game File Recovery</a></p>
</li>
</ul>
<p>To analyze the game main program efficiently, it‚Äôs best to do dynamic debugging on the device, which means getting shell access first. Aside from the CF card and I/O ports, I currently have almost no way to input anything into this device.</p>
<p>If I go the serial-debug route, the first step is finding the hardware debug port, and the next step is modifying the kernel‚Äôs built-in boot command. It‚Äôs a hassle, requires repacking everything back, and isn‚Äôt elegant.</p>
<p>The CF card has two partitions I can write to directly: one is the boot partition where the kernel lives, and the other is a partition for logs and temporary files. That second one might be able to get a shell, but ‚Äúpwning‚Äù this hardware isn‚Äôt my goal.</p>
<h2 id="repacking-igs-cramfs">Repacking IGS CRAMFS</h2>
<p>Previously, based on the characteristics of IGS‚Äôs heavily modified cramfs, I extended <code>cramfs-tools</code> a second time‚Äîbut it could only unpack, not repack. It wasn‚Äôt perfect, and I‚Äôm a bit obsessive; I want it to be a real toolkit.</p>
<p>IGS modified cramfs structures. They added a checksum field into <code>cramfs_inode</code>, meaning the inode is verified on every read.</p>
<pre tabindex="0"><code>struct cramfs_super {
	unsigned int magic1;
	unsigned int future;	/* future = CRAMFS_MAGIC ^ IGS_MAGIC_MASK2 ^ IGS_MAGIC_MASK1 */ 
    char igs_info[64];
	unsigned int size;	
	unsigned int magic2;
	unsigned int flags;	
	unsigned int padding;	
	struct cramfs_info fsid;
	char name[64];	
	struct cramfs_inode root;
};
struct cramfs_inode {
	u32 inode_magic;
	u32 namelen:CRAMFS_NAMELEN_WIDTH, offset:CRAMFS_OFFSET_WIDTH;
	u32 size:CRAMFS_SIZE_WIDTH, gid:CRAMFS_GID_WIDTH;
	u32 mode:CRAMFS_MODE_WIDTH, uid:CRAMFS_UID_WIDTH;
};
struct cramfs_info {
	u32 crc;
	u32 edition;
	u32 blocks;
	u32 files;
};
</code></pre><p>In <code>get_cramfs_inode</code>, there‚Äôs a hidden check: it XORs <code>inode_magic</code> with the root inode‚Äôs magic and checks whether the result equals <code>0x705DE1</code>. If not, it errors out. It‚Äôs simple, but it differs per game, and doing the same patch over and over is annoying.</p>
<p>The screenshot below looks readable because I spent some time on it. In fact, IDA‚Äôs decompilation was initially wrong and didn‚Äôt match the assembly at all. You have to reconstruct the struct first so the branches become correct; otherwise a lot of code gets lost.</p>
<p><img loading="lazy"  src="./get_inode.png"
        alt="get_inode"/></p>
<p>I‚Äôve implemented repacking for IGS cramfs: <a href="https://github.com/gorgiaxx/igs-toolkits/tree/master/"target="_blank" rel="noopener noreferrer">igs-toolkits cramfs-tools</a></p>
<p>Unpack</p>
<pre tabindex="0"><code>sudo ./igs-toolkits/cramfs-tools/cramfsck -v -x./out ./test.img
</code></pre><p>Repack</p>
<pre tabindex="0"><code>sudo ./igs-toolkits/cramfs-tools/mkcramfs ./out test.img
</code></pre><h2 id="fixing-the-shell-environment">Fixing the shell environment</h2>
<p>In the newer PM2008 versions, IGS added many anti-cracking measures. This kernel is very old, and I spent a lot of time solving compatibility problems. After testing many combinations of OS / toolchains / source versions repeatedly, I finally found a stable build environment.</p>
<h3 id="fixing-agetty">Fixing agetty</h3>
<p>After initialization, there is no tty shell, because IGS removed <code>agetty</code>. This component is in <code>util-linux</code>. It needs to be rebuilt with static linking.</p>
<pre tabindex="0"><code>CC=&#34;/opt/gcc_3.2.2/bin/gcc&#34;
LDFLAGS=&#34;-static&#34;
DESTDIR=/root/build-linux-utils
export LDFLAGS CC DESTDIR
./configure --enable-static
make
make install
</code></pre><p>Then add the following line to <code>/etc/inittab</code>. It looks like there is serial output at 115200; I still haven‚Äôt tried via COM. Since I‚Äôm researching in my bedroom and space is limited, I prefer more elegant debugging methods.</p>
<pre tabindex="0"><code>1:4:respawn:/sbin/agetty ttyS1 115200 vt102
</code></pre><h3 id="fixing-ssh-services">Fixing SSH services</h3>
<p>IGS removed the SSH service. I originally wanted to use an off-the-shelf <code>dropbear</code>, but none of them could run. I spent a lot of time finding a compatible <code>dropbear</code> 0.53 and doing a static build (fixing many errors). Many features are hardcoded in the code; I even made some patches, but weird issues still occurred.</p>
<p>So I had to switch to OpenSSH. Newer SSH clients have deprecated old crypto algorithms, and when connecting to an old SSH server you have to explicitly specify algorithms. So I chose a relatively newer <code>openssh</code> and <code>openssl</code>.</p>
<p>After building, generate key pairs. Because algorithms and formats differ, keys must be regenerated.</p>
<pre tabindex="0"><code>ssh-keygen -q -t rsa -f ssh_host_key
ssh-keygen -q -t rsa -f ssh_host_rsa_key
</code></pre><p><code>sshd_config</code> needs these to be configured manually:</p>
<pre tabindex="0"><code>HostKey /home/ssh_host_key
HostKey /home/ssh_host_rsa_key
SyslogFacility AUTHPRIV
LogLevel INFO
PermitRootLogin yes
AuthorizedKeysFile	.ssh/authorized_keys
PermitEmptyPasswords yes
X11Forwarding yes
Subsystem	sftp	/home/sftp-server
</code></pre><p>Finally, you need to fix <code>sshd</code>‚Äôs privilege separation setup, otherwise it will error.</p>
<pre tabindex="0"><code>mkdir /var/empty
echo &#34;sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin&#34; &gt;&gt; /etc/passwd
</code></pre><p>Add the SSH startup command into the boot script mentioned earlier:</p>
<pre tabindex="0"><code>/home/sshd -f /home/sshd_config -h /home/ssh_host_rsa_key -p 22 -E /PM2008v2/pm2_data/sshd.log &gt; /PM2008v2/pm2_data/sshd_run.log 2&gt;&amp;1
</code></pre><h3 id="fixing-ifconfig-and-enabling-networking">Fixing ifconfig and enabling networking</h3>
<p>IGS disabled network connectivity. I saw in the game code that networking is possible: the game has an <code>OnlineMode</code>. Early versions had global rankings, but the current version doesn‚Äôt support it and the code has obvious traces of modification. There‚Äôs no place to trigger entering <code>OnlineMode</code>.</p>
<p><img loading="lazy"  src="./nullsub.png"
        alt="nullsub"/></p>
<p>The system even has a DHCP service. The IP configuration logic is written in code.</p>
<p><img loading="lazy"  src="./network_enable.png"
        alt="network_enable"/></p>
<p><code>ifconfig</code> was neutered‚Äîprobably also modified‚Äîso I rebuilt my own.</p>
<pre tabindex="0"><code>/home/ifconfig eth0 up mtu 1500 &gt;&gt; /PM2008v2/pm2_data/game_stdout.log 2&gt;&amp;1
/home/ifconfig eth0 192.168.2.128 netmask 255.255.255.0 broadcast 192.168.2.255 &gt;&gt; /PM2008v2/pm2_data/game_stdout.log 2&gt;&amp;1
</code></pre><p>With that, it can connect to an external network.</p>
<p>I also built a version of <code>busybox</code>. I ran into a lot of compatibility issues, made some patches, and spent a long time before it finally compiled successfully. The binaries can be downloaded here:</p>
<p><a href="https://github.com/gorgiaxx/igs-toolkits/tree/master/E2000_binaries"target="_blank" rel="noopener noreferrer">https://github.com/gorgiaxx/igs-toolkits/tree/master/E2000_binaries</a></p>
<p>Put these files into the specified directory, repack, write to the CF card, reboot the device, and then the SSH service can be accessed directly.</p>
<p>Because there is no echo, I could only redirect stdout to <code>rdisk4s4</code>, i.e. the ext3 partition, then dump/mount it to view output. It took a lot of time to get this working; I ran these two commands countless times.</p>
<pre tabindex="0"><code>sudo dd if=/dev/rdisk4s4 of=./rdisk4s4.img bs=1M &amp;&amp; rm -rf ./part4 &amp;&amp; 7z x ./rdisk4s4.img -o./part4
</code></pre><pre tabindex="0"><code>sudo ../igs-toolkits/cramfs-tools/mkcramfs ./out test.img &amp;&amp; sudo dd if=./test.img of=/dev/rdisk4s2 bs=1M
</code></pre><h2 id="game-environment-analysis">Game environment analysis</h2>
<p>The E2000 host has two I/O interfaces. Control commands come from outside, so even if you get root you still can‚Äôt play the game.</p>
<h3 id="game-main-program">Game main program</h3>
<p>The game main program actually runs at <code>/exec/PM2008v2</code> and starts three processes.</p>
<p><img loading="lazy"  src="./shell.png"
        alt="shell"/></p>
<p>From the address space mapping you can tell this program runs under X11 with OpenGL rendering. It can also control the card reader. It calls <code>/dev/plx/Pci9030-0</code>, accessing it via DMA to a virtual address‚Äîthis should be the game‚Äôs physical I/O.</p>
<pre tabindex="0"><code>[IGS_Linux]root ~# cat /proc/120/maps 
08048000-084b6000 r-xp 00000000 00:08 98         /exec/PM2008v2
084b6000-084cb000 rw-p 0046e000 00:08 98         /exec/PM2008v2
084cb000-0b044000 rwxp 00000000 00:00 0 
40000000-40013000 r-xp 00000000 16:02 11153856   /lib/ld-2.3.2.so
40013000-40014000 rw-p 00012000 16:02 11153856   /lib/ld-2.3.2.so
40014000-40015000 rw-p 00000000 00:00 0 
40015000-4001d000 r-xp 00000000 16:02 57643504   /usr/sbin/cardread/lib/libcasmcard.so
4001d000-4001e000 rw-p 00007000 16:02 57643504   /usr/sbin/cardread/lib/libcasmcard.so
4001e000-40020000 rwxp 00000000 00:0b 2217       /dev/zero
40020000-4002d000 r-xp 00000000 16:02 12504408   /lib/libpthread-0.10.so
4002d000-4002e000 rw-p 0000d000 16:02 12504408   /lib/libpthread-0.10.so
4002e000-40070000 rw-p 00000000 00:00 0 
40070000-40072000 r-xp 00000000 16:02 11995640   /lib/libdl-2.3.2.so
40072000-40073000 rw-p 00001000 16:02 11995640   /lib/libdl-2.3.2.so
40073000-400de000 r-xp 00000000 16:02 28323568   /usr/X11R6/lib/libGL.so.1.0.8762
400de000-400f7000 rwxp 0006b000 16:02 28323568   /usr/X11R6/lib/libGL.so.1.0.8762
400f7000-400f8000 rwxp 00000000 00:00 0 
400f8000-400f9000 rw-p 00000000 00:00 0 
400f9000-4021e000 r-xp 00000000 16:02 11262808   /lib/libc-2.3.2.so
4021e000-40223000 rw-p 00124000 16:02 11262808   /lib/libc-2.3.2.so
40223000-40225000 rw-p 00000000 00:00 0 
40225000-40246000 r-xp 00000000 16:02 12066128   /lib/libm-2.3.2.so
40246000-40247000 rw-p 00020000 16:02 12066128   /lib/libm-2.3.2.so
40247000-40254000 r-xp 00000000 16:02 34514852   /usr/X11R6/lib/libXext.so.6.4
40254000-40255000 rw-p 0000c000 16:02 34514852   /usr/X11R6/lib/libXext.so.6.4
40255000-40331000 r-xp 00000000 16:02 33143504   /usr/X11R6/lib/libX11.so.6.2
40331000-40334000 rw-p 000db000 16:02 33143504   /usr/X11R6/lib/libX11.so.6.2
40334000-40342000 r-xp 00000000 16:02 57803624   /usr/sbin/cardread/lib/libpcsclite.so.0.0.1
40342000-40343000 rw-p 0000d000 16:02 57803624   /usr/sbin/cardread/lib/libpcsclite.so.0.0.1
40343000-40344000 rw-p 00000000 00:00 0 
40344000-40ad2000 r-xp 00000000 16:02 28719620   /usr/X11R6/lib/libGLcore.so.1.0.8762
40ad2000-40b02000 rwxp 0078d000 16:02 28719620   /usr/X11R6/lib/libGLcore.so.1.0.8762
40b02000-40b06000 rwxp 00000000 00:00 0 
40b06000-40b07000 rw-p 00000000 00:00 0 
40b07000-40b08000 r-xp 00000000 16:02 40614972   /usr/X11R6/lib/libnvidia-tls.so.1.0.8762
40b08000-40b09000 rw-p 00000000 16:02 40614972   /usr/X11R6/lib/libnvidia-tls.so.1.0.8762
40b09000-40b6b000 rw-p 00000000 00:00 0 
40b6b000-40b6c000 rw-s 00000000 00:0b 2004       /dev/plx/Pci9030-0
40b6c000-40b8c000 rw-s 00000000 00:0b 2004       /dev/plx/Pci9030-0
40b8c000-40b8d000 rw-s 00000000 00:0b 2004       /dev/plx/Pci9030-0
40b8d000-4158e000 rw-p 00000000 00:00 0 
4158e000-41596000 r-xp 00000000 16:02 34498192   /usr/X11R6/lib/libXcursor.so.1.0
41596000-41597000 rw-p 00007000 16:02 34498192   /usr/X11R6/lib/libXcursor.so.1.0
41597000-4159e000 r-xp 00000000 16:02 37237160   /usr/X11R6/lib/libXrender.so.1.2
4159e000-4159f000 rw-p 00006000 16:02 37237160   /usr/X11R6/lib/libXrender.so.1.2
4159f000-415a0000 rw-s e8001000 00:0b 1990       /dev/nvidia0
415a0000-415a1000 rw-s e8c02000 00:0b 1990       /dev/nvidia0
415a1000-415aa000 r-xp 00000000 16:02 12388932   /lib/libnss_files-2.3.2.so
415aa000-415ab000 rw-p 00008000 16:02 12388932   /lib/libnss_files-2.3.2.so
415ab000-415c2000 rw-s 00000000 00:04 0          /SYSV00000000 (deleted)
415c2000-416ee000 rw-s d0000000 00:0b 1990       /dev/nvidia0
416ee000-41750000 rw-p 00000000 00:0b 2217       /dev/zero
41750000-41791000 rw-p 00000000 00:00 0 
41791000-41893000 rw-s e0011000 00:0b 1990       /dev/nvidia0
41893000-41894000 rw-s 16fc2000 00:0b 1990       /dev/nvidia0
41894000-41895000 rw-s 17027000 00:0b 1990       /dev/nvidia0
41895000-41896000 rw-s df93b000 00:0b 1990       /dev/nvidia0
41896000-4189a000 rw-s 17025000 00:0b 1990       /dev/nvidia0
4189a000-4189b000 rw-s df939000 00:0b 1990       /dev/nvidia0
4189b000-4189c000 rw-s 17021000 00:0b 1990       /dev/nvidia0
4189c000-4199c000 rw-s e0114000 00:0b 1990       /dev/nvidia0
4199c000-4199d000 rw-s 00000000 00:04 98305      /SYSV00000000 (deleted)
4199d000-4199e000 rw-s 00000000 00:04 131074     /SYSV00000000 (deleted)
4199e000-41a56000 rw-p 00000000 00:00 0 
41a56000-41a57000 ---p 00000000 00:00 0 
41a57000-41c56000 rwxp 00001000 00:00 0 
41c56000-43096000 rw-p 00003000 00:00 0 
43096000-43097000 r--s 00000000 00:07 2709       /tmp/pcsc/.pcscpub
43097000-43098000 r--s 00001000 00:07 2709       /tmp/pcsc/.pcscpub
43098000-43099000 r--s 00002000 00:07 2709       /tmp/pcsc/.pcscpub
43099000-4309a000 r--s 00003000 00:07 2709       /tmp/pcsc/.pcscpub
4309a000-4309b000 r--s 00004000 00:07 2709       /tmp/pcsc/.pcscpub
4309b000-4309c000 r--s 00005000 00:07 2709       /tmp/pcsc/.pcscpub
4309c000-4309d000 r--s 00006000 00:07 2709       /tmp/pcsc/.pcscpub
4309d000-4309e000 r--s 00007000 00:07 2709       /tmp/pcsc/.pcscpub
4309e000-4309f000 r--s 00008000 00:07 2709       /tmp/pcsc/.pcscpub
4309f000-430a0000 r--s 00009000 00:07 2709       /tmp/pcsc/.pcscpub
430a0000-430a1000 r--s 0000a000 00:07 2709       /tmp/pcsc/.pcscpub
430a1000-430a2000 r--s 0000b000 00:07 2709       /tmp/pcsc/.pcscpub
430a2000-430a3000 r--s 0000c000 00:07 2709       /tmp/pcsc/.pcscpub
430a3000-430a4000 r--s 0000d000 00:07 2709       /tmp/pcsc/.pcscpub
430a4000-430a5000 r--s 0000e000 00:07 2709       /tmp/pcsc/.pcscpub
430a5000-430a6000 r--s 0000f000 00:07 2709       /tmp/pcsc/.pcscpub
430a6000-4352f000 rw-p 00000000 00:00 0 
43530000-441c9000 rw-p 0048a000 00:00 0 
4423c000-44322000 rw-p 01196000 00:00 0 
443a7000-444b0000 rw-p 01301000 00:00 0 
bfde2000-c0000000 rwxp ffde3000 00:00 0
</code></pre><p>The game program itself contains a lot of strings that look like encoded data. Before this, I had never dealt with Big5 encoding. I just asked DeepSeek to write a script to identify it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">chardet</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">encodings.aliases</span> <span class="kn">import</span> <span class="n">aliases</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">try_all_encodings</span><span class="p">(</span><span class="n">hex_str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_encodings</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">aliases</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">byte_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hex_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ÂéüÂßã16ËøõÂà∂Êï∞ÊçÆ: </span><span class="si">{</span><span class="n">hex_str</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Â≠óËäÇÈïøÂ∫¶: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">byte_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">detected</span> <span class="o">=</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">byte_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Ëá™Âä®Ê£ÄÊµãÁªìÊûú: </span><span class="si">{</span><span class="n">detected</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (ÁΩÆ‰ø°Â∫¶: </span><span class="si">{</span><span class="n">detected</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">common_encodings</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;gbk&#39;</span><span class="p">,</span> <span class="s1">&#39;gb18030&#39;</span><span class="p">,</span> <span class="s1">&#39;gb2312&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-16&#39;</span><span class="p">,</span> <span class="s1">&#39;big5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="s1">&#39;iso-2022-jp&#39;</span><span class="p">,</span> <span class="s1">&#39;euc-kr&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">=== Â∏∏ËßÅÁºñÁ†ÅÊµãËØï ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="n">common_encodings</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">decoded</span> <span class="o">=</span> <span class="n">byte_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">enc</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">decoded</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">=== ÂÆåÊï¥ÁºñÁ†ÅÊµãËØï ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_encodings</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">decoded</span> <span class="o">=</span> <span class="n">byte_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">decoded</span><span class="o">.</span><span class="n">isprintable</span><span class="p">():</span> 
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">enc</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">decoded</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">hex_data</span> <span class="o">=</span> <span class="s2">&#34;C2 F7 B6 7D 3A A6 50 AE C9 BA 56 C0 BB 31 50 A4 CE 32 50 B9 AA AD B1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">try_all_encodings</span><span class="p">(</span><span class="n">hex_data</span><span class="p">)</span>
</span></span></code></pre></div><p>The game was developed in Taiwan and uses Traditional Chinese. IDA can‚Äôt recognize it automatically, so it needs to be added manually.</p>
<p>Option -&gt; Strings -&gt; Default(8-bit) -&gt; Insert(Right Click) -&gt; Big5</p>
<p><img loading="lazy"  src="./big5.png"
        alt="big5"/></p>
<p>Since it‚Äôs non-ASCII and there isn‚Äôt a great automatic way to detect it, I‚Äôll just follow the same ‚Äúfix strings‚Äù approach from the previous post.</p>
<p><img loading="lazy"  src="./strings.png"
        alt="strings"/></p>
<p>When running the game main program, it only prints these logs:</p>
<pre tabindex="0"><code>[IGS_Linux]root /proc/sys# /exec/PM2008v2
Device Handle 4
Version Major 4,Minor 3,Rev 0
Get Virtual address!!

[CommandPortAddresss]=0x40b8c000,[ShareRAMAddress]=0x40b6c000
Clear CommandPort Complete.
start
</code></pre><p>The <code>dprintf</code> logic was removed in the code, so it won‚Äôt print logs.</p>
<h2 id="bottleneck">Bottleneck</h2>
<p>I‚Äôve hit a bottleneck: for rhythm games, hit detection is handled by the ASIC, and the ASIC passes the judgment state to the CPU. The main program contains no judgment logic. I‚Äôve already analyzed the ASIC27 protocol; writing my own judgment logic would be fine, but that‚Äôs no longer ‚Äúcracking‚Äù. Only by cracking the ASIC can you perfectly emulate these games. Next I need to dump the ASIC firmware, which is very difficult‚ÄîI‚Äôm not sure I can finish it this year.</p>
<p>There are two more posts‚Äô worth of work already done; I‚Äôll write them when I have time.</p>
<ul>
<li>IGS Arcade Reverse Engineering Series (4) - ASIC27 Protocol and TSGROM Static Analysis</li>
<li>IGS Arcade Reverse Engineering Series (5) - ASIC27 Protocol Hooking and Main Program Patching</li>
</ul>
<h2 id="rant-hexo">Rant: Hexo</h2>
<p>Last month my Linux PC‚Äôs CPU basically cooked itself. The cause was long-term operation and poor cooling. I spent a lot of time troubleshooting, migrating tools, and then moved the blog environment to a new computer.</p>
<p>I used to write posts by using <code>nvm</code> to switch to an old Node version and running the Hexo framework to generate static pages. I hadn‚Äôt touched that setup for 8 years. Ever since then, Hexo‚Äôs dependencies have been a mess‚Äîupdates always break something‚Äîso I didn‚Äôt dare to upgrade.</p>
<p>The old environment was very hard to run on macOS. Neither building from source nor using Homebrew worked. I don‚Äôt understand why a Node.js project needs Python 3.8.</p>
<p>With that pile of messy dependencies, even the latest Hexo wouldn‚Äôt work; lots of themes were incompatible. I‚Äôm already using <code>asdf</code>, how is it still like this? I gave up on Hexo decisively and spent a lot of time migrating the blog to Hugo.</p>
</article><section class="article labels"><a class="category" href=/en/categories/reverse-engineering/>Reverse Engineering</a><a class="tag" href=/en/tags/igs/>IGS</a><a class="tag" href=/en/tags/arcade/>Arcade</a><a class="tag" href=/en/tags/crack/>Crack</a><a class="tag" href=/en/tags/international-games-system/>International Games System</a><a class="tag" href=/en/tags/e2000/>E2000</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/en/posts/igs-arcade-re-4/"><span class="iconfont icon-article"></span>IGS Arcade Reverse Engineering Series (4) - ASIC27 Protocol and Static Analysis of TSGROM Files</a></p><p><a class="link" href="/en/posts/igs-arcade-re-2/"><span class="iconfont icon-article"></span>IGS Arcade Reverse Engineering Series (2) - Recovering Game Files</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (Attribution-NonCommercial-ShareAlike).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>