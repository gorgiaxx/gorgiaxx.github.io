<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="Preface
This post documents the journey of extracting data from a locked hard drive, including the various detours I took along the way."><title>Firmware Extraction Series - SATA HDD Unlock&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Firmware Extraction Series - SATA HDD Unlock" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/en/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/en/categories/">Categories</a><a class="nav item" href="/en/tags/">Tags</a><a class="nav item" href="/en/about/">About</a><a class="nav item" href="/en/links/">Links</a><a class="nav item" href="/zh/posts/firmware-extraction-series-sata-hdd-unlock/" title="‰∏≠Êñá">
            <span class="lang-icon">üåê</span>‰∏≠Êñá</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Firmware Extraction Series - SATA HDD Unlock</h1><p class="article date">Saturday, April 20, 2019<span class="langs"><span class="lang">
                    <a href="/zh/posts/firmware-extraction-series-sata-hdd-unlock/" title="‰∏≠Êñá">
                        <span class="lang-icon">üåê</span>‰∏≠Êñá</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="preface">Preface</h2>
<p>This post documents the journey of extracting data from a locked hard drive, including the various detours I took along the way.</p>
<p>I previously bought an NTG55 head unit and installed it in a Mercedes-Benz E-Class.</p>
<p><img loading="lazy"  src="./NTG55.jpg"
        alt="NTG55"/></p>
<p>After opening the target device, you can see an automotive-grade HDD.</p>
<p>The drive specifications are as follows:
MQ01AAD032C
Serial ATA 2.6 / ATA8
3.0 Gbit/s , 1.5 Gbit/s
320 GB</p>
<p>The image below compares the HDD from an older head unit (right) with the newer one (left). &ldquo;New&rdquo; here refers to the NTG5.5 generation, though the technology has since advanced to NTG7.</p>
<p><img loading="lazy"  src="./hdd_compare.jpg"
        alt="hdd_compare"/></p>
<h2 id="exploration">Exploration</h2>
<p>This HDD complies with the SATA 2.6 standard. When I first connected it via a USB SATA enclosure, it failed to mount, leading me to suspect it had been damaged during shipping. In reality, this automotive-grade drive is surprisingly robust‚Äîit survived multiple impacts without issue.</p>
<p>Later, I connected it directly to a desktop PC. Upon booting, the BIOS reported that the drive was password-protected. I attempted various default and common passwords, but none were successful.</p>
<p>In Linux, I queried the drive information for two different models; the <code>Security</code> section reported <code>locked</code> for both.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ sudo hdparm -I /dev/sdb 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Toshiba
</span></span><span class="line"><span class="cl">ATA device, with non-removable media
</span></span><span class="line"><span class="cl">	Model Number:       TOSHIBA MQ01AAD032C
</span></span><span class="line"><span class="cl">	Serial Number:      46NHP01LT
</span></span><span class="line"><span class="cl">	Firmware Revision:  AK001Y  
</span></span><span class="line"><span class="cl">	Transport:          Serial, ATA8-AST, SATA 1.0a, SATA II Extensions, SATA Rev 2.5, SATA Rev 2.6
</span></span><span class="line"><span class="cl">Standards:
</span></span><span class="line"><span class="cl">	Supported: 8 7 6 5 
</span></span><span class="line"><span class="cl">	Likely used: 8
</span></span><span class="line"><span class="cl">Security: 
</span></span><span class="line"><span class="cl">	Master password revision code = 7
</span></span><span class="line"><span class="cl">		supported
</span></span><span class="line"><span class="cl">		enabled
</span></span><span class="line"><span class="cl">		locked
</span></span><span class="line"><span class="cl">	not	frozen
</span></span><span class="line"><span class="cl">	not	expired: security count
</span></span><span class="line"><span class="cl">		supported: enhanced erase
</span></span><span class="line"><span class="cl">	Security level high
</span></span><span class="line"><span class="cl">	116min for SECURITY ERASE UNIT. 116min for ENHANCED SECURITY ERASE UNIT.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Hitachi
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ATA device, with non-removable media
</span></span><span class="line"><span class="cl">	Model Number:       HGST HEJ423232H9E300                    
</span></span><span class="line"><span class="cl">	Serial Number:      F63001FNJ7W93L
</span></span><span class="line"><span class="cl">	Firmware Revision:  F6BOA200
</span></span><span class="line"><span class="cl">	Transport:          Serial, ATA8-AST, SATA 1.0a, SATA II Extensions, SATA Rev 2.5, SATA Rev 2.6; Revision: ATA8-AST T13 Project D1697 Revision 0b
</span></span><span class="line"><span class="cl">Security: 
</span></span><span class="line"><span class="cl">	Master password revision code = 7
</span></span><span class="line"><span class="cl">		supported
</span></span><span class="line"><span class="cl">		enabled
</span></span><span class="line"><span class="cl">		locked
</span></span><span class="line"><span class="cl">	not	frozen
</span></span><span class="line"><span class="cl">	not	expired: security count
</span></span><span class="line"><span class="cl">		supported: enhanced erase
</span></span><span class="line"><span class="cl">	Security level high
</span></span><span class="line"><span class="cl">	104min for SECURITY ERASE UNIT. 106min for ENHANCED SECURITY ERASE UNIT.
</span></span></code></pre></div><p>At the time, lacking a hardware background, I found this task extremely daunting. I even reached out to data recovery companies, but none were able to assist.</p>
<p>Online information was scarce, and I couldn&rsquo;t find practical resources on unlocking SATA drives. While some techniques exist for sniffing IDE signals to recover passwords, this drive uses the SATA interface.</p>
<p>Reference:
<a href="https://shackspace.de/2011/04/27/open-sesame-harddrive-password-hacking-with-a-openbench-logic-sniffer/"target="_blank" rel="noopener noreferrer">Open Sesame: Harddrive Password Hacking with a OpenBench Logic Sniffer</a></p>
<p>I considered sniffing the SATA bus, but the high speeds involved made it impractical. Implementing a sniffer with an FPGA would have been too costly in terms of both time and money, so I abandoned that approach.</p>
<p>Reference:<br>
<a href="https://www.dstchina.cn/news-578-53.html"target="_blank" rel="noopener noreferrer">Hard disk data recovery technology SATA interface implementation technology (I)</a></p>
<p>I disassembled the HDD to identify its key components:</p>
<pre tabindex="0"><code>MCUÔºö88i8317-RAI2
DDRÔºöWinbond 4MB
FlashÔºöMXIC MX25V4006EZNI 512K
HDD Motor Combo IC: TLS2605
</code></pre><p><img loading="lazy"  src="./board.jpg"
        alt="board"/></p>
<p><img loading="lazy"  src="./read_flash.jpg"
        alt="read_flash"/></p>
<p>Subsequently, I desoldered the internal Flash chip and dumped the firmware. Since the BIOS allows unlocking via keyboard input, I hypothesized the password might be stored as a plain string, but I failed to find any suspicious text. (As it turned out, the password consists of non-ASCII bytes.)
I proceeded to dump the firmware from two Hitachi drives for comparison. If the security mechanism relied on a unique per-device password and a simple comparison check, recovery might have been possible. (In reality, the password is identical across devices.)</p>
<p><img loading="lazy"  src="./hdd_compare.png"
        alt="hdd_compare"/></p>
<p>Although the firmware consists of ARM instructions, my skills in embedded reverse engineering were limited at the time, and I had no prior experience with HDD firmware source code, so I hit a wall.</p>
<p>I attempted to locate a debug interface. I had seen others debug HDD firmware via JTAG to bypass authentication, but no public documentation existed for this MCU. Lacking a JTAGulator, I was forced to abandon this path as well.</p>
<p>References:</p>
<p><a href="https://www.malwaretech.com/2015/04/hard-disk-firmware-hacking-part-1.html"target="_blank" rel="noopener noreferrer">Hard Disk Firmware Hacking (Part 1)</a></p>
<p><a href="https://www.malwaretech.com/2015/04/hard-disk-firmware-hacking-part-2.html"target="_blank" rel="noopener noreferrer">Hard Disk Firmware Hacking (Part 2)</a></p>
<p>Another viable strategy is to allow the head unit to unlock the drive, and then‚Äîwithout powering down‚Äîtransfer the drive to a PC. The unlock key remains active in the HDD&rsquo;s RAM, granting direct access. I only discovered this technique after I had already succeeded in unlocking it.</p>
<p>Reference:
<a href="https://www.ru.nl/publish/pages/909275/draft-paper_1.pdf"target="_blank" rel="noopener noreferrer">Self-encrypting deception: weaknesses in the encryption of solid state drives (SSDs)</a></p>
<p>I reviewed the ATA/SATA 2.6 specification but found no details regarding an unlock password, leading me to suspect it was a vendor-specific feature of the drive controller. A deeper dive into the HDD documentation finally revealed relevant information.</p>
<p>The password is 32 bytes long. My analysis of the bootloader revealed no relevant keys aside from the SD card key.
The <code>0xF2</code> command serves as a promising entry point for reverse engineering. It is useful whether you are dynamically debugging the MCU via JTAG or analyzing the HDD driver.</p>
<p><img loading="lazy"  src="./HDD_unlock.png"
        alt="HDD_unlock"/></p>
<h2 id="decryption-process">Decryption process</h2>
<p>The head unit‚Äôs bootloader generally does not perform the HDD unlock. Rather, after the bootloader decrypts the WinCE image, the ATA driver sends the <code>0xF2</code> command to unlock the drive. (This implies that the HDD contents are not critical for the initial boot process.)</p>
<p>Since the system image was already decrypted, I analyzed the driver files directly.</p>
<p><img loading="lazy"  src="./ida1.png"
        alt="ida1"/></p>
<p>The raw passwords are listed below. A search revealed that someone had already recovered them using a logic analyzer back in 2014. (Note: NTG4 uses an IDE interface).
<a href="https://www.motor-talk.de/blogs/d-info/ntg4-und-ntg4-5-festplatte-einsehen-clonen-aendern-t4962617.html"target="_blank" rel="noopener noreferrer">NTG4 und NTG4.5 Festplatte Einsehen, Clonen, √Ñndern</a></p>
<pre tabindex="0"><code>MELCO SANDA NTG55HUH Navi Master
MELCO SANDA NTG55HUH Navi User
</code></pre><p><img loading="lazy"  src="./ida2.png"
        alt="ida2"/></p>
<p>The decoding logic is straightforward. (At the time, I simplified the process by emulating the code. Upon closer inspection, Hex-Rays F5 decompiler output was slightly inaccurate; the actual assembly for the transcoding is only 4 lines.)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="s1">&#39;MELCO SANDA NTG55HUH Navi Master&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="mh">0xff</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">()</span>
</span></span></code></pre></div><p><strong>Note:</strong> MELCO refers to Mitsubishi Electric, and SANDA refers to Mita Manufacturing. The HU55 is manufactured by Mitsubishi Electric. They are extremely meticulous‚Äîeven minor security issues can trigger late-night emergency meetings. Consequently, this device employs bootloader encryption, an SD card lock, an HDD lock, and a self-destruct-style secure boot mechanism.</p>
<p>Next, use these commands to unlock the HDD:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># MASTER PASS</span>
</span></span><span class="line"><span class="cl">sudo hdparm --user-master m --security-unlock <span class="k">$(</span><span class="nb">printf</span> <span class="s1">&#39;\xb2\xba\xb3\xbc\xb0\xdf\xac\xbe\xb1\xbb\xbe\xdf\xb1\xab\xb8\xca\xca\xb7\xaa\xb7\xdf\xb1\x9e\x89\x96\xdf\xb2\x9e\x8c\x8b\x9a\x8d&#39;</span><span class="k">)</span> /dev/sdb
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># USER PASS</span>
</span></span><span class="line"><span class="cl">sudo hdparm --user-master u --security-unlock <span class="k">$(</span><span class="nb">printf</span> <span class="s1">&#39;\xb2\xba\xb3\xbc\xb0\xdf\xac\xbe\xb1\xbb\xbe\xdf\xb1\xab\xb8\xca\xca\xb7\xaa\xb7\xdf\xb1\x9e\x89\x96\xdf\xaa\x8c\x9a\x8d\xdf\xdf&#39;</span><span class="k">)</span> /dev/sdb
</span></span></code></pre></div><p>Upon executing these commands, the partitions became visible. They contained map data. Since the older device had limited performance, it likely used redundant map data to optimize speed. In the newer NTG65, the HDD was replaced by a high-capacity eMMC, rendering such a large mechanical drive unnecessary.</p>
<pre tabindex="0"><code>Disk /dev/sdb: 298.1 GiB, 320072933376 bytes, 625142448 sectors
Disk model: TOSHIBA MQ01AAD0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disklabel type: dos
Disk identifier: 0x17192a08

Device     Boot     Start       End   Sectors   Size Id Type
/dev/sdb1           36864  31494143  31457280    15G  c W95 FAT32 (LBA)
/dev/sdb2        31494144 195071999 163577856    78G  c W95 FAT32 (LBA)
/dev/sdb3       195072000 358649855 163577856    78G  c W95 FAT32 (LBA)
/dev/sdb4       358649856 625137344 266487489 127.1G  f W95 Ext&#39;d (LBA)
/dev/sdb5       358651904 503355391 144703488    69G  b W95 FAT32
/dev/sdb6       503357440 545300479  41943040    20G  b W95 FAT32
/dev/sdb7       545302528 576759807  31457280    15G  b W95 FAT32
/dev/sdb8       576761856 578207743   1445888   706M  b W95 FAT32
/dev/sdb9       578209792 592889855  14680064     7G  b W95 FAT32
/dev/sdb10      592891904 597086207   4194304     2G  b W95 FAT32
/dev/sdb11      597088256 603379711   6291456     3G  b W95 FAT32
/dev/sdb12      603381760 609673215   6291456     3G  b W95 FAT32
/dev/sdb13      609675264 625135615  15460352   7.4G  b W95 FAT32
</code></pre><h2 id="related-links">Related links</h2>
<p><a href="https://shackspace.de/2011/04/27/open-sesame-harddrive-password-hacking-with-a-openbench-logic-sniffer/"target="_blank" rel="noopener noreferrer">Open Sesame: Harddrive Password Hacking with a OpenBench Logic Sniffer</a></p>
<p><a href="./Toshiba_2.5_disk_product_specification.pdf">Toshiba_2.5_disk_product_specification.pdf</a></p>
<p><a href="./SerialATA_Revision_2_6_Gold.pdf">SerialATA_Revision_2_6_Gold.pdf</a></p>
<p><a href="https://www.malwaretech.com/2015/04/hard-disk-firmware-hacking-part-1.html"target="_blank" rel="noopener noreferrer">Hard Disk Firmware Hacking (Part 1)</a></p>
<p><a href="https://www.malwaretech.com/2015/04/hard-disk-firmware-hacking-part-2.html"target="_blank" rel="noopener noreferrer">Hard Disk Firmware Hacking (Part 2)</a></p>
<p><a href="https://www.ru.nl/publish/pages/909275/draft-paper_1.pdf"target="_blank" rel="noopener noreferrer">Self-encrypting deception: weaknesses in the encryption of solid state drives (SSDs)</a></p>
<p><a href="https://www.motor-talk.de/blogs/d-info/ntg4-und-ntg4-5-festplatte-einsehen-clonen-aendern-t4962617.html"target="_blank" rel="noopener noreferrer">NTG4 und NTG4.5 Festplatte Einsehen, Clonen, √Ñndern</a></p>
<p><a href="http://www.dstchina.cn/news-557-53.html"target="_blank" rel="noopener noreferrer">Geek Notes: SATA protocol analysis (Part 1)</a></p>
<p><a href="http://www.dstchina.cn/news-562-53.html"target="_blank" rel="noopener noreferrer">Geek Notes: SATA protocol analysis (Part 2)</a></p>
<p><a href="http://www.dstchina.cn/news-570-53.html"target="_blank" rel="noopener noreferrer">Geek Notes: SATA protocol analysis (Part 3)</a></p>
<p><a href="http://www.dstchina.cn/news-577-53.html"target="_blank" rel="noopener noreferrer">Geek Notes: SATA protocol analysis (Part 4)</a></p>
<p><a href="http://www.dstchina.cn/news-577-53.html"target="_blank" rel="noopener noreferrer">Geek Notes: SATA protocol analysis (Part 5)</a></p>
</article><section class="article labels"><a class="category" href=/en/categories/firmware-extraction-series/>Firmware Extraction Series</a><a class="tag" href=/en/tags/ntg64/>NTG64</a><a class="tag" href=/en/tags/sata/>SATA</a><a class="tag" href=/en/tags/unlock/>unlock</a><a class="tag" href=/en/tags/hdd/>HDD</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/en/posts/firmware-extraction-series-read-flash-with-flashrom/"><span class="iconfont icon-article"></span>Firmware Extraction Series: Reading Flash with flashrom</a></p><p><a class="link" href="/en/posts/firmware-extraction-series-rawnand-file-recovery/"><span class="iconfont icon-article"></span>Firmware Extraction Series - Raw NAND File Recovery</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (Attribution-NonCommercial-ShareAlike).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>