<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.147.8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="
起因
我的Nexus 5用了两年，电池也是越来越尿崩，从一天一充到一天三充。出门在外，接上充电宝使用，越充越少。结果没电关机，自己失联了好几次，耽误了很多事情。
"><title>五太子不能退休，快当我的备用机！&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.63f706677e61b4ee62b8daf083358d3bbf8ac8ab03c7d171af3180fab3a3ebb83efb79fb98674f13dde6db11de2bf694.css" integrity="sha384-Y/cGZ35htO5iuNrwgzWNO7&#43;KyKsDx9FxrzGA&#43;rOj67g&#43;&#43;3n7mGdPE93m2xHeK/aU"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="五太子不能退休，快当我的备用机！" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a><a class="nav item" href="/about">About</a><a class="nav item" href="/links">Links</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">五太子不能退休，快当我的备用机！</h1><p class="article date">Saturday, October 8, 2016</p></section><article class="article markdown-body"><hr>
<h2 id="起因">起因</h2>
<p>我的Nexus 5用了两年，电池也是越来越尿崩，从一天一充到一天三充。出门在外，接上充电宝使用，越充越少。结果没电关机，自己失联了好几次，耽误了很多事情。
<img loading="lazy"  src="./%e5%ba%95%e9%83%a8.jpg"
        alt=""/></p>
<p>于是入手了Nubia Z11，2.5D玻璃屏幕，看起来几乎没有边框，外观漂亮，性能也不错，续航还行，快充，适合日常使用。
<img loading="lazy"  src="./%e6%ad%a3%e9%9d%a2.jpg"
        alt=""/></p>
<p><img loading="lazy"  src="./%e8%83%8c%e9%9d%a2.jpg"
        alt=""/></p>
<p><img loading="lazy"  src="./%e4%ba%ae%e5%b1%8f.jpg"
        alt=""/></p>
<p>Nexus 5闲置之后，待机居然能超过一个星期，终于找到电池尿崩的原因了，装的东西太多。
以前的手机同时跑telegram，GAPPS，QQ，微信，支付宝，美团，闲鱼等耗电大户，还运行着XP框架，Shadowsocks，不尿崩才怪呢。
于是这一次打算分开使用，Nexus 5作为工作机，Nubia Z11作为生活机。</p>
<p>另外用和我名字一样的人的信息在网上办了一张手机卡，却发现现在要实名了，手持身份证不说，还要身份证和电话卡包装合照。
这个难度就大了，看了一下实名验证的网站，使用的是二次开发的xxshop，前台作为商城，可以购买电话卡，后台有审核实名用户的功能。</p>
<p><img loading="lazy"  src="./xxshop.png"
        alt="xxshop"/></p>
<p>用户上传的照片会用随机字符串重命名，并且知道图片上传的目录，想获取那些用户的照片可行的，可以穷举，难度比较大。
还有一个办法就是找漏洞，但是这个平台经过高度定制，并没有那么简单找到，而且花时间在这个地方也没多大意义，就没有继续。</p>
<h2 id="折腾">折腾</h2>
<h3 id="从零开始">从零开始</h3>
<p>开始折腾我的备用机，首先刷回官方的固件。<a href="https://developers.google.com/android/nexus/images"target="_blank" rel="noopener noreferrer">谷歌原厂镜像</a>
然后进fastboot刷入TWRP的recovery，再进入REC刷SuperSU。</p>
<h3 id="装装装">装装装</h3>
<p>进入系统后，安装自己的梯子，还有最重要的<a href="http://www.coolapk.com/apk/com.coolapk.market"target="_blank" rel="noopener noreferrer">酷市场</a>
必备</p>
<ul>
<li><a href="http://www.coolapk.com/apk/com.wuxianlin.xposedinstaller"target="_blank" rel="noopener noreferrer">Xposed安装器</a></li>
<li><a href="http://www.coolapk.com/apk/com.ceco.marshmallow.gravitybox"target="_blank" rel="noopener noreferrer">GravityBox</a></li>
<li><a href="http://www.coolapk.com/apk/com.oasisfeng.greenify"target="_blank" rel="noopener noreferrer">Greenify</a></li>
<li><a href="http://www.coolapk.com/apk/com.speedsoftware.rootexplorer"target="_blank" rel="noopener noreferrer">Root Explorer</a></li>
</ul>
<p>因为我的电源键失灵，经常是按住的状态，导致关机或者不停重启，可以看到插卡处也裂了（很多人的手机这里都裂了），我只好把它拆了。
<img loading="lazy"  src="./%e8%8f%8a%e8%8a%b1%e8%a3%82-1024x768.jpg"
        alt=""/></p>
<p>在GravityBox里把音量键换成电源键，双击虚拟home健熄屏，设置听歌时不能调音量，这样听歌时也能唤醒手机了。</p>
<p>Nethunter自带的就不说了，这里推荐几个不错的应用</p>
<ul>
<li><a href="https://www.zimperium.com/zanti-mobile-penetration-testing"target="_blank" rel="noopener noreferrer">zANTI</a>，中间人攻击</li>
<li><a href="http://www.coolapk.com/apk/com.rcreations.WebCamViewerPaid"target="_blank" rel="noopener noreferrer">IP Cam Viewer</a>，监控某些人</li>
<li><a href="http://www.coolapk.com/apk/app.greyshirts.sslcapture"target="_blank" rel="noopener noreferrer">Packet Capture</a>，免Root抓包</li>
<li><a href="https://play.google.com/store/apps/details?id=cz.hipercalc.pro&amp;hl=en"target="_blank" rel="noopener noreferrer">HiPER Calc Pro</a>，功能强大的计算器</li>
<li><a href="https://play.google.com/store/apps/details?id=com.wmspanel.larix_broadcaster&amp;hl=en"target="_blank" rel="noopener noreferrer">Larix Broadcaster</a>，推流直播软件</li>
<li><a href="https://play.google.com/store/apps/details?id=com.aor.droidedit.pro&amp;hl=en"target="_blank" rel="noopener noreferrer">DroidEdit</a>，安卓上的Sublime,比Jota+好用</li>
<li><a href="https://play.google.com/store/apps/details?id=com.realvnc.viewer.android&amp;hl=en"target="_blank" rel="noopener noreferrer">VNC Viewer</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.microsoft.rdc.android&amp;hl=en"target="_blank" rel="noopener noreferrer">Microsoft Remote Desktop</a>，两款远程桌面应用</li>
</ul>
<p>我是Archlinux用户，使用KDE，于是我安装了KDE Connect桌面端和<a href="http://www.coolapk.com/apk/org.kde.kdeconnect_tp"target="_blank" rel="noopener noreferrer">移动端</a>，作为手机与电脑的无线连接工具。
<img loading="lazy"  src="./KDEC%e6%a1%8c%e9%9d%a2%e7%ab%af.png"
        alt=""/></p>
<p><img loading="lazy"  src="./KDEC%e7%a7%bb%e5%8a%a8%e7%ab%af.jpg"
        alt=""/></p>
<p>最后刷入Kali Nethunter。
去年写过一篇笔记，<a href="https://blog.gorgiaxx.com/2015/08/kali-nethunter%E5%88%9D%E5%AD%A6%E7%AC%94%E8%AE%B0/"target="_blank" rel="noopener noreferrer">Kali Nethunter尝鲜</a>但是不适用于现在了。</p>
<h3 id="postgresql无法启动">postgresql无法启动</h3>
<p>我安装完Nethunter，发现postgresql服务不能启动</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@kali:~# service postgresql start
</span></span><span class="line"><span class="cl"><span class="o">[</span>....<span class="o">]</span> Starting PostgreSQL 9.4 database server: main<span class="o">[</span>....<span class="o">]</span> The PostgreSQL server failed to start. Please check the log output: 2016-10-08 12:18:03 UTC <span class="o">[</span>5618-1<span class="o">]</span> FATAL: could not create shared memory segment: Function not implemented 2016-10-08 12:18:03 UTC <span class="o">[</span>561<span class="o">[</span>FAILDETAIL: Failed system call was shmget<span class="o">(</span><span class="nv">key</span><span class="o">=</span>5432001, <span class="nv">size</span><span class="o">=</span>40, 03600<span class="o">)</span>. ... failed!
</span></span></code></pre></div><p>使用shmget函数出错，发现是共享内存这里有问题。初步判断可能是设置的值过小。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@kali:~# cat /proc/sys/kernel/shmmax
</span></span><span class="line"><span class="cl">cat: /proc/sys/kernel/shmmax: No such file or directory
</span></span></code></pre></div><p>查看一下内核中发现并不存在这个属性，这就尴尬了，于是不断Google，终于在<a href="https://github.com/offensive-security/kali-nethunter/issues/530"target="_blank" rel="noopener noreferrer">Offensive Security 的 Github Issues</a>上面看到了同样的情况。他们已经Patch了，但是官网上面的还是没变，需要自行打包。</p>
<p>那么我就开始打包吧，其实不是Nexus5也能刷入Nethunter
参照<a href="https://github.com/offensive-security/kali-nethunter/wiki/Building-Nethunter"target="_blank" rel="noopener noreferrer">官方Wiki</a>，一步一步操作
下载Nethunter源文件，进入目录。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/offensive-security/kali-nethunter
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> kali-nethunter/nethunter-installer
</span></span></code></pre></div><p>这里只能用Python2构建包，查看说明后，运行如下命令，参数大概是Nexus5的代号hammerhead，目标系统marshmallow，仅打包Kernel。
因为我已经装过一遍了，所以这次只打包内核，再加一个自定义版本就叫RBQ吧！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gorgias@3vil ~/g/k/nethunter-installer<span class="p">&amp;</span>gt<span class="p">;</span> python2 build.py -d hammerhead -m -k -r RBQ
</span></span><span class="line"><span class="cl">Kernel: Copying common files...
</span></span><span class="line"><span class="cl">Kernel: Copying armhf arch specific common files...
</span></span><span class="line"><span class="cl">Kernel: Copying boot-patcher files...
</span></span><span class="line"><span class="cl">Kernel: Copying armhf arch specific boot-patcher files...
</span></span><span class="line"><span class="cl">Kernel: Configuring installer script <span class="k">for</span> hammerhead
</span></span><span class="line"><span class="cl">Kernel: Configuring boot-patcher script <span class="k">for</span> hammerhead
</span></span><span class="line"><span class="cl">Found kernel image at: devices/marshmallow/hammerhead/zImage-dtb
</span></span><span class="line"><span class="cl">Creating ZIP file: kernel-nethunter-hammerhead-marshmallow-RBQ.zip
</span></span><span class="line"><span class="cl">Added: zImage-dtb
</span></span><span class="line"><span class="cl">Added: boot-patcher.sh
</span></span><span class="line"><span class="cl">Added: env.sh
</span></span><span class="line"><span class="cl">Added: patch.d-env
</span></span><span class="line"><span class="cl">Added: META-INF/com/google/android/update-binary
</span></span><span class="line"><span class="cl">Added: META-INF/com/google/android/updater-script
</span></span><span class="line"><span class="cl">Added: ramdisk-patch/init.nethunter.rc
</span></span><span class="line"><span class="cl">Added: ramdisk-patch/sbin/dvmediarevert
</span></span><span class="line"><span class="cl">Added: ramdisk-patch/sbin/media_profiles.xml
</span></span><span class="line"><span class="cl">Added: ramdisk-patch/sbin/dvbootscript.sh
</span></span><span class="line"><span class="cl">Added: ramdisk-patch/sbin/hostapd
</span></span><span class="line"><span class="cl">Added: tools/busybox
</span></span><span class="line"><span class="cl">Added: tools/unpackbootimg
</span></span><span class="line"><span class="cl">Added: tools/freespace.sh
</span></span><span class="line"><span class="cl">Added: tools/installbusybox.sh
</span></span><span class="line"><span class="cl">Added: tools/mkbootimg
</span></span><span class="line"><span class="cl">Added: tools/lz4
</span></span><span class="line"><span class="cl">Added: patch.d/01-ramdisk-patch
</span></span><span class="line"><span class="cl">Added: patch.d/02-no-verity-opt-encrypt
</span></span><span class="line"><span class="cl">Added: system/xbin/hid-keyboard
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/htc_9271.fw
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/ar9170-1.fw
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/ar9170-2.fw
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rt2870.bin
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rt3070.bin
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rt73.bin
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rt2561.bin
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rt2860.bin
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/htc_7010.fw
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/carl9170-1.fw
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211_ub
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211b_uph
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211_ur
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211b_uphm
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211b_ur
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211_uph
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211_uphr
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211_uphm
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211b_uphr
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/zd1211/zd1211b_ub
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rtlwifi/rtl8192cufw.bin
</span></span><span class="line"><span class="cl">Added: system/etc/firmware/rtlwifi/rtl8188efw.bin
</span></span><span class="line"><span class="cl">Created kernel installer: kernel-nethunter-hammerhead-marshmallow-RBQ.zip
</span></span></code></pre></div><p>打包完成后会在目录下生成文件，通过KDE Connect传入到手机，重启进入REC刷入。大功告成！！
<img loading="lazy"  src="./%e5%a4%a7%e5%8a%9f%e5%91%8a%e6%88%90.png"
        alt=""/></p>
<p>最新的Nethunter使用的是kali-rolling源，如果更新源或者下载包失败的话，请把源更改为</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">deb http://http.kali.org/kali kali-rolling main contrib non-free
</span></span><span class="line"><span class="cl">deb-src http://http.kali.org/kali kali-rolling main contrib non-free
</span></span></code></pre></div></article><section class="article labels"><a class="category" href=/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/>网络安全</a><a class="category" href=/categories/%E6%8A%98%E8%85%BE/>折腾</a><a class="tag" href=/tags/kali/>kali</a><a class="tag" href=/tags/nethunter/>nethunter</a><a class="tag" href=/tags/%E5%A4%87%E7%94%A8%E6%9C%BA/>备用机</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/posts/arch-linux%E4%B8%8A%E4%BD%BF%E7%94%A8acr122u%E7%A0%B4%E8%A7%A3%E9%B2%9C%E5%A5%B6%E5%8D%A1/"><span class="iconfont icon-article"></span>Arch Linux上使用ACR122U破解鲜奶卡</a></p><p><a class="link" href="/posts/%E8%81%94%E6%83%B3y410p-bios-%E6%8B%AF%E6%95%91%E7%AC%94%E8%AE%B0/"><span class="iconfont icon-article"></span>联想Y410p BIOS 拯救笔记</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2025 Gorgias' Blog. </p>
    <p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>