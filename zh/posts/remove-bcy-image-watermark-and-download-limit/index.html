<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="å‰è¨€
æœ€è¿‘åƒé¥­çš„æ—¶å€™éƒ½åœ¨åˆ·åŠæ¬¡å…ƒï¼ŒCosplayåŒºå¤ªå¤šæ¼‚äº®çš„å°å§å§ï¼Œå¯æƒœå›¾ç‰‡åŠ äº†æ°´å°ï¼Œå¹¶ä¸”æœ‰çš„å›¾ç‰‡ä¸å…è®¸ä¸‹è½½ï¼Œä¸èƒ½æ–¹ä¾¿éšæ—¶æ¬£èµï¼Œå¤ªç…å¿ƒæƒ…äº†ã€‚
æœ€è¿‘ç»å¸¸è½¬å‘æ¼‚äº®çš„å°å§å§ç»™æœ‹å‹ä»¬ï¼Œä½†æ˜¯å¸¦äº†æ°´å°ï¼Œè¢«å¤§å®¶å‘ç°æˆ‘æ²‰è¿·åŠæ¬¡å…ƒäº†ã€‚å¾ˆæ˜¯å›°æ‰°ï¼Œæ‰“ç®—ç»•è¿‡è¿™äº›é™åˆ¶ã€‚"><title>å»é™¤åŠæ¬¡å…ƒå›¾ç‰‡æ°´å°å’Œä¸‹è½½é™åˆ¶&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="å»é™¤åŠæ¬¡å…ƒå›¾ç‰‡æ°´å°å’Œä¸‹è½½é™åˆ¶" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/zh/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/zh/categories/">åˆ†ç±»</a><a class="nav item" href="/zh/tags/">æ ‡ç­¾</a><a class="nav item" href="/zh/about/">å…³äº</a><a class="nav item" href="/zh/links/">å‹é“¾</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">å»é™¤åŠæ¬¡å…ƒå›¾ç‰‡æ°´å°å’Œä¸‹è½½é™åˆ¶</h1><p class="article date">Monday, July 30, 2018<span class="langs"><span class="lang">
                    <a href="/en/posts/remove-bcy-image-watermark-and-download-limit/" title="English">
                        <span class="lang-icon">ğŸŒ</span>English</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘åƒé¥­çš„æ—¶å€™éƒ½åœ¨åˆ·åŠæ¬¡å…ƒï¼ŒCosplayåŒºå¤ªå¤šæ¼‚äº®çš„å°å§å§ï¼Œå¯æƒœå›¾ç‰‡åŠ äº†æ°´å°ï¼Œå¹¶ä¸”æœ‰çš„å›¾ç‰‡ä¸å…è®¸ä¸‹è½½ï¼Œä¸èƒ½æ–¹ä¾¿éšæ—¶æ¬£èµï¼Œå¤ªç…å¿ƒæƒ…äº†ã€‚
æœ€è¿‘ç»å¸¸è½¬å‘æ¼‚äº®çš„å°å§å§ç»™æœ‹å‹ä»¬ï¼Œä½†æ˜¯å¸¦äº†æ°´å°ï¼Œè¢«å¤§å®¶å‘ç°æˆ‘æ²‰è¿·åŠæ¬¡å…ƒäº†ã€‚å¾ˆæ˜¯å›°æ‰°ï¼Œæ‰“ç®—ç»•è¿‡è¿™äº›é™åˆ¶ã€‚</p>
<h2 id="æŠ“åŒ…åˆ†æ">æŠ“åŒ…åˆ†æ</h2>
<p>åŠæ¬¡å…ƒä½¿ç”¨äº†HTTPSé€šä¿¡ï¼Œä»¥åŠä½¿ç”¨äº†è¯ä¹¦ç»‘å®šï¼ˆHPKPï¼‰ï¼Œé€šè¿‡ä½¿ç”¨Xposedæ¡†æ¶çš„JustTrustMeæ’ä»¶ï¼Œå¯ä»¥ç»•è¿‡è¯ä¹¦éªŒè¯ã€‚</p>
<p>äºæ˜¯ä½¿ç”¨BurpSuiteæŠ“åŒ…ã€‚</p>
<p><img loading="lazy"  src="burp.png"
        alt="burp"/></p>
<p>åˆ†æResponseå¯ä»¥å¾—çŸ¥ï¼Œdownloadä¸ºfalseæ˜¯ç¦æ­¢ä¸‹è½½çš„æ ‡è¯†ã€‚å›¾ç‰‡çš„è·¯å¾„æ·»åŠ äº†imageMogr2åç¼€ï¼Œå³ä¸ƒç‰›äº‘çš„é«˜çº§å›¾ç‰‡å¤„ç†ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå†…å®¹éƒ½æ˜¯å†™æ­»åœ¨HTTPå“åº”é‡Œçš„ï¼Œæ‰€ä»¥åªhookå“åº”å†…å®¹ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ã€‚</p>
<p><img loading="lazy"  src="imageMogr2.png"
        alt="imageMogr2"/></p>
<h2 id="åˆ†æä»£ç é€»è¾‘">åˆ†æä»£ç é€»è¾‘</h2>
<p><img loading="lazy"  src="volley.png"
        alt="volley"/></p>
<p>ä½¿ç”¨JADX-GUIæ‰“å¼€åŠæ¬¡å…ƒçš„APKï¼Œå‘ç°ä»£ç è¢«æ··æ·†ï¼Œç½‘ç»œè¯·æ±‚ä½¿ç”¨äº†Volleyæ¡†æ¶ã€‚</p>
<p>æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œå®ç°ä¸€ä¸ªè¯·æ±‚éœ€è¦è®¾ç½®RequestQueueï¼Œç„¶åä½¿ç”¨onResponseå¤„ç†å“åº”äº‹ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">RequestQueue</span><span class="w"> </span><span class="n">mRequestQueue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Instantiate the cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Cache</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DiskBasedCache</span><span class="p">(</span><span class="n">getCacheDir</span><span class="p">(),</span><span class="w"> </span><span class="n">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">1024</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1MB cap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Set up the network to use HttpURLConnection as the HTTP client.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Network</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BasicNetwork</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HurlStack</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Instantiate the RequestQueue with the cache and network.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">mRequestQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RequestQueue</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">network</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Start the queue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">mRequestQueue</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="s">&#34;http://www.example.com&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Formulate the request and handle the response.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">StringRequest</span><span class="w"> </span><span class="n">stringRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">Listener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onResponse</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Do something with the response</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ErrorListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onErrorResponse</span><span class="p">(</span><span class="n">VolleyError</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Handle error</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Add the request to the RequestQueue.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">mRequestQueue</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">stringRequest</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// ...</span><span class="w">
</span></span></span></code></pre></div><p>æ ¹æ®æŠ“åŒ…çš„ç»“æœï¼Œå¯ä»¥æå–å‡ºä¸‹åˆ—å…³é”®è¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">image/postCover
</span></span><span class="line"><span class="cl">download
</span></span><span class="line"><span class="cl">multi
</span></span><span class="line"><span class="cl">path
</span></span></code></pre></div><p>åœ¨è¿™é‡Œä»¥URLä¸­çš„<code>image/postCover</code>ä¸ºå…³é”®è¯ï¼Œå…¨å±€æœç´¢ï¼Œè¢«å°è£…åœ¨m1750bæ–¹æ³•é‡Œã€‚ç„¶åæ‰¾åˆ°è°ƒç”¨å®ƒçš„ä»£ç ã€‚</p>
<p><img loading="lazy"  src="key_string.png"
        alt="key_string"/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">m6896a</span><span class="p">(</span><span class="n">DetailType</span><span class="w"> </span><span class="n">detailType</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">C2271b</span><span class="w"> </span><span class="n">c2271b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">detailType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6216a</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// image/postCover å­—ç¬¦ä¸²æ‹¼æ¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpUtils</span><span class="p">.</span><span class="na">f7520b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">C0701m</span><span class="p">.</span><span class="na">m1750b</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">List</span><span class="w"> </span><span class="n">arrayList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">arrayList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">C2753c</span><span class="p">(</span><span class="s">&#34;session_key&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">C0766a</span><span class="p">.</span><span class="na">m2185b</span><span class="p">(</span><span class="n">context</span><span class="p">).</span><span class="na">getToken</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">arrayList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">C2753c</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">detailType</span><span class="p">.</span><span class="na">getItem_id</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">arrayList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">C2753c</span><span class="p">(</span><span class="s">&#34;type&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">detailType</span><span class="p">.</span><span class="na">getType</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">f6217b</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">C2764l</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">HttpUtils</span><span class="p">.</span><span class="na">m8132a</span><span class="p">(</span><span class="n">arrayList</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Listener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="cm">/* renamed from: c */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="cm">/* synthetic */</span><span class="w"> </span><span class="n">C2296a</span><span class="w"> </span><span class="n">f6186c</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="cm">/* synthetic */</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onResponse</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">m6855a</span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="cm">/* renamed from: a */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">m6855a</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// åˆ¤æ–­ status æ˜¯å¦ä¸º1ï¼Œå¦‚æœä¸º1åˆ™æ‰§è¡Œmo2699aã€‚</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">C2763k</span><span class="p">.</span><span class="na">m8211a</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">).</span><span class="na">booleanValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">c2271b</span><span class="p">.</span><span class="na">mo2699a</span><span class="p">(</span><span class="n">str</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">c2271b</span><span class="p">.</span><span class="na">mo2700b</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ErrorListener</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="cm">/* renamed from: b */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="cm">/* synthetic */</span><span class="w"> </span><span class="n">C2296a</span><span class="w"> </span><span class="n">f6188b</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onErrorResponse</span><span class="p">(</span><span class="n">VolleyError</span><span class="w"> </span><span class="n">volleyError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">c2271b</span><span class="p">.</span><span class="na">mo2700b</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨com.banciyuan.bcywebview.biz.picshow.ViewPictureActivity2è¿™ä¸ªç±»ä¸­ï¼Œæ‰¾åˆ°äº†åä¸ºmo2699açš„æ–¹æ³•ï¼Œä¸è¿‡è¿™é‡Œæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œä¸æ–¹ä¾¿ç¼–å†™hookä»£ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mo2523h</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">C2296a</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="na">m6896a</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">f6170i</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">C2271b</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/* renamed from: a */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="cm">/* synthetic */</span><span class="w"> </span><span class="n">ViewPictureActivity2</span><span class="w"> </span><span class="n">f6149a</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">f6149a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/* renamed from: a */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mo2699a</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSONObject</span><span class="p">(</span><span class="n">str</span><span class="p">).</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">f6149a</span><span class="p">.</span><span class="na">f6172k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">OrignPic</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Gson</span><span class="p">().</span><span class="na">fromJson</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">OrignPic</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">f6149a</span><span class="p">.</span><span class="na">m6848w</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">f6149a</span><span class="p">.</span><span class="na">m6847v</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/* renamed from: b */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mo2700b</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">f6149a</span><span class="p">.</span><span class="na">m6847v</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æƒ³æ›´ä¼˜é›…ä¸€ç‚¹ï¼Œç›´æ¥åœ¨è¦ä¸‹è½½çš„åœ°æ–¹hookï¼Œè€Œä¸æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½hookï¼Œå¾€ä¸‹ç¿»æ‰¾åˆ°m6849xæ–¹æ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">m6849x</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6171j</span><span class="p">.</span><span class="na">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Fragment</span><span class="w"> </span><span class="n">c2290a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">C2290a</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Bundle</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Bundle</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6172k</span><span class="p">.</span><span class="na">getMultis</span><span class="p">().</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m6832c</span><span class="p">(((</span><span class="n">Multi</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6172k</span><span class="p">.</span><span class="na">getMultis</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">getPath</span><span class="p">()).</span><span class="na">booleanValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">bundle</span><span class="p">.</span><span class="na">putBoolean</span><span class="p">(</span><span class="s">&#34;is_big&#34;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// å¯ä»¥çœ‹åˆ°åœ¨getMultisæ–¹æ³•åé¢å–å€¼ç„¶åæ¥ä¸Šäº†getPathæ–¹æ³•ï¼Œå’ŒæŠ“åŒ…è¿‡ç¨‹ä¸­çš„Responseå±‚çº§ä¸€è‡´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">f6171j</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">Multi</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6172k</span><span class="p">.</span><span class="na">getMultis</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">getPath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">f6164c</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6178q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">m6833c</span><span class="p">(</span><span class="n">8</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bundle</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&#34;path&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6171j</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bundle</span><span class="p">.</span><span class="na">putInt</span><span class="p">(</span><span class="s">&#34;index&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bundle</span><span class="p">.</span><span class="na">putSerializable</span><span class="p">(</span><span class="s">&#34;uname&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6180s</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bundle</span><span class="p">.</span><span class="na">putBoolean</span><span class="p">(</span><span class="s">&#34;water_mark&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6181t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">c2290a</span><span class="p">.</span><span class="na">setArguments</span><span class="p">(</span><span class="n">bundle</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">f6169h</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">c2290a</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">f6165d</span><span class="p">.</span><span class="na">setAdapter</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">C2282a</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">getSupportFragmentManager</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">f6165d</span><span class="p">.</span><span class="na">setCurrentItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">f6178q</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">f6179r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6171j</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">f6166e</span><span class="p">.</span><span class="na">setText</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="na">f6178q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">f6179r</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">f6166e</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¹¶ä¸æ˜¯ç”¨setPathè¿™ç§æ–¹å¼èµ‹å€¼ï¼Œè€Œæ˜¯å…ˆæ”¾å…¥ä¸€ä¸ªbundleå¯¹è±¡ä¸­ï¼Œå†æ‰¹é‡ç»™å±æ€§èµ‹å€¼ã€‚å¦‚æœåœ¨è¿™é‡Œhookï¼Œæ¯æ¬¡èµ‹å€¼éƒ½è¦åˆ¤æ–­ï¼Œä¼šéå¸¸ä¸ä¼˜é›…ã€‚
æ—¢ç„¶æœ‰getMultiså’ŒgetPathï¼Œé‚£ä¹ˆè‚¯å®šæœ‰åˆ¤æ–­æ˜¯å¦å…è®¸ä¸‹è½½çš„æ–¹æ³•ã€‚è¿˜æ˜¯å…¨å±€æœç´¢ï¼Œå‘ç°ä½¿ç”¨greenDAOè¿™ä¸ªORMæ¡†æ¶ï¼Œåœ¨de.greenrobot.daoexampleä¸‹é¢æ‰¾åˆ°äº†å…³é”®æ–¹æ³•ï¼Œåªè¦ä¿®æ”¹ä¸‹é¢æ–¹æ³•å°±èƒ½ç»•è¿‡é™åˆ¶ã€‚</p>
<p><img loading="lazy"  src="getpath.png"
        alt="getpath"/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">de.greenrobot.daoexample.model.Multi.getPath()
</span></span><span class="line"><span class="cl">de.greenrobot.daoexample.model.PostItem.getPath()
</span></span><span class="line"><span class="cl">de.greenrobot.daoexample.model.OrignPic.isDownload()
</span></span></code></pre></div><h2 id="frida-hook">Frida Hook</h2>
<p>å…ˆä½¿ç”¨FridaéªŒè¯ä¸€ä¸‹hookè¿™äº›æ–¹æ³•æ˜¯å¦å¯è¡Œï¼Œè¿™å°ç”µè„‘è¿˜æ²¡è£…Fridaï¼Œå…ˆå®‰è£…ä¸€ä¸‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo pip install frida-tools
</span></span><span class="line"><span class="cl">wget https://github.com/frida/frida/releases/download/12.0.7/frida-server-12.0.7-android-arm64.xz
</span></span><span class="line"><span class="cl">xz -d frida-server-12.0.7-android-arm64.xz
</span></span></code></pre></div><p>åœ¨å®‰å“è®¾å¤‡ä¸Šè¿è¡ŒFrida Server</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">adb push frida-server-12.0.7-android-arm64 /data/local/tmp
</span></span><span class="line"><span class="cl">adb shell su -c <span class="s2">&#34;/data/local/tmp/frida-server-12.0.7-android-arm64&#34;</span>
</span></span></code></pre></div><p>ä½¿ç”¨<code>frida-ps</code>æŸ¥çœ‹è¿›ç¨‹åç§°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">frida-ps aU <span class="p">|</span> grep banciyuan
</span></span><span class="line"><span class="cl">åŠæ¬¡å…ƒ  com.banciyuan.bcywebview
</span></span></code></pre></div><p>ç¼–å†™è°ƒè¯•è„šæœ¬ï¼Œhookå¹¶ä¿®æ”¹é€»è¾‘ï¼Œè¾“å‡ºä¸ºbcy.jsã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">pathRe</span> <span class="o">=</span> <span class="sr">/\?imageMogr2.*$/g</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Multi</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;de.greenrobot.daoexample.model.Multi&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Multi</span><span class="p">.</span><span class="nx">getPath</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPath</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="nx">pathRe</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">PostItem</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;de.greenrobot.daoexample.model.PostItem&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">PostItem</span><span class="p">.</span><span class="nx">getPath</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPath</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="nx">pathRe</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">OrignPic</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;de.greenrobot.daoexample.model.OrignPic&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">OrignPic</span><span class="p">.</span><span class="nx">isDownload</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isDownload</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></div><p>è¿è¡Œè°ƒè¯•è„šæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">frida -U -f com.banciyuan.bcywebview -l bcy.js --no-pause
</span></span></code></pre></div><p>æ™®é€šé¢„è§ˆå­˜åœ¨æ°´å°ï¼Œä½†æ˜¯åŸå›¾å›¾ç‰‡æ°´å°å·²ç»å»é™¤ï¼Œå·²ç»ç»•è¿‡ä¸‹è½½é™åˆ¶ï¼Œå¹¶ä¸”å®é™…ä¿å­˜çš„å›¾ç‰‡æ²¡æœ‰æ°´å°ã€‚</p>
<p><img loading="lazy"  src="diamond.jpg"
        alt="diamond"/></p>
<h2 id="xposed-module">Xposed Module</h2>
<p>ç›´æ¥è´´ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IXposedHookLoadPackage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleLoadPackage</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">XC_LoadPackage</span><span class="p">.</span><span class="na">LoadPackageParam</span><span class="w"> </span><span class="n">loadPackageParam</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">loadPackageParam</span><span class="p">.</span><span class="na">packageName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&#34;com.banciyuan.bcywebview&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findAndHookMethod</span><span class="p">(</span><span class="s">&#34;de.greenrobot.daoexample.model.Multi&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">loadPackageParam</span><span class="p">.</span><span class="na">classLoader</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;getPath&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XC_MethodReplacement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">protected</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">replaceHookedMethod</span><span class="p">(</span><span class="n">MethodHookParam</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">XposedHelpers</span><span class="p">.</span><span class="na">getObjectField</span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">thisObject</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;path&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">imageMogrIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="s">&#34;?&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imageMogrIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">imageMogrIndex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">path</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">XposedBridge</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findAndHookMethod</span><span class="p">(</span><span class="s">&#34;de.greenrobot.daoexample.model.PostItem&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">loadPackageParam</span><span class="p">.</span><span class="na">classLoader</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;getPath&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XC_MethodReplacement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">protected</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">replaceHookedMethod</span><span class="p">(</span><span class="n">MethodHookParam</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">XposedBridge</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&#34;PostItem&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">XposedHelpers</span><span class="p">.</span><span class="na">getObjectField</span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">thisObject</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;path&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">imageMogrIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="s">&#34;?&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imageMogrIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">imageMogrIndex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">path</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">XposedBridge</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">findAndHookMethod</span><span class="p">(</span><span class="s">&#34;de.greenrobot.daoexample.model.OrignPic&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">loadPackageParam</span><span class="p">.</span><span class="na">classLoader</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;isDownload&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XC_MethodReplacement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">protected</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">replaceHookedMethod</span><span class="p">(</span><span class="n">MethodHookParam</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>é™„ä¸ŠGitHubé“¾æ¥</p>
<p><a href="https://github.com/gorgiaxx/bcyhelper"target="_blank" rel="noopener noreferrer">https://github.com/gorgiaxx/bcyhelper</a></p>
<h2 id="reference">Reference</h2>
<p><a href="https://developer.android.com/training/volley"target="_blank" rel="noopener noreferrer">Volley overview</a></p>
<p><a href="https://api.xposed.info/reference/packages.html"target="_blank" rel="noopener noreferrer">Xposed Framework API</a></p>
<p><a href="https://www.frida.re/docs/javascript-api/"target="_blank" rel="noopener noreferrer">Frida JavaScript API</a></p>
</article><section class="article labels"><a class="category" href=/zh/categories/%E5%AE%89%E5%8D%93%E5%AE%89%E5%85%A8/>å®‰å“å®‰å…¨</a><a class="tag" href=/zh/tags/%E5%8D%8A%E6%AC%A1%E5%85%83/>åŠæ¬¡å…ƒ</a><a class="tag" href=/zh/tags/xposed/>Xposed</a><a class="tag" href=/zh/tags/frida/>Frida</a><a class="tag" href=/zh/tags/hook/>hook</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/zh/posts/huawei-e5885l-4g-router-tinkering-notes/"><span class="iconfont icon-article"></span>åä¸º E5885L 4Gè·¯ç”±å™¨æŠ˜è…¾ç¬”è®°</a></p><p><a class="link" href="/zh/posts/data-forwarding-techniques-in-pentest/"><span class="iconfont icon-article"></span>æ¸—é€ä¸­çš„æ•°æ®è½¬å‘æŠ€å·§</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>