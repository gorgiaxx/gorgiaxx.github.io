<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="å‰è¨€
æ­£å¼ä½¿ç”¨Linuxå·²ç»11ä¸ªæœˆäº†ï¼Œä»Debianåˆ°Archï¼ŒLinuxå·²ç»æˆäº†æˆ‘ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ã€‚"><title>KVM/QEMUåˆä½“éªŒ&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="KVM/QEMUåˆä½“éªŒ" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/zh/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/zh/categories/">åˆ†ç±»</a><a class="nav item" href="/zh/tags/">æ ‡ç­¾</a><a class="nav item" href="/zh/about/">å…³äº</a><a class="nav item" href="/zh/links/">å‹é“¾</a><a class="nav item" href="/en/posts/qemu-first-impressions/" title="English">
            <span class="lang-icon">ğŸŒ</span>English</a></nav></div></span></div></section><section id="content"><style>
     
    .toc-wrapper {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 9999;
        display: flex;
        flex-direction: column-reverse;
        align-items: flex-end;
        gap: 10px;
    }

     
    .toc-button {
        background-color: #fff;
        color: #333;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid #ddd;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .toc-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .toc-button svg {
        width: 24px;
        height: 24px;
        fill: currentColor;
    }

     
    .toc-content-box {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        width: 250px;
        max-height: 60vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        display: none;
         
        font-size: 0.9em;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.3s, transform 0.3s;
    }

    .toc-content-box.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }

    .toc-header {
        font-weight: bold;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 8px;
        margin-bottom: 8px;
        font-size: 1.1em;
    }

     
    #TableOfContents {
        text-align: left;
    }

    #TableOfContents ul,
    #TableOfContents ol {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    #TableOfContents li {
        margin: 4px 0;
    }

    #TableOfContents ul ul,
    #TableOfContents ol ol {
        padding-left: 1em;
    }

    #TableOfContents a {
        text-decoration: none;
        color: #555;
        display: block;
        padding: 2px 0;
        transition: color 0.2s;
    }

    #TableOfContents a:hover {
        color: #007bff;
    }

     
    @media (prefers-color-scheme: dark) {
        .toc-button {
            background-color: #333;
            color: #ddd;
            border-color: #555;
        }

        .toc-content-box {
            background-color: #2a2a2a;
            border-color: #444;
            color: #ddd;
        }

        .toc-header {
            border-bottom-color: #444;
        }

        #TableOfContents a {
            color: #aaa;
        }

        #TableOfContents a:hover {
            color: #fff;
        }
    }
</style><div class="article-container"><section class="article header">
    <h1 class="article title">KVM/QEMUåˆä½“éªŒ</h1><p class="article date">2016-11-13<span class="langs"><span class="lang">
                    <a href="/en/posts/qemu-first-impressions/" title="English">
                        <span class="lang-icon">ğŸŒ</span>English</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ­£å¼ä½¿ç”¨Linuxå·²ç»11ä¸ªæœˆäº†ï¼Œä»Debianåˆ°Archï¼ŒLinuxå·²ç»æˆäº†æˆ‘ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å‘¨å›´äººéƒ½ç”¨QQå’Œå¾®ä¿¡ï¼Œéœ€è¦ä¼ æ–‡ä»¶å’Œå›¾ç‰‡ï¼Œæˆ‘ä¸å¾—ä¸ç”¨ï¼Œä½†æ˜¯åˆä¸æƒ³ä½¿ç”¨Windowså·¥ä½œï¼Œæ‰€ä»¥å®‰è£…äº†VMWare Workstationæ¥è·‘è™šæ‹Ÿæœºã€‚
æœŸåˆåœ¨Debianä¸Šè·‘Win10å¾ˆæµç•…ï¼Œæ¢Archä¹‹åæ€»æ˜¯å› ä¸ºntfs3gå ç”¨ç‡è¿‡é«˜è€Œå¡é¡¿ï¼Œåæ¥æŠŠå®¿ä¸»æœºæ”¾è™šæ‹Ÿæœºçš„åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ¢æˆExt4ç¼“è§£äº†ä¸€äº›ï¼ŒæŠŠWin10è‡ªå¸¦çš„åº”ç”¨åˆ æ‰åæ‰å¥½äº†å¾ˆå¤šã€‚</p>
<p>KVM æ˜¯ kernel-based Virtual Machine çš„ç®€ç§°,æ˜¯ä¸€ä¸ªå¼€æºçš„ç³»ç»Ÿè™šæ‹ŸåŒ–æ¨¡å—,æ˜¯ Linux ä¸‹ x86 ç¡¬ä»¶å¹³å°ä¸Šçš„å…¨åŠŸèƒ½è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚
QEMUæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æºä»¿çœŸå™¨ï¼Œä»¿çœŸç³»ç»Ÿï¼Œä»¿çœŸå„ç§ç¡¬ä»¶ã€‚
<img loading="lazy"  src="./guide_fig.png"
        alt="guide_fig"/>
QEMUé€šè¿‡KVMè™šæ‹ŸåŒ–è¾¾åˆ°æ›´å¥½çš„æ€§èƒ½ï¼Œä»¥å‰ä»æ¥æ²¡æœ‰ç”¨è¿‡QEMUï¼Œäºæ˜¯èŠ±äº†å¾ˆå¤šæ—¶é—´å…¥é—¨ï¼Œæ¯ä¸ªç»†èŠ‚éƒ½ä¸æ”¾è¿‡ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸­æ”¶è·äº†å¾ˆå¤šï¼Œå¯¹è™šæ‹Ÿæœºä¹Ÿæœ‰äº†æ›´è¿›ä¸€æ­¥çš„äº†è§£ã€‚</p>
<p><a href="http://www.ibm.com/developerworks/cn/"target="_blank" rel="noopener noreferrer">IBMå¼€å‘è€…ç¤¾åŒº</a>çœŸæ˜¯ä¸€å¤§å †å¹²è´§ï¼Œè¿˜æœ‰å„å¤§äº§å“çš„å®˜æ–¹æ–‡æ¡£å’ŒWikiã€‚è‡ªå¸¦çš„man pagesä¹Ÿéå¸¸è¯¦ç»†ã€‚</p>
<p>ä¹Ÿæ­£æ˜¯å¼€å‘è€…ä»¬åšçš„ä¼Ÿå¤§è´¡çŒ®ï¼Œèƒ½è®©æˆ‘æ–¹ä¾¿åœ°åœ¨Linuxä¸Šè¿›è¡Œå·¥ä½œå’Œå¨±ä¹ã€‚ä¹Ÿå¾ˆæƒ­æ„§ç›®å‰è‡ªå·±æ²¡æœ‰èƒ½åŠ›åšè´¡çŒ®ã€‚</p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>ä¸ºäº†æ›´æ–¹ä¾¿çš„å­¦ä¹ ï¼Œå…ˆä¸ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢ã€‚(åæ¥å‘ç°ä¸è£…å›¾å½¢åŒ–çš„æˆ‘å¤ªå¹´è½»ï¼Œæ­£å¼ç¯å¢ƒä¸­é…ç½®è¿œæ¯”æƒ³è±¡ä¸­è¦å¤šï¼Œè€Œä¸”å¤æ‚å¾ˆå¤šï¼ŒCPUï¼Œé”®ç›˜ï¼ŒUSBï¼Œå£°éŸ³ç­‰éƒ½å¾ˆéš¾é…ç½®)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo pacman -S qemu
</span></span></code></pre></div><p>è¿˜æ˜¯å®‰è£…å›¾å½¢åŒ–ç•Œé¢å§ï¼Œè¯•è¿‡qtemu,qemu-launcher,aqemuè¦å¥½ç”¨ä¸€ç‚¹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yaourt aqemu
</span></span></code></pre></div><h2 id="æ·»åŠ ç¡¬ç›˜">æ·»åŠ ç¡¬ç›˜</h2>
<h3 id="åˆ›å»ºç¡¬ç›˜">åˆ›å»ºç¡¬ç›˜</h3>
<p>QEMUæ”¯æŒè®¸å¤šç§é•œåƒæ ¼å¼ï¼ŒåŒ…æ‹¬VMDK, VDI, VHD (vpc), VHDX, qcow1 å’Œ QEDï¼Œå¯ä»¥é€šè¿‡qemu-imgè¿›è¡Œæ“ä½œã€‚</p>
<p>ç›®å‰ä¸€èˆ¬é‡‡ç”¨rawå’Œqcow2ã€‚</p>
<p>rawæ˜¯åŸå§‹ç£ç›˜é•œåƒæ ¼å¼ï¼Œé€Ÿåº¦æœ€å¿«ï¼Œä½†æ˜¯è¦ç«‹å³åˆ†é…ç£ç›˜ç©ºé—´ã€‚</p>
<p>qcow2é€Ÿåº¦ç¨æ…¢ï¼Œä¸ç”¨ç«‹å³åˆ†é…ç©ºé—´ï¼Œæ”¯æŒå¾ˆå¤šç‰¹æ€§ï¼Œæ¯”å¦‚å¿«ç…§ï¼Œå›æ»šï¼ŒåŠ å¯†ï¼Œå‹ç¼©ç­‰ç­‰ã€‚</p>
<p>æ¯”å¦‚åˆ›å»ºä¸€ä¸ªrawæ ¼å¼çš„ç¡¬ç›˜é•œåƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">qemu-img create -f raw Kali_Linux.img 20G
</span></span></code></pre></div><p>æˆ–è€…åˆ›å»ºä¸€ä¸ªç°‡å¤§å°ä¸º2Mï¼Œç«‹å³åˆ†é…æ‰€æœ‰ç©ºé—´çš„qcow2ç¡¬ç›˜é•œåƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">qemu-img create -f qcow2 -o <span class="nv">cluster_size</span><span class="o">=</span>2M,preallocation<span class="o">=</span>full Kali_Linux.qcow2 4G
</span></span></code></pre></div><h3 id="æ ¼å¼è½¬æ¢">æ ¼å¼è½¬æ¢</h3>
<p>qemu-imgæ”¯æŒè½¬æ¢ç£ç›˜é•œåƒæ ¼å¼ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦è¿ç§»ç£ç›˜é•œåƒã€‚</p>
<p>æ¯”å¦‚æˆ‘æƒ³è¦å¯¹æ¯”Kali Linuxè¿è¡Œåœ¨KVMå’ŒVMwareä¸‹çš„æ€§èƒ½ï¼Œéœ€è¦æŠŠvmdkè½¬æ¢æˆæ›´é€‚åˆQEMUçš„ç£ç›˜é•œåƒæ ¼å¼ã€‚</p>
<h1 id="æŠŠvmdkè½¬æ¢æˆraw">æŠŠvmdkè½¬æ¢æˆraw</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">qemu-img convert -f vmdk -O raw Kali<span class="se">\ </span>2016<span class="se">\ </span>64-bit.vmdk Kali_Linux.img
</span></span></code></pre></div><h1 id="æŠŠvmdkè½¬æ¢æˆqcow2">æŠŠvmdkè½¬æ¢æˆqcow2</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">qemu-img convert -f vmdk -O qcow2 Kali<span class="se">\ </span>2016<span class="se">\ </span>64-bit.vmdk Kali_Linux.qcow2
</span></span></code></pre></div><h2 id="å¼€å¯ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–">å¼€å¯ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–</h2>
<p>ç¡®ä¿åœ¨BIOSé‡Œå¼€å¯äº†VTã€‚æˆ‘çš„ç”µè„‘æ˜¯Intelå¹³å°ï¼ŒæŠŠ<code>intel_iommu=on</code>åŠ è¿›å†…æ ¸å‚æ•°ã€‚å¦‚æœæ˜¯AMDå¹³å°åˆ™ç”¨<code>amd_iommu=on</code>ã€‚
IOMMUæŠ€æœ¯å¯ä»¥è¯´æ˜¯æŠŠç¡¬ä»¶è®¾å¤‡ç›´æ¥æ˜ å°„åˆ°è™šæ‹Ÿæœºä¸Šï¼Œè§£å†³å¤–å›´è®¾å¤‡çš„æ”¯æŒé—®é¢˜å’Œç¡¬ä»¶åˆ©ç”¨æ•ˆç‡é—®é¢˜ã€‚
åœ¨<code>/boot/grub/grub.cfg</code>æ–‡ä»¶é‡Œä¿®æ”¹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">linux   /boot/vmlinuz-linux <span class="nv">root</span><span class="o">=</span><span class="nv">UUID</span><span class="o">=</span>6bb8eda5-d588-4e6a-8f5e-bbc856cc9f96 rw quiet <span class="nv">intel_iommu</span><span class="o">=</span>on
</span></span></code></pre></div><p>é‡å¯ä¹‹åæŸ¥çœ‹IOMMUæ˜¯å¦å¼€å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gorgias@3vil ~&gt; dmesg <span class="p">|</span> grep -e DMAR -e IOMMU
</span></span><span class="line"><span class="cl"><span class="o">[</span>    0.000000<span class="o">]</span> DMAR: IOMMU enabled
</span></span></code></pre></div><p>å®‰è£…å›¾å½¢é©±åŠ¨ï¼Œè¿™é‡Œå…ˆè¯•è¯•vmwareçš„ã€‚å®‰è£…åå¯ä»¥è§£å†³é¼ æ ‡ä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼Œä½†æ˜¯è¿›å…¥æ¡Œé¢ä¼šèŠ±å±å‡ ç§’ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo pacman -S xf86-video-vmware xf86-input-vmmouse
</span></span></code></pre></div><p>å°è¯•å¯åŠ¨è™šæ‹Ÿæœºï¼Œå‚æ•°ï¼šä½¿ç”¨Kali_Linux.qcow2ç¡¬ç›˜é•œåƒï¼Œå†…å­˜2GBï¼Œä½¿ç”¨vmwareå›¾å½¢é©±åŠ¨ï¼Œä»¿çœŸQ35èŠ¯ç‰‡ç»„ï¼Œä½¿ç”¨KVMï¼Œå¼€å¯iommuã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">qemu-system-x86_64 /home/gorgias/media/Lancer/KVM/Kali<span class="se">\ </span>Linux/Kali_Linux.qcow2 -enable-kvm -m <span class="m">2048</span> -vga vmware -machine q35,accel<span class="o">=</span>kvm,type<span class="o">=</span>q35 -device intel-iommu
</span></span></code></pre></div><p>ç”¨èµ·æ¥æŒºæµç•…çš„
<img loading="lazy"  src="./demo.png"
        alt="demo"/></p>
<h2 id="qemu-monitor">QEMU monitor</h2>
<p>QEMUæä¾›ä¸€ä¸ªæ£€æŸ¥è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€çš„ç›‘è§†å™¨ï¼Œ
åœ¨QEMUç•Œé¢æŒ‰Ctrl + Alt + 2(ä¸æ˜¯å°é”®ç›˜)å¯ä»¥åˆ‡æ¢åˆ°QEMU monitorã€‚å¦‚æœä¸èƒ½ï¼Œè¯·æ£€æŸ¥å¿«æ·é”®æ˜¯å¦å†²çªã€‚
ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œæ·»åŠ <code>-monitor dev</code>å‚æ•°ï¼Œæ¯”å¦‚<code>-monitor stdio</code>å°†å…è®¸ä½¿ç”¨æ ‡å‡†è¾“å…¥ä½œä¸º monitor å‘½ä»¤æºã€‚</p>
<p>åœ¨monitorè¾“å…¥info kvmæ£€æŸ¥kvmæ¨¡å—æ˜¯å¦å¼€å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>qemu<span class="o">)</span> info kvm
</span></span><span class="line"><span class="cl">kvm support: enabled
</span></span></code></pre></div><p><img loading="lazy"  src="./QEMU_monitor.png"
        alt="QEMU_monitor"/></p>
<h2 id="aqemu">AQEMU</h2>
<p>é…ç½®æ˜¯ä¸å¯èƒ½å…¨æ‰‹åŠ¨é…ç½®çš„ï¼Œè¿™è¾ˆå­ä¸å¯èƒ½å…¨æ‰‹åŠ¨é…ç½®çš„ã€‚
QEMUæ˜¯éå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå€¼å¾—æ·±å…¥ç ”ç©¶ï¼Œå¾ç­‰è¿˜æ˜¯éšä¾¿ç©ç©å°±å¥½ã€‚</p>
<p><img loading="lazy"  src="./AQEMU.png"
        alt="AQEMU"/></p>
<p>ç•Œé¢æœ‰ç‚¹åƒVirtual Boxï¼ŒåŠŸèƒ½é½å…¨ã€‚åƒVMwareä¸€æ ·é…ç½®å°±èƒ½è·‘èµ·è™šæ‹Ÿæœºäº†ã€‚
ä¸ç®¡æ˜¯æ€§èƒ½è¿˜æ˜¯æ˜“ç”¨æ€§ï¼ŒVMwareéƒ½è¦å¼ºå¾ˆå¤šã€‚</p>
<h2 id="reference">Reference</h2>
<p><a href="https://wiki.archlinux.org/index.php/QEMU#Running_virtualized_system"target="_blank" rel="noopener noreferrer">Arch Linux Wiki - QEMU</a></p>
<p><a href="https://en.wikibooks.org/wiki/QEMU/Monitor"target="_blank" rel="noopener noreferrer">WIKIBOOKS - QEMU/Monitor</a></p>
<p><a href="http://www.linux-kvm.org/"target="_blank" rel="noopener noreferrer">linux-kvm.org</a></p>
</article><section class="article labels"><a class="category" href=/zh/categories/%E5%B7%A5%E5%85%B7/>å·¥å…·</a><a class="tag" href=/zh/tags/arch/>arch</a><a class="tag" href=/zh/tags/kvm/>kvm</a><a class="tag" href=/zh/tags/qemu/>qemu</a></section>
</div>

<div class="article bottom"><section class="article navigation"><p><a class="link" href="/zh/posts/build-openwrt-firmware-from-source-notes/"><span class="iconfont icon-article"></span>æºç ç¼–è¯‘OpenWrtå›ºä»¶ç¬”è®°</a></p><p><a class="link" href="/zh/posts/crack-milk-card-with-acr122u-on-arch-linux/"><span class="iconfont icon-article"></span>Arch Linuxä¸Šä½¿ç”¨ACR122Uç ´è§£é²œå¥¶å¡</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>