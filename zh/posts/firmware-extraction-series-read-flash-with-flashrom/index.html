<!DOCTYPE html>
<html lang="zh"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="Introduction to FlashROM
åŠå¹´å¤šæ²¡å†™æ–‡ç« äº†ï¼Œå›ºä»¶æå–ç³»åˆ—å·²ç»å†™åˆ°ç¬¬11éƒ¨ï¼Œè¿™ä¸€ä¸ªæˆ‘è§‰å¾—æ²¡é‚£ä¹ˆéš¾ï¼Œå¯ä»¥å…¬å¼€ã€‚"><title>å›ºä»¶æå–ç³»åˆ— - ä½¿ç”¨FlashROMè¯»å–Flash&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="å›ºä»¶æå–ç³»åˆ— - ä½¿ç”¨FlashROMè¯»å–Flash" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/zh/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/zh/categories/">åˆ†ç±»</a><a class="nav item" href="/zh/tags/">æ ‡ç­¾</a><a class="nav item" href="/zh/about/">å…³äº</a><a class="nav item" href="/zh/links/">å‹é“¾</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">å›ºä»¶æå–ç³»åˆ— - ä½¿ç”¨FlashROMè¯»å–Flash</h1><p class="article date">2019-07-20<span class="langs"><span class="lang">
                    <a href="/en/posts/firmware-extraction-series-read-flash-with-flashrom/" title="English">
                        <span class="lang-icon">ğŸŒ</span>English</a>
                </span></span></p></section><article class="article markdown-body"><h2 id="introduction-to-flashrom">Introduction to FlashROM</h2>
<p>åŠå¹´å¤šæ²¡å†™æ–‡ç« äº†ï¼Œå›ºä»¶æå–ç³»åˆ—å·²ç»å†™åˆ°ç¬¬11éƒ¨ï¼Œè¿™ä¸€ä¸ªæˆ‘è§‰å¾—æ²¡é‚£ä¹ˆéš¾ï¼Œå¯ä»¥å…¬å¼€ã€‚</p>
<p>FlashROMæ˜¯ä¸€æ¬¾å¼€æºçš„Flashå›ºä»¶æå–é¡¹ç›®ï¼Œæ”¯æŒå¤šç§ç¡¬ä»¶å¹³å°ï¼ŒSPI Flashå’ŒParallel Flashã€‚
è¿™ä¸€æ¬¡é‡åˆ°äº†ä¸€æ¬¾NANDçš„SPI Flashï¼Œå‹å·ä¸ºIS38SML01G1ï¼Œè½¦è§„çº§å­˜å‚¨èŠ¯ç‰‡ã€‚èµ·åˆä»¥ä¸ºSPI Flashéƒ½æ˜¯NORèŠ¯ç‰‡ï¼Œäºæ˜¯æ²¡æœ‰çœ‹æ‰‹å†Œï¼Œé£çº¿ç”¨ç¼–ç¨‹å™¨è¯»å–ï¼Œé€šå¸¸çš„ç¼–ç¨‹å™¨æ— æ³•è¯»å–ï¼Œåˆä½¿ç”¨RT809Hè¯»å–ï¼Œä¹Ÿå¤±è´¥ã€‚äºæ˜¯æŸ¥çœ‹æ‰‹å†Œæ‰å‘ç°æ˜¯NAND Flashï¼Œç›®å‰åªæœ‰<a href="https://www.reveltronics.com/en/products/revelprog-is-serial-memory-programmer-usb"target="_blank" rel="noopener noreferrer">REVELPROG-IS</a>æ”¯æŒè¯»å†™ã€‚
ä¸€å¼€å§‹æƒ³ä½¿ç”¨FT2232HLæ¥è¯»å–ï¼Œå‘ç°å®˜æ–¹å¯¹è¯¥èŠ¯ç‰‡çš„æ–‡æ¡£æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œäºæ˜¯ä½¿ç”¨æ ‘è“æ´¾3Bã€‚</p>
<p>flashchips.cæ–‡ä»¶ä¿å­˜äº†å„ä¸ªèŠ¯ç‰‡çš„é…ç½®ä¿¡æ¯ï¼Œè®¾è®¡çš„éå¸¸å¥½ï¼Œæ‰©å±•æ€§å¾ˆå¼ºã€‚</p>
<pre tabindex="0"><code>{
    .vendor		= Vendor name
    .name		= Chip name
    .bustype		= Supported flash bus types (Parallel, LPC...)
    .manufacture_id	= Manufacturer chip ID
    .model_id		= Model chip ID
    .total_size		= Total size in (binary) kbytes
    .page_size		= Page or eraseblock(?) size in bytes
    .tested		= Test status
    .probe		= Probe function
    .probe_timing	= Probe function delay
    .block_erasers[]	= Array of erase layouts and erase functions
    {
        .eraseblocks[]	= Array of { blocksize, blockcount }
        .block_erase	= Block erase function
    }
    .printlock		= Chip lock status function
    .unlock		= Chip unlock function
    .write		= Chip write function
    .read		= Chip read function
    .voltage		= Voltage range in millivolt
}
</code></pre><p>æ ¹æ®æ–‡æ¡£ï¼ŒåŠ å…¥äº†38SMçš„é…ç½®ä¿¡æ¯ã€‚
æ ¹æ®æ–‡æ¡£ä¿¡æ¯ï¼Œä¸€ä¸ªNAND SPI Flashæœ‰1024ä¸ªBlockï¼Œæ¯ä¸ªBlockæœ‰64Pageï¼Œä¸€ä¸ªPageæœ‰2K+64å­—èŠ‚ï¼Œå…¶ä¸­64æ˜¯å†—ä½™åŒºã€‚
è¿™é‡Œçš„Total Sizeæ˜¯ä»¥KBä¸ºå•ä½ï¼Œå› æ­¤ä¸éœ€è¦åŠ ä¸Šå†—ä½™åŒºçš„å¤§å°ã€‚ç”µå¹³èŒƒå›´æ ¹æ®æ–‡æ¡£è®¾ç½®æˆ2.7V~3.6Vã€‚</p>
<pre tabindex="0"><code>{
	.vendor		= &#34;ISSI&#34;,
	.name		= &#34;IS38SML01G1&#34;,
	.bustype	= BUS_SPI,
	.manufacture_id	= ISSI_NAND_ID,
	.model_id	= ISSI_NAND_ID_SPI,
	.total_size	= 131072, /* kb */
	.page_size	= 2048, /* bytes, actual page size is 64 */
	.tested		= {.probe = OK, .read = OK, .erase = NA, .write = NA},
	.probe		= probe_spi_rdid5,
	.probe_timing	= TIMING_ZERO,
	.block_erasers	=
	{
		{
			.eraseblocks = { {64 * 2048, 1024} },
			.block_erase = spi_block_erase_d8,
		}
	},
	.write		= NULL,
	.read		= spi_read_issi,
	.voltage	= {2700, 3600},
},
</code></pre><p>è¦è¯»å–Flashçš„å†…å®¹ï¼Œéœ€è¦å®ç°èŠ¯ç‰‡çš„åˆå§‹åŒ–å’Œè¯»å–åŠŸèƒ½ã€‚å› æ­¤æˆ‘ä»¬åªè¦å¯¹probeå’Œreadæ·»åŠ æŒ‡é’ˆã€‚ä¸‹å›¾æ˜¯å„ä¸ªCommandçš„å®šä¹‰ï¼ŒåŒ…æ‹¬Op Codeå­—èŠ‚ï¼Œå¯»å€ç”¨çš„å­—èŠ‚ï¼Œå¡«å……å­—èŠ‚å’Œä¸‹ä½æœºè¿”å›çš„æ•°æ®å­—èŠ‚ã€‚æ•°æ®çš„ä¼ è¾“æ ¼å¼æ˜¯MSBã€‚</p>
<p><img loading="lazy"  src="command_set.png"
        alt="command_set"/></p>
<p>åˆå§‹åŒ–éœ€è¦è¯»å–IDï¼Œé¦–å…ˆæŠŠèŠ¯ç‰‡IDå®šä¹‰å†™å¥½ã€‚Mark Code å’Œ Device Codeæœ‰ç”¨ã€‚å‰©ä¸‹çš„Communication Code 0x7F7F7Fä¹Ÿé¡ºä¾¿å†™ä¸Šå»å§ã€‚</p>
<p><img loading="lazy"  src="jedec_id.png"
        alt="jedec_id"/></p>
<pre tabindex="0"><code>#define ISSI_NAND_ID		0xC8
#define ISSI_NAND_ID_SPI	0x21
#define ISSI_38SML01G1		0x7F7F7F
</code></pre><p>FlashROMå†…ç½®çš„probe_spi_rdid4å‡½æ•°ç”¨äºè¯»å–JEDEC IDï¼Œå³å‘é€0x9Fï¼Œä½†æ˜¯ç”±äºè¯¥èŠ¯ç‰‡å‘é€Read IDæŒ‡ä»¤éœ€è¦å¡«å……ä¸€ä¸ªå­—èŠ‚ï¼Œæ­£å¸¸æƒ…å†µä½¿ç”¨probe_spi_rdidè¯»å–ç¬¬ä¸€ä¸ªå­—èŠ‚ä¼šå˜æˆ0x00ã€‚ISSIæ–‡æ¡£çš„æ—¶åºå›¾ç®€ç›´AVç”»è´¨ã€‚</p>
<p><img loading="lazy"  src="read_id_timing.png"
        alt="read_id_timing"/></p>
<p>å› æ­¤éœ€è¦æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå®ƒå‘½åä¸ºprobe_spi_rdid5ã€‚å¦å¤–å†åŠ ä¸Šè¯»å–çš„å‡½æ•°spi_read_issiï¼Œå®ƒä»¬éƒ½è¦åœ¨chipdrivers.hé‡Œå£°æ˜</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">probe_spi_rdid5</span><span class="p">(</span><span class="k">struct</span> <span class="n">flashctx</span> <span class="o">*</span><span class="n">flash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">spi_read_issi</span><span class="p">(</span><span class="k">struct</span> <span class="n">flashctx</span> <span class="o">*</span><span class="n">flash</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
</span></span></code></pre></div><p>Read IDå‡½æ•°ï¼Œå¦‚æœç¬¬ä¸€ä½æ˜¯0x00ï¼Œé‚£ä¹ˆè·³è¿‡è¿™ä¸€ä½ç»§ç»­è¯»å–ã€‚ä¹Ÿå¯ä»¥å‘é€IDçš„æ—¶å€™å¡«å……ä¸€ä½ï¼Œå°±ä¸ç”¨åˆ¤æ–­MISOçš„æ•°æ®äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">probe_spi_rdid5</span><span class="p">(</span><span class="k">struct</span> <span class="n">flashctx</span> <span class="o">*</span><span class="n">flash</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="k">struct</span> <span class="n">flashchip</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">flash</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">readarr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint32_t</span> <span class="n">id1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint32_t</span> <span class="n">id2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint32_t</span> <span class="n">bytes</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="nf">spi_rdid</span><span class="p">(</span><span class="n">flash</span><span class="p">,</span> <span class="n">readarr</span><span class="p">,</span> <span class="n">bytes</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">oddparity</span><span class="p">(</span><span class="n">readarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">		<span class="nf">msg_cdbg</span><span class="p">(</span><span class="s">&#34;RDID byte 0 parity violation. &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="cm">/* Check if this is a continuation vendor ID.
</span></span></span><span class="line"><span class="cl"><span class="cm">	 * FIXME: Handle continuation device IDs.
</span></span></span><span class="line"><span class="cl"><span class="cm">	 */</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">readarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">oddparity</span><span class="p">(</span><span class="n">readarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">			<span class="nf">msg_cdbg</span><span class="p">(</span><span class="s">&#34;RDID byte 1 parity violation. &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">id1</span> <span class="o">=</span> <span class="p">(</span><span class="n">readarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">readarr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">id2</span> <span class="o">=</span> <span class="n">readarr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">id1</span> <span class="o">=</span> <span class="n">readarr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">id2</span> <span class="o">=</span> <span class="p">(</span><span class="n">readarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">readarr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">msg_cdbg</span><span class="p">(</span><span class="s">&#34;%s: id1 0x%02x, id2 0x%02x</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">id1</span> <span class="o">==</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">manufacture_id</span> <span class="o">&amp;&amp;</span> <span class="n">id2</span> <span class="o">==</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">model_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="cm">/* Test if this is a pure vendor match. */</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">id1</span> <span class="o">==</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">manufacture_id</span> <span class="o">&amp;&amp;</span> <span class="n">GENERIC_DEVICE_ID</span> <span class="o">==</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">model_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="cm">/* Test if there is any vendor ID. */</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">GENERIC_MANUF_ID</span> <span class="o">==</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">manufacture_id</span> <span class="o">&amp;&amp;</span> <span class="n">id1</span> <span class="o">!=</span> <span class="mh">0xff</span> <span class="o">&amp;&amp;</span> <span class="n">id1</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦å¤–æ˜¯è¯»å–å‡½æ•°ï¼Œé¦–å…ˆè¦çŸ¥é“èŠ¯ç‰‡æ•°æ®çš„è¯»å–è¿‡ç¨‹ã€‚NANDä¸»æ§å…ˆæŠŠNANDçš„æ•°æ®æ”¾å…¥Cache Memoryï¼Œä¸€æ¬¡åªèƒ½è¯»ä¸€é¡µï¼Œç„¶åNANDä¸»æ§å†æŠŠæ•°æ®ä»Cacheè¯»å–å‡ºæ¥è¾“å‡ºåˆ°ä¸Šä½æœºã€‚</p>
<p><img loading="lazy"  src="blockdiagram.png"
        alt="blockdiagram"/></p>
<p>å› æ­¤è¦å…ˆå‘é€è¯»å–æŒ‡ä»¤ï¼Œå‘Šè¯‰æ§åˆ¶å™¨è¦è¯»å–å“ªä¸€é¡µã€‚åœ¨NANDæ•°æ®ä¼ è¾“åˆ°Cacheçš„æ—¶å€™ï¼Œä¸èƒ½åšå…¶ä»–è¯»å†™æ“ä½œã€‚æ­¤æ—¶çŠ¶æ€å¯„å­˜å™¨åº”è¯¥å¤„äºç¹å¿™çŠ¶æ€ã€‚OIP==1ã€‚</p>
<p>åœ¨å‘é€å®Œé¡µè¯»å–æŒ‡ä»¤åï¼Œåº”è¯¥å¾ªç¯å‘é€0x0F 0xC0ç›´åˆ°OIP==0ã€‚</p>
<p><img loading="lazy"  src="status_register.png"
        alt="status_register"/></p>
<p>å› æ­¤ä¸€æ¬¡å®Œæ•´çš„è¯»å–æµç¨‹çš„CMDå¦‚ä¸‹ï¼š</p>
<p>0x13 é¡µè¯»å–
0x0F 0xC0 è½®è¯¢çŠ¶æ€
0x03 ç¼“å­˜è¯»å–</p>
<p>é¡µè¯»å–æ ¹æ®Commandå®šä¹‰ï¼Œå¯»å€å­—èŠ‚é•¿åº¦ä¸º3ï¼Œå…¶ä¸­æœ‰ä¸€å­—èŠ‚ä¸ºæ— æ•ˆæ•°æ®ï¼Œæ‰€ä»¥æœ€å¤§åœ°å€ä¸º0xFFFFï¼Œæ¢ç®—æˆ10è¿›åˆ¶é•¿åº¦ä¸º65536ã€‚1024 Blocks * 64 Pages = 65536 Pagesã€‚è¿™é‡Œçš„å¡«å……æ•°æ®æš‚æ—¶å…ˆç†è§£ä¸º[7:0]ï¼Œå¯»å€æ•°æ®ä¸º[23:8]</p>
<p><img loading="lazy"  src="page_read.png"
        alt="page_read"/></p>
<p>ç¼“å­˜è¯»å–çš„å¯»å€é•¿åº¦ä¸º2-bytesï¼Œå¡«å……å­—èŠ‚ä¸º1-bytes + 4-bitsï¼Œå› æ­¤ç¼“å­˜çš„å¯»å€é•¿åº¦ä¸º12-bitsæ—¢4096ï¼Œæ–‡æ¡£ä¸­è§„å®šçš„èŒƒå›´æ˜¯0-2112ï¼Œå¯ä»¥ç†è§£ä¸º2048-bytes + 64-bytes (OOB area)ã€‚</p>
<p><img loading="lazy"  src="page_cache_read.png"
        alt="page_cache_read"/></p>
<p>ä¸‹é¢æ˜¯spi_read_issiçš„å®ç°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">spi_read_issi</span><span class="p">(</span><span class="k">struct</span> <span class="n">flashctx</span> <span class="o">*</span><span class="n">flash</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">page_read_resp</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">buf_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">cache_read_cmd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">get_feature_cmd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">address_h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">address_h</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">address_h</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">address_l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">address_l</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">address_l</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span> <span class="cm">/* page read cmd */</span>
</span></span><span class="line"><span class="cl">			<span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="cm">/* dummy byte */</span>
</span></span><span class="line"><span class="cl">			<span class="n">cmd</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">address_h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">cmd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">address_l</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">ret</span> <span class="o">=</span> <span class="nf">spi_send_command</span><span class="p">(</span><span class="n">flash</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">page_read_resp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="cm">/* 7-0 bits: ECC_S1, ECC_S0, P_Fail, E_Fail, WEL3, OIP */</span>
</span></span><span class="line"><span class="cl">			<span class="kt">uint8_t</span> <span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">get_feature_ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nf">internal_sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">get_feature_ret</span> <span class="o">=</span> <span class="nf">spi_send_command</span><span class="p">(</span><span class="n">flash</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">get_feature_cmd</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="n">get_feature_cmd</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span><span class="k">while</span> <span class="p">(</span><span class="n">get_feature_ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="cm">/* printf(&#34;\nStatus: 0x%X, get_feature_ret:%d\n&#34;, (unsigned int)status[0], get_feature_ret); */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">cache_read_cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span> <span class="cm">/* page read cmd */</span>
</span></span><span class="line"><span class="cl">			<span class="n">cache_read_cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">cache_read_cmd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">cache_read_cmd</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="cm">/* dummy byte */</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="kt">int</span> <span class="n">cache_read_ret</span> <span class="o">=</span> <span class="nf">spi_send_command</span><span class="p">(</span><span class="n">flash</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cache_read_cmd</span><span class="p">),</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">cache_read_cmd</span><span class="p">,</span> <span class="n">buf</span> <span class="o">+</span> <span class="mi">2048</span> <span class="o">*</span> <span class="n">buf_off</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">ret</span> <span class="o">=</span> <span class="n">cache_read_ret</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;device busy. timeout</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">ret</span> <span class="o">=</span> <span class="nf">spi_send_command</span><span class="p">(</span><span class="n">flash</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">get_feature_cmd</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="n">get_feature_cmd</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="cm">/* Send Read */</span>
</span></span><span class="line"><span class="cl">			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">buf_addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">2048</span> <span class="o">*</span> <span class="n">buf_off</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">buf_addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xffffffff</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">				<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;buf_off:%d, address: 0x%x%x</span><span class="se">\n</span><span class="s">buf_addr: 0x%X</span><span class="se">\n</span><span class="s">data:</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf_off</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">buf_addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="cm">/*int* = 4* int8 */</span>
</span></span><span class="line"><span class="cl">				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">512</span><span class="p">;</span> <span class="n">b</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%08x&#34;</span><span class="p">,</span> <span class="n">buf_addr</span><span class="p">[</span><span class="n">b</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// printf(&#34;\n&#34;);
</span></span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">				<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;reading err&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">buf_off</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="é£çº¿">é£çº¿</h2>
<p>é¦–å…ˆä½¿ç”¨å¤¹å…·ï¼Œçƒ­é£æª400â„ƒåº•éƒ¨åŠ çƒ­12ç§’</p>
<p><img loading="lazy"  src="target_device.jpg"
        alt="target_device"/></p>
<p>å°†èŠ¯ç‰‡ç„Šåœ¨è½¬æ¥æ¿ä¸Šé¢</p>
<p><img loading="lazy"  src="sop8.jpg"
        alt="sop8"/></p>
<p>ä¸€å¼€å§‹æ²¡æœ‰è€ƒè™‘åˆ°WSONå°è£…çš„åº•éƒ¨ä¼šå¯¼è‡´çŸ­è·¯ï¼Œäºæ˜¯é‡æ–°é£çº¿</p>
<p><img loading="lazy"  src="wson8.png"
        alt="wson8"/></p>
<p><img loading="lazy"  src="jumping1.jpg"
        alt="jumping1"/></p>
<p><img loading="lazy"  src="jumping2.jpg"
        alt="jumping2"/></p>
<p>æ¥è‡³æ ‘è“æ´¾3B
<img loading="lazy"  src="reading_by_rpi.jpg"
        alt="reading_by_rpi"/></p>
<p>æ¥çº¿æ–¹å¼å¦‚ä¸‹ï¼ŒHOLDè¦æ¥åœ¨VCCä¸Šã€‚</p>
<table>
  <thead>
      <tr>
          <th>RPi header</th>
          <th>SPI flash</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>25</td>
          <td>GND</td>
      </tr>
      <tr>
          <td>24</td>
          <td>/CS</td>
      </tr>
      <tr>
          <td>23</td>
          <td>SCK</td>
      </tr>
      <tr>
          <td>21</td>
          <td>DO</td>
      </tr>
      <tr>
          <td>19</td>
          <td>DI</td>
      </tr>
      <tr>
          <td>17</td>
          <td>VCC 3.3V (+ /HOLD, /WP)</td>
      </tr>
  </tbody>
</table>
<p>å¼€å¯SPIæ¨¡æ‹Ÿ</p>
<pre tabindex="0"><code>vi /boot/config.txt
dtparam=spi=on
</code></pre><p>åŠ è½½å†…æ ¸æ¨¡å—</p>
<pre tabindex="0"><code># If that fails you may wanna try the older spi_bcm2708 module instead
sudo modprobe spi_bcm2835
sudo modprobe spidev
</code></pre><pre tabindex="0"><code>flashrom -p linux_spi:dev=/dev/spidev0.0,spispeed=10000 -c IS38SML01G1 -V -r /tmp/is38_nooob.bin
</code></pre><p><img loading="lazy"  src="reading.png"
        alt="reading"/></p>
<h2 id="ç›®æ ‡è®¾å¤‡åˆå§‹åŒ–åˆ†æ">ç›®æ ‡è®¾å¤‡åˆå§‹åŒ–åˆ†æ</h2>
<p>è¯»å–å‡ºæ¥çš„128MBå›ºä»¶å‡ ä¹å…¨æ˜¯0xFFï¼Œä½†æ˜¯é—®äº†å‚å•†ï¼Œè¿™ä¸ªèŠ¯ç‰‡å­˜å‚¨äº†ä¸€äº›è½¯ä»¶å’Œé…ç½®ä¿¡æ¯ã€‚ç”±äºISSI Flashæ–‡æ¡£æ²¡æœ‰å†™æ¸…æ¥šé¡µè¯»å–å¯»å€çš„æ ¼å¼ï¼Œå¯»å€æœ‰3å­—èŠ‚ï¼Œé«˜ä½å­—èŠ‚å’Œä½ä½å­—èŠ‚è¿ç»­ï¼Œæ‰€ä»¥æœ‰ä¸¤ç§æ’åˆ—ï¼Œå†ä¸å¡«å……å­—èŠ‚ç»„åˆï¼Œæœ‰4ç§åœ°å€æ ¼å¼ï¼Œä¸çŸ¥é“å“ªä¸€ç§æ˜¯æ­£ç¡®çš„ã€‚äºæ˜¯æˆ‘æŠŠ4ç§åœ°å€æ ¼å¼éƒ½è¯»äº†ä¸€éï¼Œåªæ˜¯æ•°æ®çš„åˆ†å¸ƒå˜åŒ–äº†ï¼Œæ²¡æœ‰åŠæ³•ç¡®å®šæ­£ç¡®çš„åˆ†å¸ƒã€‚</p>
<p><img loading="lazy"  src="flashdump1.png"
        alt="flashdump1"/>
<img loading="lazy"  src="flashdump2.png"
        alt="flashdump2"/>
<img loading="lazy"  src="flashdump3.png"
        alt="flashdump3"/>
<img loading="lazy"  src="flashdump4.png"
        alt="flashdump4"/></p>
<p>å®Œå…¨æŒ‰ç…§æ–‡æ¡£ç¼–å†™çš„é©±åŠ¨ï¼Œè¯»å–å‡ºæ¥å‡ ä¹å…¨æ˜¯0xFFï¼Œæ„Ÿè§‰æ˜¯å“ªé‡Œå‡ºé—®é¢˜äº†ï¼Œäºæ˜¯ä¸Šé€»è¾‘åˆ†æä»ªã€‚
åªéœ€è¦æŠ“å–ä¸‰ä¸ªé€šé“çš„æ•°æ®ï¼ŒMOSI,MISO,CLKã€‚ä½¿ç”¨MSBï¼ŒCPOLå’ŒCPHAéƒ½è®¾ä¸º0ã€‚</p>
<p><img loading="lazy"  src="spi_mode.png"
        alt="spi_mode"/>
<img loading="lazy"  src="kingst_spiconf.png"
        alt="kingst_spiconf"/></p>
<p>è®¾ç½®æˆæ—¶é’Ÿä¸Šå‡æ²¿è§¦å‘ï¼Œé‡‡æ ·é¢‘ç‡200MHzã€‚
é¦–å…ˆæŠ“å–æ ‘è“æ´¾è¯»å–Flashçš„çš„æ•°æ®ï¼Œç¬¦åˆæ–‡æ¡£è§„èŒƒï¼Œ</p>
<p>è¯»å–JEDEC ID</p>
<p><img loading="lazy"  src="rpi_spi_init.png"
        alt="rpi_spi_init"/></p>
<p>è¯»å–çŠ¶æ€</p>
<p><img loading="lazy"  src="rpi_status.png"
        alt="rpi_status"/></p>
<p>å½“è¯»å–cacheæ—¶ï¼Œå‘å®Œ4ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ŒMISOå°±ä¸€ç›´å¤„äºé«˜ç”µå¹³ï¼Œè®©äººè§‰å¾—æ˜¯å“ªé‡Œä¸å¯¹ã€‚</p>
<p><img loading="lazy"  src="rpi_spi_read_cache.png"
        alt="rpi_spi_read_cache"/></p>
<p>å†å¯¹ç›®æ ‡è®¾å¤‡æŠ“å–æ•°æ®</p>
<p><img loading="lazy"  src="logical_analyzer_probe.jpg"
        alt="logical_analyzer_probe"/></p>
<p>é¦–å…ˆè¯»å–JEDEC IDï¼Œæ²¡é—®é¢˜ï¼Œå’Œæ ‘è“æ´¾çš„åŒºåˆ«æ˜¯åªè¿”å›å‰ä¸¤ä¸ªIDã€‚</p>
<p><img loading="lazy"  src="target_init.png"
        alt="target_init"/></p>
<p>é¡µè¯»å–åˆ°ç¼“å­˜è¯»å–ï¼Œé¦–å…ˆå‘é€è¯»å–é¡µçš„æŒ‡ä»¤ï¼Œç„¶åå‘é€è¯»å–çŠ¶æ€ï¼Œç­‰å¾…æ§åˆ¶å™¨è¿”å›0ï¼Œå†å‘é€ç¼“å­˜è¯»å–æŒ‡ä»¤ã€‚è¿™é‡Œå°±å‡ºé—®é¢˜äº†ï¼Œåé¢çš„MISOä¹Ÿæ˜¯è¾“å‡º0xFFï¼Œä½†æ˜¯æ¯å››ä¸ªå­—èŠ‚è¾“å‡ºï¼ŒMasterå°±ä¼šè¾“å…¥4ä¸ªä¸çŸ¥é“ä»€ä¹ˆå«ä¹‰çš„å­—èŠ‚ï¼Œå¾ªç¯äº¤æ›¿ã€‚0x03å¯ä»¥ç¡®å®šæ˜¯å•è·¯ä¼ è¾“ï¼Œå¹¶ä¸”åœ¨æ ‘è“æ´¾ä¸Šï¼ŒMOSIä¹Ÿä¸ä¼šäº§ç”Ÿæ•°æ®ï¼Œå¯ä»¥è¯æ˜ä¸æ˜¯Slaveå‘æ¥çš„ã€‚</p>
<p><img loading="lazy"  src="target_reading.png"
        alt="target_reading"/></p>
<p>è‡³å°‘è¯æ˜æˆ‘çš„ä»£ç æ²¡é”™ï¼Œè®¾å¤‡ç›®å‰æ²¡æœ‰ä½¿ç”¨åˆ°å­˜å‚¨èŠ¯ç‰‡ï¼Œ</p>
<h2 id="è¯»å–oobå¯¼è‡´çš„åæœ">è¯»å–OOBå¯¼è‡´çš„åæœ</h2>
<p>ä¸€å¼€å§‹æƒ³æŠŠå†—ä½™åŒºè¯»å–å‡ºæ¥ï¼Œæ‰€ä»¥å“åº”bufferè®¾æˆ2112ï¼Œæœ€ååœ¨dumpæ–‡ä»¶é‡Œçœ‹åˆ°äº†ELFçš„æ–‡ä»¶å¤´ï¼Œä¸€å¼€å§‹ä»¥ä¸ºç›®æ ‡è®¾å¤‡ä½¿ç”¨äº†ELFæ–‡ä»¶ã€‚ä½†æ˜¯æ€»è§‰å¾—ä¸å¯¹åŠ²ï¼Œè½¦è½½ç½‘å…³æ€ä¹ˆä¼šä½¿ç”¨Linuxã€‚</p>
<p><img loading="lazy"  src="dump1.png"
        alt="dump1"/></p>
<p>åæ¥æŸ¥çœ‹å†…å­˜çš„åœ°å€åˆ†å¸ƒï¼Œæ„Ÿè§‰æ˜¯è¶…å‡ºäº†å †çš„å¤§å°ï¼Œè¶Šç•Œè¯»åˆ°äº†åé¢çš„åº“æ–‡ä»¶</p>
<p><img loading="lazy"  src="maps.png"
        alt="maps"/></p>
<p>è®¡ç®—ä¸€ä¸‹ï¼Œç¬¬ä¸€æ®µæ˜¯å®é™…å †çš„å¤§å°ï¼Œç¬¬äºŒæ®µæ˜¯å®é™…è¯»å–çš„å¤§å°ï¼Œç¬¬ä¸‰æ®µæ˜¯æ­£å¸¸è¯»å–çš„å¤§å°ï¼Œæ‰€ä»¥ä¸è¦å»è¯»å†—ä½™åŒºã€‚</p>
<p><img loading="lazy"  src="address_calc.png"
        alt="address_calc"/></p>
<h2 id="revelprog-iså¼€ç®±">REVELPROG-ISå¼€ç®±</h2>
<p>æ—¶éš”ä¸€ä¸ªå¤šæœˆï¼Œè´­ä¹°äº†REVELPROG-ISï¼Œç”¨äºéªŒè¯FlashROMè¯»å–çš„ç»“æœæ˜¯å¦æ­£ç¡®ã€‚</p>
<p><img loading="lazy"  src="package.jpg"
        alt="package"/></p>
<p>è¿™æ˜¯æ³¢å…°åˆ¶é€ ï¼ŒåŒ…è£…å’Œç¼–ç¨‹å™¨å¤–è§‚éƒ½è¿˜è¡Œ</p>
<p><img loading="lazy"  src="revelprog.jpg"
        alt="revelprog"/></p>
<p>ç”µè·¯è®¾è®¡å¾ˆç®€å•ï¼Œä¸€é¢—STM32F103çš„èŠ¯ç‰‡ï¼Œä»·æ ¼æœ‰ç‚¹å°è´µï¼Œè¿˜å¥½æ²¡è¢«æŠ„æ¿å­</p>
<p><img loading="lazy"  src="STM32F103.jpg"
        alt="STM32F103"/></p>
<h2 id="éªŒè¯è¯»å–ç»“æœ">éªŒè¯è¯»å–ç»“æœ</h2>
<p>WSON8çš„çƒ§å½•åº§è¿˜æ²¡åˆ°è´§ï¼Œæš‚æ—¶é£çº¿è¯»å–ã€‚</p>
<p><img loading="lazy"  src="reading_with_prog.jpg"
        alt="reading_with_prog"/></p>
<p>è¯»å–é€Ÿåº¦è¶…æ…¢ï¼ŒèŠ±äº†å‡ åˆ†é’Ÿæ—¶é—´ã€‚ä¸æ”¯æŒè°ƒæ•´é€Ÿç‡ï¼Œè¿˜æ˜¯FlashROMé€Ÿåº¦æœ€å¿«</p>
<p><img loading="lazy"  src="reading_with_prog2.png"
        alt="reading_with_prog2"/></p>
<p>è¯»å–çš„æ•°æ®å’Œå‰é¢ä¸€è‡´</p>
<p><img loading="lazy"  src="result.png"
        alt="result"/></p>
<p>å¯»å€æ ¼å¼å’Œç¬¬ä¸‰ç§å¯¹åº”ï¼Œå…·ä½“é¡ºåºå¿˜äº†ï¼Œä»¥åå°±ç”¨è¿™ä¸ªç¼–ç¨‹å™¨è¯»äº†ã€‚</p>
<p><img loading="lazy"  src="flashdump5.png"
        alt="flashdump5"/></p>
<h2 id="å‹˜è¯¯">å‹˜è¯¯</h2>
<p>åœ¨åç»­çš„ç ”ç©¶ä¸­ï¼Œå‘ç°è¿™ä¸ªæ–‡ç« å­˜åœ¨ä¸€äº›å‘ã€‚
Address_h å’Œ address_l æ˜¯åœ¨ä¸çŸ¥é“è¯»å–è§„åˆ™çš„å‰æä¸‹å‡è®¾çš„ï¼Œå› ä¸ºæ–‡æ¡£æ²¡æœ‰å†™ã€‚ä¸¤è€…é•¿åº¦éƒ½å‡è®¾æ˜¯8-bitã€‚
åœ¨é˜…è¯»äº†å…¶ä»–å‡ æ¬¾èŠ¯ç‰‡çš„æ–‡æ¡£åï¼Œç¡®å®šå­˜åœ¨é—®é¢˜ã€‚
<img loading="lazy"  src="readpage_address.png"
        alt="readpage_address"/>
å®é™…ä¸Šè¿™ä¸¤ä¸ªå‚æ•°ä»£è¡¨å—åœ°å€ä¸é¡µåœ°å€ï¼Œå—æ•°é‡1024ï¼Œå æ®10ä½ï¼Œé¡µåœ°å€64ï¼Œå æ®6ä½ï¼ŒåŠ èµ·æ¥åˆšå¥½16-bitsã€‚ä¸åŒå¤§å°çš„èŠ¯ç‰‡æœ‰ä¸åŒçš„è§„åˆ™ã€‚
å› æ­¤è¯»å–çš„ç»“æœä¼šå‡ºç°é‡å¤ï¼ŒåŠ ä¸Šæœ‰æ•ˆæ•°æ®åˆšå¥½åˆ†å¸ƒåœ¨å­˜å‚¨è®¾å¤‡çš„å‰é¢éƒ¨åˆ†ï¼Œå‰©ä½™çš„éƒ½æ˜¯æ— æ•ˆæ•°æ®ï¼Œå³ä½¿åœ°å€é”™è¯¯ï¼Œè¯»å–å‡ºæ¥çš„ç»“æœä¹Ÿä¸å½±å“ï¼Œæœ€ç»ˆå‘ˆç°å’Œç¼–ç¨‹å™¨è¯»å–ä¸€è‡´çš„ç»“æœã€‚</p>
<p>å¦å¤–ç»™å‡ºçš„ä»£ç é‡Œï¼ŒStatusåˆ¤æ–­å­˜åœ¨é—®é¢˜ï¼Œä¸ä¸€å®šè¦ä¸º0æ‰èƒ½è¯»å–æ•°æ®ã€‚BBM LUT FULL(Look-Up Table)ä¹Ÿå¯èƒ½ä¸º1ï¼ŒECC Err Statuså¯èƒ½æ˜¯0x20ã€‚
<img loading="lazy"  src="status.png"
        alt="status"/></p>
</article><section class="article labels"><a class="category" href=/zh/categories/%E5%9B%BA%E4%BB%B6%E6%8F%90%E5%8F%96%E7%B3%BB%E5%88%97/>å›ºä»¶æå–ç³»åˆ—</a><a class="tag" href=/zh/tags/flashrom/>FlashROM</a><a class="tag" href=/zh/tags/nand/>NAND</a><a class="tag" href=/zh/tags/raspberry/>Raspberry</a><a class="tag" href=/zh/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/>æ ‘è“æ´¾</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/zh/posts/4g-modem-attack-scenarios-in-vehicle-networking/"><span class="iconfont icon-article"></span>æµ…è°ˆ4Gé€šä¿¡æ¨¡ç»„åœ¨è½¦è”ç½‘é¢†åŸŸçš„æ”»å‡»åœºæ™¯</a></p><p><a class="link" href="/zh/posts/firmware-extraction-series-sata-hdd-unlock/"><span class="iconfont icon-article"></span>å›ºä»¶æå–ç³»åˆ— - SATAç¡¬ç›˜è§£é”</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>