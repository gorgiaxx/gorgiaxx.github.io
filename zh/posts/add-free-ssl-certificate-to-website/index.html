<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.154.5"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><meta name="description" content="
ä¸ºä»€ä¹ˆè¦æ·»åŠ SSLè¯ä¹¦/ä½¿ç”¨HTTPSåè®®
ç›®å‰äº’è”ç½‘å¸¸ç”¨çš„HTTPåè®®æ˜¯æ˜æ–‡ä¼ è¾“åè®®ï¼Œæ•°æ®åœ¨ç½‘ç»œä¸Šæ˜¯é€æ˜çš„ï¼Œå¯ä»¥è¢«ä¸­é—´äººåˆ©ç”¨ã€‚
è¿‘äº›å¹´æ¥ISPåŠ«æŒè¶Šæ¥è¶Šé¢‘ç¹ï¼Œé»‘å®¢æ”»å‡»çš„é—¨æ§›ä¹Ÿè¶Šæ¥è¶Šä½ï¼Œä¸ºäº†å®‰å…¨ï¼Œä½¿ç”¨HTTPSåŠ å¯†åè®®è®¿é—®ç½‘ç«™ï¼Œå®ç°é«˜å¼ºåº¦åŒå‘åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¼ è¾“æ•°æ®è¢«æ³„éœ²æˆ–ç¯¡æ”¹ã€‚"><title>ç»™ç½‘ç«™æ·»åŠ å…è´¹SSLè¯ä¹¦&nbsp;&ndash;&nbsp;Gorgias&#39; Blog</title><link rel="stylesheet" href="/css/core.min.363cdd0e3e6340dd0e88b1f21887fb7e53e3129ed31d7f3cf62686d06069621ece79dc5ffb48a77ebba54468e667212f.css" integrity="sha384-NjzdDj5jQN0OiLHyGIf7flPjEp7THX889iaG0GBpYh7Oedxf&#43;0infrulRGjmZyEv"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="ç»™ç½‘ç«™æ·»åŠ å…è´¹SSLè¯ä¹¦" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/zh/"><span class="site name">Gorgias' Blog</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/zh/categories/">åˆ†ç±»</a><a class="nav item" href="/zh/tags/">æ ‡ç­¾</a><a class="nav item" href="/zh/about/">å…³äº</a><a class="nav item" href="/zh/links/">å‹é“¾</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">ç»™ç½‘ç«™æ·»åŠ å…è´¹SSLè¯ä¹¦</h1><p class="article date">Monday, May 9, 2016<span class="langs"><span class="lang">
                    <a href="/en/posts/add-free-ssl-certificate-to-website/" title="English">
                        <span class="lang-icon">ğŸŒ</span>English</a>
                </span></span></p></section><article class="article markdown-body"><p><img loading="lazy"  src="./Internet.jpg"
        alt="http2"/></p>
<h2 id="ä¸ºä»€ä¹ˆè¦æ·»åŠ sslè¯ä¹¦ä½¿ç”¨httpsåè®®">ä¸ºä»€ä¹ˆè¦æ·»åŠ SSLè¯ä¹¦/ä½¿ç”¨HTTPSåè®®</h2>
<p>ç›®å‰äº’è”ç½‘å¸¸ç”¨çš„HTTPåè®®æ˜¯æ˜æ–‡ä¼ è¾“åè®®ï¼Œæ•°æ®åœ¨ç½‘ç»œä¸Šæ˜¯é€æ˜çš„ï¼Œå¯ä»¥è¢«ä¸­é—´äººåˆ©ç”¨ã€‚
è¿‘äº›å¹´æ¥ISPåŠ«æŒè¶Šæ¥è¶Šé¢‘ç¹ï¼Œé»‘å®¢æ”»å‡»çš„é—¨æ§›ä¹Ÿè¶Šæ¥è¶Šä½ï¼Œä¸ºäº†å®‰å…¨ï¼Œä½¿ç”¨HTTPSåŠ å¯†åè®®è®¿é—®ç½‘ç«™ï¼Œå®ç°é«˜å¼ºåº¦åŒå‘åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¼ è¾“æ•°æ®è¢«æ³„éœ²æˆ–ç¯¡æ”¹ã€‚</p>
<h2 id="å‡†å¤‡--ç¯å¢ƒ">å‡†å¤‡ &amp; ç¯å¢ƒ</h2>
<p>æœ¬æœåŠ¡å™¨ç¯å¢ƒDigitalOcean VPSï¼ŒSGèŠ‚ç‚¹ï¼ŒDebian jessieï¼ŒAMHä¸»æœºé¢æ¿
éœ€è¦ç”¨åˆ°:
*å…è´¹SSLè¯ä¹¦ <a href="https://letsencrypt.org/"target="_blank" rel="noopener noreferrer">Letâ€™s Encrypt</a>
*<a href="http://nginx.org/"target="_blank" rel="noopener noreferrer">NGINX</a>
*<a href="https://www.openssl.org/"target="_blank" rel="noopener noreferrer">OpenSSL</a></p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<h3 id="å®‰è£…å‡çº§openssl-102">å®‰è£…&amp;å‡çº§OpenSSL 1.0.2</h3>
<p>è¦è®©NGINXå¼€å¯HTTP/2åè®®ï¼Œå¿…é¡»ä½¿ç”¨æ­¤ç‰ˆæœ¬çš„OpenSSL</p>
<blockquote>
<p>Note that accepting HTTP/2 connections over TLS requires the â€œApplication-Layer Protocol Negotiationâ€ (ALPN) TLS extension support, which is available only since OpenSSL version 1.0.2. Using the â€œNext Protocol Negotiationâ€ (NPN) TLS extension for this purpose (available since OpenSSL version 1.0.1) is not guaranteed.</p>
</blockquote>
<p>å»å®˜ç½‘æˆ–è€…è½½Gayhubä¸‹è½½OpenSSLæºç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/openssl/openssl/archive/OpenSSL_1_0_2h.tar.gz
</span></span><span class="line"><span class="cl">tar -zxvf ./OpenSSL_1_0_2h.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ./openssl-OpenSSL_1_0_2h/
</span></span></code></pre></div><p>é€‰æ‹©ä½ è¦å®‰è£…çš„ç›®å½•ï¼Œå¦‚æœå‡çº§çš„è¯ï¼ŒæŠŠprefixå‚æ•°æ”¹æˆOpenSSLæ‰€åœ¨çš„ç›®å½•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./config --prefix<span class="o">=</span>/usr/local/openssl --openssldir<span class="o">=</span>/usr/local/ssl
</span></span><span class="line"><span class="cl">make
</span></span><span class="line"><span class="cl">make install
</span></span><span class="line"><span class="cl">mv /usr/bin/openssl /usr/bin/openssl.OFF
</span></span><span class="line"><span class="cl">mv /usr/include/openssl /usr/include/openssl.OFF
</span></span><span class="line"><span class="cl">ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl
</span></span><span class="line"><span class="cl">ln -s /usr/local/openssl/include/openssl /usr/include/openssl
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;/usr/local/openssl/lib&#34;</span>&gt;&gt;/etc/ld.so.conf
</span></span></code></pre></div><p>æŸ¥çœ‹OpenSSLçš„ç‰ˆæœ¬å˜æˆäº†1.0.2h</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl version -a
</span></span></code></pre></div><h3 id="å®‰è£…lets-encryptå®¢æˆ·ç«¯">å®‰è£…Letâ€™s Encryptå®¢æˆ·ç«¯</h3>
<p>è·å–æºç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/letsencrypt/letsencrypt
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> letsencrypt
</span></span></code></pre></div><p>å®‰è£…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./letsencrypt-auto --help
</span></span></code></pre></div><p>ç­¾å‘è¯ä¹¦,wå‚æ•°å¡«ç½‘ç«™çš„è·¯å¾„,då‚æ•°å¡«åŸŸåï¼Œè¯ä¹¦ä»¥ç¬¬ä¸€ä¸ªåŸŸåä¸ºå‡†ï¼Œå…·ä½“å‚è€ƒå®˜æ–¹æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./letsencrypt-auto certonly --webroot -w /www/blog/ -d gorgiaxx.com -d blog.gorgiaxx.com
</span></span></code></pre></div><p>è¯ä¹¦æœ‰æ•ˆæœŸä¸‰ä¸ªæœˆ,å¯ä»¥å†™è„šæœ¬ç»­æœŸ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> * * /usr/local/nginx/sbin/nginx -s stop <span class="o">&amp;&amp;</span> /opt/letsencrypt-auto certonly --renew-by-default --webroot -w /www/blog/ -d gorgiaxx.com -d blog.gorgiaxx.com <span class="o">&amp;&amp;</span> /usr/local/nginx/sbin/nginx
</span></span></code></pre></div><p>è¯ä¹¦é»˜è®¤ç”Ÿæˆåœ¨æ­¤ç›®å½•ï¼ŒNGINXéœ€è¦ç”¨åˆ°åä¸¤ä¸ªæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@gorgiaxx-ubuntu:~/tmp# ls /etc/letsencrypt/live/gorgiaxx.com
</span></span><span class="line"><span class="cl">cert.pem  chain.pem  fullchain.pem  privkey.pem
</span></span></code></pre></div><h3 id="å¯ç”¨-certificate-transparency-ç­–ç•¥">å¯ç”¨ Certificate Transparency ç­–ç•¥</h3>
<p>ç”± Google ä¸»å¯¼ï¼Œå¹¶ç”± IETF æ ‡å‡†åŒ–ä¸º RFC 6962ã€‚Certificate Transparency çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå¼€æ”¾çš„å®¡è®¡å’Œç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥è®©ä»»ä½•åŸŸåæ‰€æœ‰è€…æˆ–è€… CA ç¡®å®šè¯ä¹¦æ˜¯å¦è¢«é”™è¯¯ç­¾å‘æˆ–è€…è¢«æ¶æ„ä½¿ç”¨ï¼Œä»è€Œæé«˜ HTTPS ç½‘ç«™çš„å®‰å…¨æ€§ã€‚</p>
<p>CT ç­–ç•¥ç›®å‰åªæœ‰ Chrome æ”¯æŒï¼›å…¶æ¬¡ Chrome ä¹ŸçŸ¥é“ç°åœ¨æ”¯æŒ CT çš„ç½‘ç«™å¹¶ä¸å¤šï¼Œæ‰€ä»¥å¯¹äºæ²¡æœ‰æä¾› SCT ä¿¡æ¯çš„ HTTPS ç½‘ç«™ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„å½±å“ã€‚</p>
<p>å…·ä½“å‚è€ƒ<a href="https://imququ.com/post/certificate-transparency.html"target="_blank" rel="noopener noreferrer">Certificate Transparency é‚£äº›äº‹</a>
é€šè¿‡ ct-submit è¿™ä¸ªæ¨¡å—ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†è¯ä¹¦æäº¤ç»™ CT Logs æœåŠ¡å™¨å¹¶å¾—åˆ° SCT å“åº”</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt-get install golang
</span></span><span class="line"><span class="cl">wget -O ct-submit.zip -c https://github.com/grahamedgecombe/ct-submit/archive/v1.0.0.zip
</span></span><span class="line"><span class="cl">unzip ct-submit.zip
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ct-submit-1.0.0
</span></span><span class="line"><span class="cl">go build
</span></span></code></pre></div><p>ç¼–è¯‘å®Œæ¯•ï¼Œæ‰§è¡Œå¹¶æäº¤ï¼ŒCT LogsæœåŠ¡å™¨å¯ä»¥åœ¨<a href="https://www.certificate-transparency.org/known-logs"target="_blank" rel="noopener noreferrer">è¿™é‡Œæ‰¾åˆ°</a>ï¼ˆè¢«å¢™äº†ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./ct-submit-1.0.0 ct.googleapis.com/aviator
</span></span><span class="line"><span class="cl">&lt;/etc/letsencrypt/live/gorgiaxx.com/fullchain.pem
</span></span><span class="line"><span class="cl">&gt;/etc/letsencrypt/live/gorgiaxx.com/scts/aviator.sct
</span></span><span class="line"><span class="cl">./ct-submit-1.0.0 ct.googleapis.com/pilot
</span></span><span class="line"><span class="cl">&lt;/etc/letsencrypt/live/gorgiaxx.com/fullchain.pem
</span></span><span class="line"><span class="cl">&gt;/etc/letsencrypt/live/gorgiaxx.com/scts/pilot.sct
</span></span><span class="line"><span class="cl">./ct-submit-1.0.0 ct.googleapis.com/rocketeer
</span></span><span class="line"><span class="cl">&lt;/etc/letsencrypt/live/gorgiaxx.com/fullchain.pem
</span></span><span class="line"><span class="cl">&gt;/etc/letsencrypt/live/gorgiaxx.com/scts/rocketeer.sct
</span></span></code></pre></div><h3 id="å®‰è£…å‡çº§nginx">å®‰è£…&amp;å‡çº§NGINX</h3>
<p>ä¸‹è½½å¹¶è§£å‹NGINXå’Œnginx-ctæ¨¡å—</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget -O nginx-ct.zip https://github.com/grahamedgecombe/nginx-ct/archive/master.zip
</span></span><span class="line"><span class="cl">unzip nginx-ct.zip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">http://nginx.org/download/nginx-1.10.0.tar.gz
</span></span><span class="line"><span class="cl">tar -zxvf nginx-1.10.0.tar.gz
</span></span></code></pre></div><p>/usr/local/nginxæ˜¯æˆ‘åŸå…ˆnginxçš„ç›®å½•
å®‰è£…æ–‡ä»¶ä¸´æ—¶æ”¾åœ¨/tmp/é‡Œé¢</p>
<p>æ·»åŠ brotliå‹ç¼©æ ¼å¼æ”¯æŒï¼Œå®ç°äº†æ›´é«˜çš„å‹ç¼©æ¯”ç‡ï¼Œä¸gzipå…¼å®¹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/google/ngx_brotli.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ngx_brotli
</span></span><span class="line"><span class="cl">git submodule update --init
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./configure --prefix<span class="o">=</span>/usr/local/nginx --user<span class="o">=</span>www --group<span class="o">=</span>www --with-http_ssl_module --with-http_gzip_static_module --with-http_v2_module --with-http_stub_status_module --add-module<span class="o">=</span>../nginx-ct-1.3.2 --add-module<span class="o">=</span>../ngx_brotli
</span></span><span class="line"><span class="cl">make
</span></span></code></pre></div><p>å¦‚æœmakeå¤±è´¥ï¼Œè¯·åœ¨configureåŠ ä¸Š</p>
<p><code>--with-openssl=/tmp/openssl-1.0.2h/</code>
æ›¿æ¢æ—§æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cp -f objs/nginx /usr/local/nginx/sbin/nginx
</span></span></code></pre></div><p>å‡çº§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">make upgrade
</span></span></code></pre></div><h3 id="é…ç½®nginx">é…ç½®NGINX</h3>
<p>æŠŠç›‘å¬ç«¯å£æ¢æˆ443ï¼Œæ·»åŠ sslå’Œhttp2</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">listen <span class="m">443</span> ssl http2 default<span class="p">;</span> <span class="c1">#listen end</span>
</span></span></code></pre></div><p>å¼€å¯sslå’Œssl_ctï¼Œæ·»åŠ SCTç›®å½•å’ŒSSLè¯ä¹¦è·¯å¾„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssl on<span class="p">;</span>
</span></span><span class="line"><span class="cl">ssl_ct on<span class="p">;</span>
</span></span><span class="line"><span class="cl">ssl_ct_static_scts /etc/letsencrypt/live/gorgiaxx.com/scts/<span class="p">;</span>
</span></span><span class="line"><span class="cl">ssl_certificate /etc/letsencrypt/live/gorgiaxx.com/fullchain.pem<span class="p">;</span>
</span></span><span class="line"><span class="cl">ssl_certificate_key /etc/letsencrypt/live/gorgiaxx.com/privkey.pem<span class="p">;</span>
</span></span></code></pre></div><p>é‡è½½NGINX</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/usr/local/nginx/sbin/nginx -s reload
</span></span></code></pre></div><p>ç”±å›¾å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å¯ç”¨äº†HTTP/2åè®®å’ŒCTç­–ç•¥
<img loading="lazy"  src="./http2.png"
        alt="http2"/>
å¯ä»¥çœ‹åˆ°CTç­–ç•¥å¼€å¯äº†
<img loading="lazy"  src="./ssl-ct.png"
        alt="ssl-ct"/></p>
<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;2016å¹´11æœˆ12æ—¥ æ›´æ–°ï¼š&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p>
<p>æ–°ç‰ˆçš„letsencryptä½¿ç”¨certbotéƒ¨ç½²è¯ä¹¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./certbot-auto certonly --standalone --email gorgiaxx@gmail.com -d gorgiaxx.com -d www.gorgiaxx.com -d blog.gorgiaxx.com -d api.gorgiaxx.com
</span></span></code></pre></div><p>è¯ä¹¦è‡ªåŠ¨ç»­æœŸ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> * * /usr/local/nginx/sbin/nginx -s stop <span class="o">&amp;&amp;</span> /opt/certbot-auto renew <span class="o">&amp;&amp;</span> /usr/local/nginx/sbin/nginx
</span></span></code></pre></div><p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;2017å¹´2æœˆ9æ—¥ æ›´æ–°ï¼š&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>
<p>æˆ‘è¯´æ€ä¹ˆè€æ˜¯æé†’æˆ‘è¿‡æœŸ(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»ï¼ŒåŸæ¥certbotä¼šåœ¨å¯åŠ¨æ—¶è‡ªå·±æ›´æ–°ï¼Œç„¶åä¾èµ–virtualenvï¼ŒVPSä¸Šæ²¡æœ‰è£…ï¼Œæ‰€ä»¥è‡ªåŠ¨ç»­æœŸå¤±è´¥</p>
</article><section class="article labels"><a class="category" href=/zh/categories/%E6%8A%98%E8%85%BE/>æŠ˜è…¾</a><a class="tag" href=/zh/tags/certbot/>certbot</a><a class="tag" href=/zh/tags/ssl/>SSL</a><a class="tag" href=/zh/tags/%E8%AF%81%E4%B9%A6/>è¯ä¹¦</a></section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/zh/posts/lenovo-y410p-bios-recovery-notes/"><span class="iconfont icon-article"></span>è”æƒ³Y410p BIOS æ‹¯æ•‘ç¬”è®°</a></p><p><a class="link" href="/zh/posts/first-hardware-mod-router-openwrt/"><span class="iconfont icon-article"></span>è®°ç¬¬ä¸€æ¬¡ç¡¬æ”¹è·¯ç”±å™¨ä¸ŠOpenwrt</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">2015 - 2026 Gorgias' Blog. </p><p class="license">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">
            <img alt="CC BY-NC-SA" loading="lazy" src="/images/by-nc.svg" style="vertical-align: middle; height: 1.2em; margin: 0 0.2em;" />
            CC BY-NC-SA 4.0
        </a>
        (ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«).
    </p><p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div></section></body>

</html>